<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <?define ProductVersion="1.0.0.0" ?>
  <?define Manufacturer="The World Bank" ?>
  <?define ProductName="Capi" ?>
  
    <Product Id="3a419e81-6f16-42f0-a5db-c3e62e68a3bb"
           Language="1033"
           Name="$(var.ProductName)"
           Version="$(var.ProductVersion)" 
           Manufacturer="$(var.Manufacturer)" 
           UpgradeCode="cbca8aaa-e536-4c89-81b5-c7dd6577e522">
        
    <Package InstallerVersion="200" 
             Compressed="yes"
             Description="Test installation."/>
    
    <Upgrade Id="cc00bf47-7cbf-4bde-8fa1-905fa1916b1e">
      
      <UpgradeVersion Minimum="$(var.ProductVersion)" 
                      IncludeMinimum="no" 
                      OnlyDetect="yes" 
                      Language="1033"
                      Property="NEWPRODUCTFOUND" />

      <UpgradeVersion Minimum="0.0.0.0" 
                      IncludeMinimum="yes" 
                      Maximum="$(var.ProductVersion)" 
                      IncludeMaximum="no" 
                      Language="1033"
                      Property="UPGRADEFOUND" />
    </Upgrade>

    <Property Id="NEWPRODUCTFOUND" Secure="yes" />
    <Property Id="UPGRADEFOUND" Secure="yes" />

        <Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />

        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFilesFolder">
                <Directory Id="TheWorldBank" Name="The World Bank">
                    <Directory Id="INSTALLLOCATION" Name="Capi">
                        <Directory Id="CLIENTDIR" Name="Client">
                        </Directory>
                        <Directory Id="ENGINEDIR" Name="Engine">
                        </Directory>
                    
                    <!-- TODO: Remove the comments around this Component element and the ComponentRef below in order to add resources to this installer. -->
                    <!-- <Component Id="ProductComponent" Guid="475a39d5-bd4b-4263-b551-08dfe9822eef"> -->
                        <!-- TODO: Insert files, registry keys, and other resources here. -->
                    <!-- </Component> -->
                </Directory>
                </Directory>
            </Directory>
            
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="$(var.ProductName)"/>
            </Directory>            
            <Directory Id="DesktopFolder" Name="Desktop"/>
            
        </Directory>

      <Feature Id="ProductFeature" Title="Capi" Level="1" ConfigurableDirectory="INSTALLLOCATION">
            <!-- TODO: Remove the comments around this ComponentRef element and the Component above in order to add resources to this installer. -->
            <!-- <ComponentRef Id="ProductComponent" /> -->
            
            <!-- Note: The following ComponentGroupRef is required to pull in generated authoring from project references. -->
            <ComponentGroupRef Id="Product.Generated" />
            <Feature Id="CapiFeature" Title="Capi" Level="1">
                <ComponentGroupRef Id="WebSite_Project"/>
                <ComponentGroupRef Id="Client_Project"/>                
            </Feature>
      
        </Feature>

    <!-- Prevent downgrading -->
    <CustomAction Id="PreventDowngrading" Error="Newer version already installed." />

    <!-- Sequences -->
    <InstallExecuteSequence>
      <Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
      <RemoveExistingProducts After="InstallFinalize" />
    </InstallExecuteSequence>

    <InstallUISequence>
      <Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
    </InstallUISequence>

    <UIRef Id="WixUI_Mondo" />
    <UIRef Id="WixUI_ErrorProgressText" />
        
<!--
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLLOCATION" />
    <UIRef Id="WixUI_InstallDir" />
-->
    
    </Product>
</Wix>
