<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

    <?include Variables.wxi?>
  
    <Product Id="$(var.ProductCode)"
           Language="1033"
           Name="$(var.ProductName)"
           Version="$(var.ProductVersion)" 
           Manufacturer="$(var.Manufacturer)" 
           UpgradeCode="$(var.UpgradeCode)">
        
    <Package InstallerVersion="200" 
             Compressed="yes"
             Description="Capi installation."/>
    
    <Upgrade Id="cc00bf47-7cbf-4bde-8fa1-905fa1916b1e">
      
      <UpgradeVersion Minimum="$(var.ProductVersion)" 
                      IncludeMinimum="no" 
                      OnlyDetect="yes" 
                      Language="1033"
                      Property="NEWPRODUCTFOUND" />

      <UpgradeVersion Minimum="0.0.0.0" 
                      IncludeMinimum="yes" 
                      Maximum="$(var.ProductVersion)" 
                      IncludeMaximum="no" 
                      Language="1033"
                      Property="UPGRADEFOUND" />
    </Upgrade>

    <Property Id="NEWPRODUCTFOUND" Secure="yes" />
    <Property Id="UPGRADEFOUND" Secure="yes" />


        <Property Id="ALLUSERS" Secure="yes" />

        <!-- Prerequisites -->
        <PropertyRef Id="NETFRAMEWORK40CLIENT"/>

        <Condition Message="This application requires .NET Framework 4.0. Please install the .NET Framework then run this installer again.">
            <![CDATA[Installed OR NETFRAMEWORK40CLIENT]]>
        </Condition>

        
        
        <Property Id='ASP_NET_MVC_4_0_DLL'>
            <DirectorySearch Id='MVC_DLL_DIR' Path='[ProgramFilesFolder]\Microsoft ASP.NET\ASP.NET MVC 4\Assemblies'>
                <FileSearch Id='MVC_DLL_FILE' Name='System.Web.Mvc.dll' MinVersion='4.0.20100'/>
            </DirectorySearch>
        </Property>

        <Condition Message='ASP.NET MVC 4 is required to proceed with the installation.'>
            <![CDATA[Installed OR ASP_NET_MVC_4_0_DLL]]>
        </Condition>
        
        <Property Id="APPCMDEXE">
            <DirectorySearch Id="IISExpressDir" Path="[ProgramFilesFolder]IIS Express">
                <FileSearch Name="appcmd.exe" />
            </DirectorySearch>
        </Property>

        <Condition Message="IIS Express 7.x must be installed before installation.">
            <![CDATA[Installed or APPCMDEXE]]>
        </Condition>

        
        
    <SetDirectory Id="WINDOWSVOLUME" Value="[WindowsVolume]"/>

        <Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />

       

        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="CommonAppDataFolder">
                <Directory Id="WINDOWSVOLUME">
                <Directory Id="TheWorldBank" Name="TheWorldBank">
                    <Directory Id="INSTALLLOCATION" Name="Capi">
                        <Directory Id="CLIENTDIR" Name="Client">
                        </Directory>
                        <Directory Id="ENGINEDIR" Name="Engine">
                        </Directory>
                    
                    <!-- TODO: Remove the comments around this Component element and the ComponentRef below in order to add resources to this installer. -->
                    <!-- <Component Id="ProductComponent" Guid="475a39d5-bd4b-4263-b551-08dfe9822eef"> -->
                        <!-- TODO: Insert files, registry keys, and other resources here. -->
                    <!-- </Component> -->
                </Directory>
               </Directory>
              </Directory>
            </Directory>
            
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="$(var.ProductName)"/>
            </Directory>            
            
            <Directory Id="DesktopFolder" Name="Desktop"/>
            
        </Directory>

      <Feature Id="ProductFeature" Title="Capi" Level="1" ConfigurableDirectory="INSTALLLOCATION">
            <!-- TODO: Remove the comments around this ComponentRef element and the Component above in order to add resources to this installer. -->
            <!-- <ComponentRef Id="ProductComponent" /> -->
            
            <!-- Note: The following ComponentGroupRef is required to pull in generated authoring from project references. -->
           
          
          <!-- <ComponentGroupRef Id="Product.Generated" />-->
          
            <Feature Id="CapiFeature" Title="Capi" Level="1">
                <ComponentGroupRef Id="WebSite_Project"/>
                <ComponentGroupRef Id="Client_Project"/>

                <ComponentRef Id="CapiApplicationShortcut"/>
                <ComponentRef Id="DesktopShortcutCapi"/>

            </Feature>
      
        </Feature>

    <!-- Prevent downgrading -->
    <CustomAction Id="PreventDowngrading" Error="Newer version already installed." />

    <!-- Sequences -->
    <InstallExecuteSequence>
      <Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
      <RemoveExistingProducts After="InstallFinalize" />
    </InstallExecuteSequence>

    <InstallUISequence>
      <Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
    </InstallUISequence>

    <UIRef Id="WixUI_Mondo" />
    <UIRef Id="WixUI_ErrorProgressText" />
        
<!--
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLLOCATION" />
    <UIRef Id="WixUI_InstallDir" />
-->
    
    </Product>
</Wix>
