@model WB.UI.WebTester.Controllers.InterviewPageModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section scripts {
    <script>
        window.CONFIG.hqLink = "null";
        window.CONFIG.splashScreen = true;
    </script>
    
    <div class="webtester">
        <div class="throbber-container" id="throbber">
        </div>
    </div>
    
    <script>
        const ANIMATION_INTERVAL = 50;
        (function() {
            var throbber = document.getElementById('throbber');
            var currentIndex = 0;
            var charCodes = [];

            // Build array: 0x26 to 0x49, then back from 0x49 to 0x26
            for (var i = 0x26; i <= 0x49; i++) {
                charCodes.push(i);
            }
            for (var i = 0x48; i >= 0x26; i--) {
                charCodes.push(i);
            }
            
            function rotateChar() {
                var charCode = charCodes[currentIndex];
                throbber.textContent = String.fromCharCode(charCode);
                
                currentIndex = (currentIndex + 1) % charCodes.length;
            }
            
            var intervalId = setInterval(rotateChar, ANIMATION_INTERVAL);
            
            // Clear interval when page unloads
            window.addEventListener('beforeunload', function() {
                clearInterval(intervalId);
            });
            
            // Expose cleanup function globally so it can be called before navigation
            window.clearThrobber = function() {
                clearInterval(intervalId);
            };
        })();
    </script>
}
@section footer{
    <script>
        const CHECK_INTERVAL = 3*1000;
        function checkStatus() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    if (xhr.responseText != "Loading") {
                        // Clear throbber interval before navigation
                        if (window.clearThrobber) {
                            window.clearThrobber();
                        }
                        window.location = '@Html.Raw(Url.Content("~/WebTester/Loading/" + Model?.Id))';
                    } else {
                        setTimeout(function() { checkStatus() }, CHECK_INTERVAL);
                    }
                }
            }
            xhr.open('GET', '@Url.Action("GetStatus", "WebTester", new {id = Model?.Id})', true);
            xhr.send(null);
        }
    
        checkStatus();
    </script>
}
