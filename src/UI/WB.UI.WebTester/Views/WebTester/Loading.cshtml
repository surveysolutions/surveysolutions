@model WB.UI.WebTester.Controllers.InterviewPageModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section scripts {
    <script>
        window.CONFIG.hqLink = "null";
        window.CONFIG.splashScreen = true;
    </script>
    
    <div class="webtester">
        <div class="throbber-container" id="throbber">
        </div>
    </div>
    
    <script>
        (function() {
            var throbber = document.getElementById('throbber');
            var currentIndex = 0;
            var charCodes = [];

            // Build array: 0x26 to 0x49, then back from 0x49 to 0x26
            for (var i = 0x26; i <= 0x49; i++) {
                charCodes.push(i);
            }
            for (var i = 0x48; i >= 0x26; i--) {
                charCodes.push(i);
            }
            
            function rotateChar() {
                var charCode = charCodes[currentIndex];
                throbber.textContent = String.fromCharCode(charCode);
                
                currentIndex = (currentIndex + 1) % charCodes.length;
            }
            
            setInterval(rotateChar, 50);
            
        })();
    </script>
}
@section footer{
    <script>
        function checkStatus() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    if (xhr.responseText != "Loading")
                        window.location = '@Html.Raw(Url.Content("~/WebTester/Loading/" + Model?.Id))'
                    else
                        setTimeout(function() { checkStatus() }, 30 * 1000);
                }
            }
            xhr.open('GET', '@Url.Action("GetStatus", "WebTester", new {id = Model?.Id})', true);
            xhr.send(null);
        }
    
        checkStatus();
    </script>
}
