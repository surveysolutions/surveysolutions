@using System.Web.Optimization
@using WB.Core.GenericSubdomains.Portable
@using WB.Core.GenericSubdomains.Utils
@using WB.Core.SharedKernels.DataCollection.ValueObjects.Interview
@using WB.Core.SharedKernels.SurveyManagement.Web.Code
@using WB.UI.Headquarters.Resources
@{
    this.Layout = "~/Views/Shared/_ControlPanelLayout.cshtml";
    this.ViewBag.Title = "Control Panel: Synchronization log";
}


@section scripts
{
    @Styles.Render("~/Content/bootstrap-datepicker3.css")
    @Styles.Render("~/css/list")
    @Scripts.Render("~/js/list", "~/js/synclog")
    <script type="text/javascript">
        var $interviewerPageUrl = '@Url.Action("Edit", "Interviewer")';
        var controlPanelSynclogUrl = '@Url.Action("SynchronizationLog", "ControlPanel")';
        var synchronizationLogUrl = '@Url.RouteUrl("DefaultApiWithAction", new { httproute = "", controller = "ControlPanelApi", action = "GetSynchronizationLog" })';
        var responsiblesUrl = '@Url.RouteUrl("DefaultApiWithAction", new { httproute = "", controller = "ControlPanelApi", action = "SyncLogInterviewers" })';
        var devicesUrl = '@Url.RouteUrl("DefaultApiWithAction", new { httproute = "", controller = "ControlPanelApi", action = "SyncLogDevices" })';
        $(function () {
            var viewModel = new Supervisor.VM.ControlPanel.SynchronizationLog(synchronizationLogUrl, controlPanelSynclogUrl, responsiblesUrl, devicesUrl);
            viewModel.load();
            ko.applyBindings(viewModel);
        });
    </script>
}

<h3 class="sinle-line-header">Synchronization log</h3>
<div class="panel panel-default">
    <div class="panel-body">
        <div class="btn-group">
            <div class="form-inline">
                <div class="input-group">
                    <input class="form-control" placeholder="Interviewer" data-bind="typeahead: SelectedResponsible, typeaheadOptions: {source: Responsibles, displayText: function(item){return item.UserName}}, valueupdate:'afterkeydown'" type="text" />
                    <span data-bind="spinner: IsResponsiblesLoading, spinnerOptions: { 'left': 1, 'right': '50px' }"></span>
                    <div class="input-group-btn" data-bind="click: function(){ SelectedResponsible(undefined); }">
                        <div class="btn btn-default"><span class=" glyphicon glyphicon-remove" aria-hidden="true"></span></div>
                    </div>
                </div>

                <div class="input-group">
                    <input class="form-control" placeholder="Device" data-bind="typeahead: SelectedDevice, typeaheadOptions: {source: Devices, displayText: function(item){return item}}, valueupdate:'afterkeydown'" type="text" />
                    <span data-bind="spinner: IsDevicesLoading, spinnerOptions: { 'left': 1, 'right': '50px' }"></span>
                    <div class="input-group-btn" data-bind="click: function(){ SelectedDevice(undefined); }">
                        <div class="btn btn-default"><span class=" glyphicon glyphicon-remove" aria-hidden="true"></span></div>
                    </div>
                </div>

                <div class="input-group date" data-bind="datepicker: FromDate, datepickerOptions: { format: 'mm/dd/yyyy', keyboardNavigation: false, autoclose: true, todayHighlight: true, startDate: '01/01/2015', endDate: '+0d', forseParse: false }">
                    <input id="date-picker-from" type="text" class="form-control" readonly="readonly">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                </div>

                <div class="input-group date" data-bind="datepicker: ToDate, datepickerOptions: { format: 'mm/dd/yyyy', keyboardNavigation: false, autoclose: true, todayHighlight: true, startDate: '01/01/2015', endDate: '+0d', forseParse: false }">
                    <input id="date-picker-from" type="text" class="form-control" readonly="readonly">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="list">
    <!-- ko if:IsPageLoaded()  -->
    <p class="text-center" data-bind="visible: Pager().TotalItemCount() == 0">
        @Pages.NoResults
    </p>
    <!-- /ko -->
    <div class="horizontal-scroll" data-bind="visible: Pager().TotalItemCount() > 0">
        <table class="table table-striped table-bordered table-condensed table-hover table-break-words">
            <thead>
                <tr>
                    <th data-bind='sortby: "LogDate"'>Log date</th>
                    <th data-bind='sortby: "InterviewerName"' style="min-width:120px">Interviewer</th>
                    <th data-bind='sortby: "DeviceId"'>Device</th>
                    <th>Log</th>
                </tr>
            </thead>
            <tbody>
                <!-- ko foreach:Items -->
                <tr>
                    <td data-bind="text: LogDate" nowrap></td>
                    <td>
                        <a data-bind="attr: { href: $interviewerPageUrl + '/' + InterviewerId() }, text: InterviewerName"></a>
                    </td>
                    <td data-bind="text: DeviceId"></td>
                    <td data-bind="html: Log"></td>
                </tr>
                <!-- /ko -->
            </tbody>
        </table>
    </div>
    <!-- ko if:Pager().LastPage() > 1 -->
    <div class="pagination pagination-right" data-bind="template: { name: 'tpl-pager', data: Pager }"></div>
    <!-- /ko -->
</div>

@Html.Partial("_ListViewPagingScript")
