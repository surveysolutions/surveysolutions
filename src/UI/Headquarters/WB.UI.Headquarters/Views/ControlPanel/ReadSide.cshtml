@{
    this.ViewBag.Title = "Control Panel: Read Side";
}

<h3>Read Side Control Panel</h3>

<pre id="statusArea" style="height: 500px; overflow-y: scroll;">
Requesting status...
</pre>

@Html.ActionLink("Rebuild All", "RebuildReadSide", new { }, new { @class = "btn btn-default" })
@Html.ActionLink("Stop", "StopReadSideRebuilding", new { }, new { @class = "btn btn-default" })

@section scripts
{
    <script type="text/javascript">

        function updateReadSideStatus() {
            return $.ajax({
                url: '@Url.Action("GetReadSideStatus")',
                data: { timestamp: new Date().getMilliseconds() }
            }).done(function (result) {
                $('#statusArea').text('Updated from server: ' + new Date().toTimeString() + '\r\n\r\n' + result);
            }).fail(function (xhr, status, error) {
                $('#statusArea').text(error + '\r\n' + xhr.responseText + '\r\n\r\nUpdated from server: ' + new Date().toTimeString());
            });
        }

        function updateReadSideStatusNeverending() {
            $.when(updateReadSideStatus()).always(function () {
                setTimeout(updateReadSideStatusNeverending, 1000);
            });
        }

        $(function () {
            updateReadSideStatusNeverending();
        });

    </script>
}