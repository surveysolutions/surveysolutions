@using Humanizer
@using WB.Core.SharedKernels.DataCollection.Exceptions
@{
    this.Layout = "~/Views/Shared/_ControlPanelLayout.cshtml";
    this.ViewBag.Title = "Control Panel: Broken interview packages";
}


@section scripts
{
    @Styles.Render("~/Content/bootstrap-datepicker3.css", "~/Scripts/dateRangePicker/daterangepicker.css")
    @Styles.Render("~/css/list")
    @Scripts.Render("~/js/list", "~/js/brokeninterviewpackages")
    <script type="text/javascript">
        var $interviewPageUrl = '@Html.Raw(@Url.Action("Review", "Interview", new {area = ""}, Request.Url.Scheme))';
        var controlPanelBrokenInperviewPackagesUrl = '@Html.Raw(@Url.Action("BrokenInterviewPackages", "ControlPanel", new { }, Request.Url.Scheme))';
        var brokenInperviewPackagesUrl = '@Url.RouteUrl("DefaultApiWithAction", new { httproute = "", controller = "ControlPanelApi", action = "GetBrokenInterviewPackages" })';
        var responsiblesUrl = '@Url.RouteUrl("DefaultApiWithAction", new { httproute = "", controller = "ControlPanelApi", action = "Interviewers" })';
        var questionnairesUrl = '@Url.RouteUrl("DefaultApiWithAction", new { httproute = "", controller = "ControlPanelApi", action = "Questionnaires" })';
        var reprocessSelectedUrl = '@Url.RouteUrl("DefaultApiWithAction", new { httproute = "", controller = "ControlPanelApi", action = "ReprocessSelectedBrokenPackages" })';
        var setExceptionTypeUrl = '@Url.RouteUrl("DefaultApiWithAction", new { httproute = "", controller = "ControlPanelApi", action = "MarkReasonAsKnown" })';
        var downloadPackageUrl = '@Url.RouteUrl("DefaultApiWithAction", new { httproute = "", controller = "ControlPanelApi", action = "DownloadSyncPackage" })';
        var knownReasons = [
            @foreach (InterviewDomainExceptionType val in Enum.GetValues(typeof(InterviewDomainExceptionType)))
            {
                <text>
                    { text: '@(val.Humanize())', value: '@((int)val)'},
                </text>
            }
        ];


        $(function () {
            var viewModel = new Supervisor.VM.ControlPanel.BrokenInterviewPackages(brokenInperviewPackagesUrl, controlPanelBrokenInperviewPackagesUrl, 
                null, responsiblesUrl, questionnairesUrl, reprocessSelectedUrl, setExceptionTypeUrl, knownReasons);
            viewModel.load();
            ko.applyBindings(viewModel);
        });
    </script>
}

@Html.Partial("_InterviewPackages")
