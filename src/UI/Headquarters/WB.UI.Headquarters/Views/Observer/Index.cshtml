@{
    Layout = "~/Views/Shared/_MainLayout.cshtml";
    ViewBag.Title = Users.Observers;
}

@section scripts
{
    @Scripts.Render("~/js/main-no-libs")
    @Scripts.Render("~/js/common")
    @Scripts.Render("~/js/list")
    @Scripts.Render("~/js/users")

    <script type="text/javascript">

        var observersListUrl =
            '@Url.RouteUrl("DefaultApiWithAction", new {httproute = "", controller = "UsersApi", action = "AllObservers"})';

        $(function() {
            var model = new Supervisor.VM.Users(observersListUrl);
            model.getDataTableColumns = function() {
                return [
                    {
                        data: "userName",
                        name: "UserName", // case-sensitive!
                        render: function(data, type, row) {
                            return "<a href='@Url.Action("Edit", "Observer")/" + row.userId + "'>" + data + "</a>";
                        }
                    },
                    {
                        data: "creationDate",
                        name: "CreationDate",
                        // case-sensitive! should be DB name here from Designer DB questionnairelistviewitems? to sort column
                        "class": "date"
                    },
                    {
                        data: "email",
                        name: "Email",
                        // case-sensitive! should be DB name here from Designer DB questionnairelistviewitems? to sort column
                        render: function(data, type, row) {
                            return data ? "<a href='mailto:" + data + "'>" + data + "</a>" : "";
                        }
                    }
                ];
            };

            model.onTableInitComplete = function() {
                $('.dataTables_filter label')
                    .on('click',
                        function(e) {
                            if (e.target !== this)
                                return;
                            if ($(this).hasClass("active")) {
                                $(this).removeClass("active");
                            } else {
                                $(this).addClass("active");
                                $(this)
                                    .children("input[type='search']")
                                    .delay(200)
                                    .queue(function() {
                                        $(this).focus();
                                        $(this).dequeue();
                                    });
                            }
                        });
            };

            ko.applyBindings(model);
            model.load();
        });
    </script>
}
<main>
    <div class="container-fluid">
        <div class="row">
            @Html.Partial("_alerts")
            <div class="page-header clearfix">
                <div>
                    <h1>@Users.Observers</h1>
                    <a class="btn btn-success" href="@Url.Action("Create", "Observer", new {area = string.Empty})">@Users.AddObserver</a>
                    <h1 style="margin-left: 20px;">@Html.Raw(string.Format(Users.ObserversCountDescription, @"<span data-bind='text: UsersCount'></span>"))</h1>
                </div>
            </div>
            <div class="col-sm-6 col-xs-10 prefilled-data-info info-block">
            </div>
        </div>


        <table id="data_holder" class="table table-striped table-bordered table-condensed table-hover table-ordered" 
               data-order="[[ 0, &quot;asc&quot; ]]" data-searching="true">
            <thead>
            <tr>
                <th>@Users.UserName</th>
                <th title="@Users.AccountCreationDateTooltip">@Users.CreationDate</th>
                <th>@Users.ObserversEmail</th>
            </tr>
            </thead>
        </table>
    </div>
</main>