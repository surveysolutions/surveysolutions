@model WB.UI.Headquarters.Controllers.AuditLogModel

@{
    ViewBag.Title = AuditLog.PageTitle;
    Layout = "~/Views/Shared/_MainLayout.cshtml";
}

@section scripts
{
    @Scripts.Render("~/js/list", "~/js/syslog")
 
    <script type="text/javascript">
        
        var systemLogUrl = '@Url.Action("Index", "AuditLog")';
        var dataUrl = '@Url.RouteUrl("DefaultApiWithAction", new { httproute = "", controller = "AdminSettings", action = "GetSystemLog" })';

        $(function () {
            var viewModel = new Supervisor.VM.ControlPanel.SystemLog(dataUrl, systemLogUrl);
            viewModel.load();
            ko.applyBindings(viewModel);
        });

    </script>
}

<main class="main">
    <div class="container-fluid">
        <div class="row">
            <div class="page-header">
                <h1>@AuditLog.PageTitle</h1>
            </div>
            @Html.Partial("_alerts")
        </div>
        <div class="row">
            <div id="list">
                <!-- ko if:IsPageLoaded()  -->
                <p class="text-center" data-bind="visible: Pager().TotalItemCount() == 0">
                    @AuditLog.Empty
                </p>
                <!-- /ko -->
                <div class="horizontal-scroll" data-bind="visible: Pager().TotalItemCount() > 0">
                    <table class="table table-striped table-bordered table-condensed table-hover table-break-words">
                        <thead>
                            <tr>
                                <th data-bind='sortby: "LogDate"'>Log date</th>
                                <th data-bind='sortby: "UserName"' style="min-width:120px">User</th>
                                <th>Event type</th>
                                <th>Log</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- ko foreach:Items -->
                            <tr>
                                <td data-bind="text: LogDate" nowrap></td>
                                <td data-bind="text: UserName"></td>
                                <td data-bind="text: Type"></td>
                                <td data-bind="html: Log"></td>
                            </tr>
                            <!-- /ko -->
                        </tbody>
                    </table>
                </div>
                <!-- ko if:Pager().LastPage() > 1 -->
                <div class="pagination pagination-right" data-bind="template: { name: 'tpl-pager', data: Pager }"></div>
                <!-- /ko -->
            </div>

            @Html.Partial("_ListViewPagingScript")

        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-sm-12">

                @if (Model.Log.Length > 0)
                {
                    <a href="javascript:void(0);" onclick="document.getElementById('oldLog').style.display = 'block';">
                        Old Log
                    </a>

                    <ul class="list-unstyled" style="display: none" id="oldLog">
                        @foreach (var entry in Model.Log)
                        {
                            <li>@entry</li>
                        }
                    </ul>
                }
            </div>
        </div>
    </div>
</main>
