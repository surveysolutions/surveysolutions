@using System.Web.Optimization
@{
    Layout = "~/Views/Shared/_NoFilterListViewLayout.cshtml";
}

@section scripts
{
    @Scripts.Render("~/Scripts/viewmodels/pages/questionnaires.js")
    <script type="text/javascript">
        var $getExportedDataUrl = '@Url.Action("GetExportedData", "ImportExport")';
        var $getExportedFilesUrl = '@Url.Action("GetExportedFiles", "ImportExport")';
        var $newInterviewUrl = '@Url.Action("TakeNew", "HQ")';
        var $batchUploadUrl = '@Url.Action("BatchUpload", "HQ")';
        var $importTemplateUrl = '@Url.Action("Import", "Template")';
        $(function() {
            var questionnairesUrl = '@Url.RouteUrl("DefaultApiWithAction", new {httproute = "", controller = "QuestionnairesApi", action = "AllQuestionnaires"})';
            var deleteQuestionnaireUrl = '@Url.RouteUrl("DefaultApiWithAction", new {httproute = "", controller = "QuestionnairesApi", action = "DeleteQuestionnaire"})';

            var model = new Supervisor.VM.Questionnaires(questionnairesUrl, deleteQuestionnaireUrl);

            ko.applyBindings(model);
            model.load();
        });
    </script>
}

@section header
{
    <h3 class="sinle-line-header">Questionnaires</h3>
}

@section gridnavigation
{
    <div class="btn-group">
        <div class="form-inline">
            <a class="btn btn-default" data-bind="attr: { href: $importTemplateUrl }">
                <i class="glyphicon glyphicon-import">
                </i> Import template
            </a>
        </div>
    </div>
}

@section grid
{
    <table class="table table-striped table-bordered table-condensed table-hover">
        <thead>
            <tr>
                <th class="fit-column-by-content" data-bind='sortby : "AllowCensusMode"'>Census</th>
                <th data-bind='sortby : "Title"'>Title</th>
                <th data-bind='sortby : "Version"'>Version</th>
                <th data-bind='sortby : "CreationDate"'>Creation Date</th>
                <th data-bind='sortby : "LastEntryDate"'>Last Entry Date</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <!-- ko foreach:Items -->
            <tr>
                <td>
                    <!-- ko if:AllowCensusMode -->
                    <span class="glyphicon glyphicon-ok pull-right margin-right-5"></span>
                    <!-- /ko -->
                </td>
                <td data-bind="text: Title"></td>
                <td data-bind="text: Version"></td>
                <td data-bind="date: CreationDate"></td>
                <td data-bind="date: LastEntryDate"></td>
                <td>
                    <!-- ko ifnot:AllowCensusMode -->
                    <a class="btn btn-primary" data-bind="attr: { href: $batchUploadUrl + '/' + QuestionnaireId() + '?version=' + Version() }">
                        <i class="icon-white"></i>Batch upload
                    </a>
                    <a class="btn btn-primary" data-bind="attr: { href: $newInterviewUrl + '/' + QuestionnaireId() + '?version=' + Version() }">
                        <i class="glyphicon glyphicon-plus-sign"></i> New Interview
                    </a>
                    <!-- /ko -->
                </td>
                <td>
                    <a class="btn btn-success" data-bind="attr: { href: $getExportedDataUrl + '/' + QuestionnaireId() + '?version=' + Version() }">
                        <i class=" glyphicon glyphicon-download">
                        </i> CSV
                    </a>
                    <a class="btn btn-success" data-bind="attr: { href: $getExportedFilesUrl + '/' + QuestionnaireId() + '?version=' + Version() }">
                        <i class=" glyphicon glyphicon-download">
                        </i> Binary data
                    </a>
                    <a class="btn btn-danger" data-bind="click : $parent.deleteQuestionnaire">
                        <i class="glyphicon"></i> Delete
                    </a>
                </td>
            </tr>
            <!-- /ko -->
        </tbody>
    </table>
}