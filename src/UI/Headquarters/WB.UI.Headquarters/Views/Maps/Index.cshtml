@using WB.Core.BoundedContexts.Headquarters.Services
@using WB.Core.GenericSubdomains.Portable.ServiceLocation
@model WB.UI.Headquarters.Controllers.MapsUploadModel

@{
    Layout = "~/Views/Shared/_MainLayout.cshtml";
    ViewBag.Title = Dashboard.Maps;

    var authorizedUser = ServiceLocator.Current.GetInstance<IAuthorizedUser>();
    var isObserver = authorizedUser.IsObserver;
    var isAdmin = authorizedUser.IsAdministrator;
}

@section scripts
{
    @Scripts.Render("~/js/main-no-libs")
    @Scripts.Render("~/js/common")
    @Scripts.Render("~/js/list")
    @Scripts.Render("~/js/maps")
    
    <script type="text/javascript">
        var mapsListUrl =
            '@Url.RouteUrl("DefaultApiWithAction", new {httproute = "", controller = "MapsApi", action = "Maps"})';

        var notifier = new Notifier();
        var ajax = new Ajax(notifier);

        $(function() {
            var model = new Supervisor.VM.Maps(mapsListUrl, notifier, ajax);

            model.getDataTableColumns = function() {
                return [
                    {
                        data: "fileName",
                        name: "FileName", // case-sensitive!
                        "class": "title"
                    },
                    {
                        data: "size",
                        name: "Size",// case-sensitive! should be DB name here from Designer DB questionnairelistviewitems? to sort column
                        "class": "parameters"
                    },
                    {
                        data: "minScale",
                        name: "MinScale",// case-sensitive! should be DB name here from Designer DB questionnairelistviewitems? to sort column
                        "class": "parameters"
                    },
                    {
                        data: "maxScale",
                        name: "MaxScale",// case-sensitive! should be DB name here from Designer DB questionnairelistviewitems? to sort column
                        "class": "parameters"
                    },
                    {
                        data: "importDate",
                        name: "ImportDate",// case-sensitive! should be DB name here from Designer DB questionnairelistviewitems? to sort column
                        "class": "date"
                    }
                ];
            };

            ko.applyBindings(model);
            model.load();
        });
</script>

}

<main>
    <div class="container-fluid">
        <div class="row">
            @Html.Partial("_alerts")
            <div class="page-header clearfix">
                <div class="neighbor-block-to-search">
                    <div class="topic-with-button">
                        <h1>@MainMenu.Maps</h1>
                    </div>
                    
                    @if (!isObserver)
                    {
                        using (Html.BeginForm("UploadMaps", "Maps", method: FormMethod.Post, htmlAttributes: new {enctype = "multipart/form-data", id = "MapsUploadForm" }))
                        {
                            @Html.AntiForgeryToken()
                                 
                            @Html.Partial("ClientTimezoneOffset")
                            <label class="btn btn-success btn-file">
                                @BatchUpload.UploadZipFile
                                @Html.TextBoxFor(m => m.File, new {type = "file", accept = ".zip", onchange = "this.form.submit()"})
                            </label>
                            @Html.ValidationMessageFor(x => x.File, null, new {@class = "help-block"})
                        }

                        <div>
                            <p>Upload zip archive containing maps. </p>
                            <p>Files with same name will be overridden.</p>
                        
                        </div>
                    }
                </div>
                
            </div>
        </div>
        <div id="list">
            <table id="data_holder" class="table table-striped table-bordered table-hover table-ordered"
                   data-order="[[ 1, &quot;asc&quot; ]]" data-searching="true">
                <thead>
                    <tr>
                        <th>@Maps.Name</th>
                        <th>@Maps.Size</th>
                        <th>@Maps.MinScale</th>
                        <th>@Maps.MaxScale</th>
                        <th>@Maps.UpdateDate</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</main>
