@using System.Web.Optimization
@using WB.Core.BoundedContexts.Headquarters.UserPreloading.Dto
@model string
@{
    Layout = "~/Views/Shared/_LayoutWithoutSidebar.cshtml";
}
<div class="row-fluid" data-bind="visible: isDeleted()">
    <h3>
        @BatchUpload.UserPreloadingProcessIsMissing
    </h3>
</div>
<div class="row-fluid" data-bind="visible: !isDeleted()">

    <h3 data-bind="visible: state()==@((int) UserPrelodingState.CreatingUsers) || state()==@((int) UserPrelodingState.ReadyForUserCreation)">
        <b data-bind="text: createdUsersCount"></b> @BatchUpload.OutOf <b data-bind="text: recordsCount"></b> @BatchUpload.UsersHaveBeenCreated
    </h3>
    <div data-bind="visible: state()==@((int) UserPrelodingState.CreatingUsers) || state()==@((int) UserPrelodingState.ReadyForUserCreation)">
        @using (Html.BeginForm("RefreshCreateUsers", "BatchUserUpload"))
            {
            @Html.AntiForgeryToken()
            @Html.Hidden("Id", Model)
            <input type="submit" class="btn btn-default btn-primary pull-right" name="Submit" value="@BatchUpload.RefreshActionOnUserUpload" />
        }
    </div>

    <div data-bind="visible: state()==@((int) UserPrelodingState.Finished)">
        <h3>@BatchUpload.All <b data-bind="text: recordsCount"></b> @BatchUpload.UsersHaveBeenCreated</h3>
        @Html.ActionLink(BatchUpload.BrowseTeams, "Index", "Supervisor", null, new { @class = "btn btn-default btn-primary" })
    </div>

    <div data-bind="visible: state()==@((int)UserPrelodingState.FinishedWithError)">
        <h3>@BatchUpload.FinishedWithErrorMessage <span data-bind="text: errorMessage"></span></h3>
        <b data-bind="text: createdUsersCount"></b> @BatchUpload.OutOf <b data-bind="text: recordsCount"></b> @BatchUpload.UsersHaveBeenCreated
        @Html.ActionLink(BatchUpload.UploadNewFile, "NewUserBatchUpload", null, new { @class = "btn btn-default btn-primary" })
    </div>
</div>

@section scripts
{
    @Scripts.Render("~/js/preloading")
    <script type="text/javascript">
        var updateVerificationStatusApiUrl = '@(Url.RouteUrl("DefaultApiWithAction", new {httproute = "", controller = "UserPreloading", action = "UserPreloadingDetails"})+"/"+Model)';
        var viewModel = new Supervisor.VM.Preloading.UserPreloading(updateVerificationStatusApiUrl, [@((int)UserPrelodingState.CreatingUsers), @((int)UserPrelodingState.ReadyForUserCreation)]);
        viewModel.load();

        ko.applyBindings(viewModel);
    </script>
}
