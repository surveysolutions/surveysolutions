@using System.Web.Optimization
@using WB.Core.BoundedContexts.Headquarters.UserPreloading.Dto
@using WB.Core.SharedKernels.SurveyManagement.Views.PreloadedData
@using WB.Core.SharedKernels.SurveyManagement.Views.SampleImport
@using WB.Core.SharedKernels.SurveyManagement.Views.User
@model string
@{
    Layout = "~/Views/Shared/_LayoutWithoutSidebar.cshtml";
}
<div class="row-fluid">

    <h3 data-bind="visible: state()==@((int)UserPrelodingState.CreatingUsers) || state()==@((int)UserPrelodingState.ReadyForUserCreation)"><b data-bind="text: createdUsersCount"></b> @BatchUpload.OutOf <b data-bind="text: recordsCount"></b> @BatchUpload.UsersHaveBeenCreated</h3>

    <div data-bind="visible: state()==@((int) UserPrelodingState.Finished)">
        <h3>@BatchUpload.All <b data-bind="text: recordsCount"></b> @BatchUpload.UsersHaveBeenCreated</h3>
        @Html.ActionLink(BatchUpload.BrowseTeams, "Index","Supervisor", null, new { @class = "btn btn-default btn-primary" })
    </div>

    <div data-bind="visible: state()==@((int)UserPrelodingState.FinishedWithError)">
        <h3>@BatchUpload.FinishedWithError <span data-bind="text: errorMessage"></span></h3>
        <b data-bind="text: createdUsersCount"></b> @BatchUpload.OutOf <b data-bind="text: recordsCount"></b> @BatchUpload.UsersHaveBeenCreated
        @Html.ActionLink(BatchUpload.UploadNewFile, "NewUserBatchUpload", null, new { @class = "btn btn-default btn-primary" })
    </div>
</div>

@section scripts
{
    @Scripts.Render("~/Scripts/components/bindings.js", "~/Scripts/pages/userpreloading.js")
    <script type="text/javascript">
        var updateVerificationStatusApiUrl = '@(Url.RouteUrl("DefaultApiWithAction", new {httproute = "", controller = "PreloadingApi", action = "UserPreloadingDetails"})+"/"+Model)';
        var viewModel = new Supervisor.VM.Preloading.UserPreloading(updateVerificationStatusApiUrl, [@((int)UserPrelodingState.CreatingUsers), @((int)UserPrelodingState.ReadyForUserCreation)]);
        viewModel.load();

        ko.applyBindings(viewModel);
    </script>
}
