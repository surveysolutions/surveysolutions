<template>
    <HqLayout :title="$t('Pages.InterviewersAndDevicesTitle')">
        <DataTables ref="table" :tableOptions="tableOptions" exportable hasTotalRow></DataTables>
    </HqLayout>
</template>

<script>
export default {
    mounted() {
        this.$refs.table.reload();
    },
    methods: {
        renderCell: function(data, row, facet){
            const formatedNumber = this.formatNumber(data);
            if(data === 0 || row.DT_RowClass == "total-row") {
                return `<span>${formatedNumber}</span>`;
            }
            if (row.teamId === '00000000-0000-0000-0000-000000000000') {
                if (facet) {
                    return `<a href='${this.$config.model.interviewersBaseUrl}?Facet=${facet}'>${formatedNumber}</a>`;
                }
                else {
                    return `<span>${formatedNumber}</span>`;
                }
            }
            if(facet) {
                return `<a href='${this.$config.model.interviewersBaseUrl}?supervisor=${row.teamName}&Facet=${facet}'>${formatedNumber}</a>`;
            }
            else {
                 return `<a href='${this.$config.model.interviewersBaseUrl}?supervisor=${row.teamName}'>${formatedNumber}</a>`;
            }
        }        ,
        formatNumber(value) {
            if (value == null || value == undefined)
                return value;
            var language = navigator.languages && navigator.languages[0] ||
               navigator.language ||  
               navigator.userLanguage; 
            return value.toLocaleString(language);
        }
    },
    computed: {
        config() {
            return this.$config.model;
        },
        tableOptions() {
            var self = this;
            return {
                deferLoading: 0,
                columns: [
                    {
                        data: "teamName",
                        name: "TeamName",
                        title: this.$t("DevicesInterviewers.Teams"),
                        orderable: true,
                        render: function(data, type, row) {
                            return self.renderCell(data, row, null);
                        }
                    },
                    {
                        data: "neverSynchedCount",
                        name: "NeverSynchedCount",
                        "class": "type-numeric",
                        title: this.$t("DevicesInterviewers.NeverSynchronized"),
                        orderable: true,
                        render: function (data, type, row) {
                            return self.renderCell(data, row, 'NeverSynchonized');
                        }
                    },
                    {
                        data: "noQuestionnairesCount",
                        name: "NoQuestionnairesCount",
                        "class": "type-numeric",
                        orderable: true,
                        title: this.$t("DevicesInterviewers.NoAssignments"),
                        render: function(data, type, row) {
                            return self.renderCell(data, row, 'NoAssignmentsReceived');
                        }
                    },
                    {
                        data: "neverUploadedCount",
                        name: "NeverUploadedCount",
                        "class": "type-numeric",
                        orderable: true,
                        title: this.$t("DevicesInterviewers.NeverUploaded"),
                        render: function(data, type, row) {
                             return self.renderCell(data, row, 'NeverUploaded');
                        }
                    },
                    {
                        data: "reassignedCount",
                        name: "ReassignedCount",
                        "class": "type-numeric",
                        orderable: true,
                        title: this.$t("DevicesInterviewers.TabletReassigned"),
                        render: function(data, type, row) {
                            return self.renderCell(data, row, 'TabletReassigned');
                        }
                    },
                    {
                        data: "outdatedCount",
                        name: "OutdatedCount",
                        "class": "type-numeric",
                        orderable: true,
                        title: this.$t("DevicesInterviewers.OldInterviewerVersion"),
                        render: function (data, type, row) {
                            return self.renderCell(data, row, 'OutdatedApp');
                        }
                    },
                    {
                        data: "oldAndroidCount",
                        name: "OldAndroidCount",
                        "class": "type-numeric",
                        orderable: true,
                        title: this.$t("DevicesInterviewers.OldAndroidVersion"),
                        render: function(data, type, row) {
                            return self.renderCell(data, row, 'OldAndroid');
                        }
                    },
                    {
                        data: "lowStorageCount",
                        name: "LowStorageCount",
                        "class": "type-numeric",
                        orderable: true,
                        title: this.$t("DevicesInterviewers.LowStorage"),
                        render: function(data, type, row) {
                            return self.renderCell(data, row, 'LowStorage');
                        }
                    },
                    {
                        data: "teamSize",
                        name: "TeamSize",
                        "class": "type-numeric",
                        orderable: true,
                        title: this.$t("DevicesInterviewers.TeamSize")
                    }
                ],
                ajax: {
                    url: this.$config.model.dataUrl,
                    type: "GET",
                    contentType: 'application/json'
                },
                responsive: false,
                order: [[0, 'asc']],
                sDom: 'rf<"table-with-scroll"t>ip'
            }
        }
    }
}
</script>
