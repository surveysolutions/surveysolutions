@using System.Linq
@model WB.Core.BoundedContexts.Designer.Views.Questionnaire.Pdf.PdfQuestionnaireModel

@{
    Layout = null;
    var questionnaire = Model;
    ViewBag.Questionnaire = questionnaire;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>@questionnaire.Title</title>
    @Styles.Render("~/Content/pdf.css")
</head>
<body>
    <header>
        <div class="column_header authors">
            <ul>
                <li>This PDF generated by @questionnaire.Requested.By, <span>@questionnaire.Requested.On</span></li>
                <li>Questionnaire created by @questionnaire.Created.By, <span>@questionnaire.Created.On</span></li>
                <li>Last modified by @questionnaire.LastModified.By, <span>@questionnaire.LastModified.On</span></li>
            </ul>
            @if (questionnaire.SharedPersons.Count() != 0)
            {
                <div>Shared with:</div>
                <ul>
                    @foreach (var person in questionnaire.SharedPersons)
                    {
                        <li>@person.Name <span>(last edited @person.On)</span></li>
                    }
                </ul>
            }
            else
            {
                <div>Not shared with anyone</div>
            }
        </div>
        <div class="column_header">
            <ul>
                <li>
                    <ul class="group-statistics">
                        <li>Sections: <span>@questionnaire.Statistics.SectionsCount</span></li>
                        <li>Sub-sections: <span>@questionnaire.Statistics.GroupsCount</span></li>
                        <li>Question: <span>@questionnaire.Statistics.QuestionsCount</span></li>
                    </ul>
                </li>
                <li>Questions with conditions: <span>@questionnaire.Statistics.QuestionsWithConditionsCount</span></li>
                <li>Rosters: <span>@questionnaire.Statistics.RostersCount</span></li>
            </ul>
        </div>
        <div class="column_header">
            <a href="https://solutions.worldbank.org/" target="_blank" class="logo">
                <img src="~/Content/images/pdf_logo.png" alt="Survey Solutions" />
            </a>
        </div>

    </header>
    <article>
        <section class="questionnaire_info">
            <div class="questionnaire_title">
                <h1>@questionnaire.Title</h1>
            </div>
        </section>
        <section class="table_of_contents">
            <dl>
                @foreach (var sectionId in questionnaire.SectionIds)
                {
                    var statistics = questionnaire.GetGroupStatistics(sectionId);
                    <dt>&nbsp;</dt>
                    <dd>
                        <a href="#group-@sectionId" class="section_name">@questionnaire.GetGroupTitle(sectionId)</a>
                        <ul class="group-statistics">
                            @if (statistics.GroupsCount > 0)
                            {
                                <li>Sub-sections: <span>@statistics.GroupsCount</span></li>
                            }
                            else
                            {
                                <li>No sub-sections</li>
                            }
                            @if (statistics.RostersCount > 0)
                            {
                                <li>Rosters: <span>@statistics.RostersCount</span></li>
                            }
                            else
                            {
                                <li>No rosters</li>
                            }
                            @if (statistics.QuestionsCount > 0)
                            {
                                <li>Questions: <span>@statistics.QuestionsCount</span></li>
                            }
                            else
                            {
                                <li>No questions</li>
                            }
                            @if (statistics.StaticTextsCount > 0)
                            {
                                <li>Static texts: <span>@statistics.StaticTextsCount</span></li>
                            }
                        </ul>
                    </dd>
                }
                <dt>&nbsp;</dt>
                <dd>
                    <a href="#appendix_enablements" class="section_name appendix">Appendix a &#8212; full sets and expressions</a>
                </dd>
                <dt>&nbsp;</dt>
                <dd>
                    <a href="#appendix_validations" class="section_name appendix">Appendix a &#8212; full sets and expressions</a>
                </dd>
                <dt>&nbsp;</dt>
                <dd>
                    <a href="#appendix_instructions" class="section_name appendix">Appendix a &#8212; full sets and expressions</a>
                </dd>
                <dt>&nbsp;</dt>
                <dd>
                    <a href="#appendix_options" class="section_name appendix">Appendix a &#8212; full sets and expressions</a>
                </dd>
                @*<dt>&nbsp;</dt>
                    <dd>
                        <a href="#appendix_b" class="section_name appendix">Appendix b &#8212; Export structure</a>
                    </dd>*@
            </dl>
        </section>
    </article>
    <article class="help_info">
        <img src="~/Content/images/PDF-structure.png" />
    </article>
    <article>
        @foreach (var sectionId in questionnaire.SectionIds)
        {
            <section class="section">
                <div class="section_header">
                    <h2 id="group-@sectionId">@questionnaire.GetGroupTitle(sectionId)</h2>
                </div>
                @Html.Partial("_RenderChildren", sectionId)
            </section>
        }
    </article>
    <article class="appendix_section">
        <h2 id="appendix_enablements">Appendix a &mdash; Enablement conditions</h2>
        <ul class="container">
            @{
                var questionsWithLongConditions = questionnaire.GetQuestionsWithLongConditions();
                for (var i = 0; i < questionsWithLongConditions.Count(); i++)
                {
                    var question = questionsWithLongConditions[i];
                    <li>
                        <span class="number">[@(i + 1)]</span>
                        <div class="appendix_detail">
                            <a href="#question-@question.PublicKey" id="condition-@question.PublicKey">
                                <span>@question.StataExportCaption</span>: @question.QuestionText
                            </a>
                            <p>
                                Enablement Condition:
                                <pre>@question.ConditionExpression.Trim()</pre>
                            </p>
                        </div>
                    </li>
                }
            }
        </ul>
    </article>
    <article class="appendix_section">
        <h2 id="appendix_validations">Appendix b &mdash; Validation conditions and messages</h2>
        <ul class="container">
            @{
                var questionsWithLongValidations = questionnaire.GetQuestionsWithLongValidations();
                for (var i = 0; i < questionsWithLongValidations.Count(); i++)
                {
                    var question = questionsWithLongValidations[i];
                    <li>
                        <span class="number">[@(i + 1)]</span>
                        <div class="appendix_detail">
                            <a href="#question-@question.PublicKey" id="validation-@question.PublicKey">
                                <span>@question.StataExportCaption</span>: @question.QuestionText
                            </a>
                            @foreach (var validationCondition in question.ValidationConditions)
                            {
                                <p>
                                    Validation Condition:
                                    <pre>@validationCondition.Expression.Trim()</pre>
                                </p>
                                <p>
                                    Validation Message:
                                    <span>@validationCondition.Message</span>
                                </p>
                            }
                        </div>
                    </li>
                }
            }
        </ul>
    </article>
    <article class="appendix_section">
        <h2 id="appendix_instructions">Appendix c &mdash; Instructions</h2>
        <ul class="container">
            @{
                var questionsWithLongInstructions = questionnaire.GetQuestionsWithLongInstructions();
                for (var i = 0; i < questionsWithLongInstructions.Count(); i++)
                {
                    var question = questionsWithLongInstructions[i];
                    <li>
                        <span class="number">[@(i + 1)]</span>
                        <div class="appendix_detail">
                            <a href="#question-@question.PublicKey" id="instruction-@question.PublicKey">
                                <span>@question.StataExportCaption</span>: @question.QuestionText
                            </a>
                            <p>
                                @question.Instructions
                            </p>
                        </div>
                    </li>
                }
            }
        </ul>
    </article>
    <article class="appendix_section">
        <h2 id="appendix_options">Appendix d &mdash; Options</h2>
        <ul class="container">
            @{
                var questionsWithLongOptionsList = questionnaire.GetQuestionsWithLongOptionsList();
                for (var i = 0; i < questionsWithLongOptionsList.Count(); i++)
                {
                    var question = questionsWithLongOptionsList[i];
                    <li>
                        <span class="number">[@(i + 1)]</span>
                        <div class="appendix_detail">
                            <a href="#question-@question.PublicKey" id="options-@question.PublicKey">
                                <span>@question.StataExportCaption</span>: @question.QuestionText
                            </a>
                            <p>
                                Options:
                                @foreach (var option in question.Answers)
                                {
                                    <span><span>@option.AnswerValue:</span>@(option.AnswerText),</span>
                                }
                            </p>
                        </div>
                    </li>
                }
            }
        </ul>
    </article>
</body>
</html>
