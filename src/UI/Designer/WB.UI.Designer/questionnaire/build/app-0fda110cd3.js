!function(e){"use strict";angular.module("designerApp",["ngCookies","ngSanitize","ngResource","ngAnimate","ui.bootstrap","ui.bootstrap.tpls","ui.tree","ui.utils","jlareau.pnotify","ui.router","angular-loading-bar","cfp.hotkeys","blockUI","unsavedChanges","monospaced.elastic","perfect_scrollbar","ng-context-menu","ui.ace","templates","ngFileUpload","angularMoment"]),angular.module("designerApp").config(["$stateProvider","$urlRouterProvider","$rootScopeProvider","$locationProvider",function(e,t,r,n){r.digestTtl(12),e.state("questionnaire",{url:"/{questionnaireId}",templateUrl:"views/main.v1.html",controller:"MainCtrl"}).state("questionnaire.chapter",{url:"/chapter/{chapterId}",views:{"":{templateUrl:"views/tree.html",controller:"TreeCtrl"}}}).state("questionnaire.chapter.question",{url:"/question/{itemId}",params:{property:"None",indexOfEntityInProperty:null},views:{"":{templateUrl:"views/question.html",controller:"QuestionCtrl"}}}).state("questionnaire.chapter.group",{url:"/group/{itemId}",params:{property:"None",indexOfEntityInProperty:null},views:{"":{templateUrl:"views/group.html",controller:"GroupCtrl"}}}).state("questionnaire.chapter.variable",{url:"/variable/{itemId}",params:{property:"None",indexOfEntityInProperty:null},views:{"":{templateUrl:"views/variable.html",controller:"VariableCtrl"}}}).state("questionnaire.chapter.roster",{url:"/roster/{itemId}",params:{property:"None",indexOfEntityInProperty:null},views:{"":{templateUrl:"views/roster.html",controller:"RosterCtrl"}}}).state("questionnaire.chapter.statictext",{url:"/static-text/{itemId}",params:{property:"None",indexOfEntityInProperty:null},views:{"":{templateUrl:"views/static-text.v1.html",controller:"StaticTextCtrl"}}}),n.html5Mode({enabled:!0,requireBase:!1})}]).config(["$httpProvider",function(e){e.interceptors.push("errorReportingInterceptor"),e.interceptors.push("authorizationInterceptor")}]).config(["blockUIConfig",function(e){e.message="Please wait...",e.autoBlock=!1}]).config(["unsavedWarningsConfigProvider",function(e){e.routeEvent="$stateChangeStart"}]).config(["cfpLoadingBarProvider",function(e){e.spinnerTemplate='<div id="loading-logo"></div>'}]).config(["$qProvider",function(e){e.errorOnUnhandledRejections(!1)}]),angular.module("templates",[])}(jQuery);
$(document).on("shown.bs.dropdown.position-calculator",function(t,o){var e=$(".dropdown-menu",t.target);if(!e.parent().hasClass("dropup")){var a=o.relatedTarget;e.css({top:0,left:0});var r=new $.PositionCalculator({item:e,target:a,itemAt:"top left",itemOffset:{y:3,x:0,mirror:!0},targetAt:"bottom left",flip:"both"}),l=r.calculate();e.css({top:l.moveBy.y+"px",left:l.moveBy.x+"px"})}});
angular.module("designerApp").controller("AttachmentsCtrl",["$rootScope","$scope","$state","hotkeys","commandService","utilityService","confirmService","Upload","$uibModal","notificationService","moment",function(t,e,n,a,i,o,c,s,l,r,d){"use strict";e.downloadLookupFileBaseUrl="../../attachments",e.benchmarkDownloadSpeed=20,e.isReadOnlyForUser=!1;var m=1024;a.get("ctrl+shift+a")!==!1&&a.del("ctrl+shift+a"),a.add("ctrl+shift+a","Close attachments panel",function(t){t.preventDefault(),e.foldback()}),e.attachments=[],e.totalSize=function(){return _.reduce(e.attachments,function(t,e){return t+(e.content.size||0)},0)},e.estimatedLoadingTime=function(){return Math.floor(e.totalSize()/e.benchmarkDownloadSpeed)},e.isTotalSizeTooBig=function(){return e.totalSize()>52428800},e.isAttachmentSizeTooBig=function(t){return t.content.size>5242880},e.isAttachmentResolutionTooBig=function(t){return(t.content.details.height||0)>1024||(t.content.details.width||0)>1024};var u=function(t,e){t.initialAttachment=angular.copy(e),t.attachmentId=e.attachmentId,t.name=e.name,t.file=null,t.content={},t.meta={},t.content.details={},_.isUndefined(e.content)||_.isNull(e.content)||(t.content.size=e.content.size,t.content.type=e.content.contentType,_.isUndefined(e.content.details)||_.isNull(e.content.details)||(t.content.details.height=e.content.details.height,t.content.details.width=e.content.details.width)),_.isUndefined(e.meta)||_.isNull(e.meta)||(t.meta.lastUpdated=d(e.meta.lastUpdateDate),t.meta.fileName=e.meta.fileName)};e.loadAttachments=function(){null!==e.questionnaire&&(e.isReadOnlyForUser=e.questionnaire.isReadOnlyForUser||!1,null!==e.questionnaire.attachments&&_.each(e.questionnaire.attachments,function(t){var n={};_.any(e.attachments,function(e){return e.attachmentId===t.attachmentId})||(u(n,t),e.attachments.push(n))}))},e.formatBytes=function(t){if(0===t)return"0 Byte";var e=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.min(Math.floor(Math.log(t)/Math.log(m)),e.length-1),a=Math.min(Math.max(n-1,0),2);return parseFloat((t/Math.pow(m,n)).toFixed(a))+" "+e[n]},e.formatSeconds=function(t){return d.duration(t).humanize()},e.isFolded=!1,e.unfold=function(){e.isFolded=!0},e.createAndUploadFile=function(t){if(!_.isNull(t)&&!_.isUndefined(t)){if(e.isReadOnlyForUser)return void r.notice("You don't have permissions for changing this questionnaire");var a={attachmentId:o.guid()};e.fileSelected(a,t,function(){i.updateAttachment(n.params.questionnaireId,a.attachmentId,a).then(function(){a.initialAttachment=angular.copy(a),e.attachments.push(a),setTimeout(function(){o.focus("focusAttachment"+a.attachmentId)},500)})})}},e.fileSelected=function(t,e,n){_.isUndefined(e)||_.isNull(e)||s.imageDimensions(e).then(function(a){if(t.file=e,t.content={},t.content.size=e.size,t.content.type=e.type,t.content.details={},t.content.details.height=a.height,t.content.details.width=a.width,t.meta={},t.meta.fileName=e.name,t.meta.lastUpdated=d(),t.meta.fileName){var i=t.meta.fileName.length;t.name=t.meta.fileName.replace(/\.[^\/.]+$/,"").substring(0,i<32?i:32)}_.isUndefined(t.form)||t.form.$setDirty(),_.isUndefined(n)||n()}).catch(function(){r.error("Chosen file is not image")})},e.saveAttachment=function(t){t.oldAttachmentId=t.attachmentId;var e=o.guid();i.updateAttachment(n.params.questionnaireId,e,t).then(function(){t.attachmentId=e,t.initialAttachment=_.clone(t),t.form.$setPristine()})},e.$on("verifing",function(t,n){for(var a=0;a<e.attachments.length;a++){var i=e.attachments[a];i.form.$dirty&&e.saveAttachment(i)}}),e.cancel=function(t){u(t,_.clone(t.initialAttachment)),t.form.$setPristine()},e.deleteAttachment=function(t){var a=e.attachments[t],s=a.name||"attachment with no name";c.open(o.createQuestionForDeleteConfirmationPopup(s)).result.then(function(o){"ok"===o&&i.deleteAttachment(n.params.questionnaireId,a.attachmentId).then(function(){e.attachments.splice(t,1)})})},e.previewAttachment=function(t){var n=e.downloadLookupFileBaseUrl,a=l.open({templateUrl:"views/attachment-preview.html",controller:["$scope","attachment",function(t,e){t.attachment=e,t.cancel=function(){a.dismiss()},t.attachmentUrl=function(){return n+"/thumbnail/"+t.attachment.attachmentId+"/568"}}],windowClass:"attachment-preview-window",resolve:{attachment:function(){return t}}})},e.foldback=function(){e.isFolded=!1,t.$broadcast("closeAttachments",{})},e.$on("openAttachments",function(t,n){e.unfold(),_.isUndefined(n)||_.isUndefined(n.focusOn)||setTimeout(function(){o.focus("focusAttachment"+n.focusOn)},500)}),e.$on("closeAttachmentsRequested",function(){e.foldback()}),t.$on("questionnaireLoaded",function(){e.loadAttachments()})}]);
angular.module("designerApp").controller("ChaptersCtrl",["$rootScope","$scope","$state","commandService","utilityService","$log","confirmService","questionnaireService","hotkeys",function(e,t,i,n,r,a,o,p,s){"use strict";s.get("right")!==!1&&s.del("right"),s.add("right","Close sections",function(e){e.preventDefault(),t.foldback()}),t.isFolded=!1,t.unfold=function(){t.isFolded=!0},t.foldback=function(){t.chaptersTree.isDragging||(t.isFolded=!1,e.$broadcast("closeChaptersList",{}))},t.editChapter=function(e){i.go("questionnaire.chapter.group",{chapterId:e.itemId,itemId:e.itemId}),t.foldback()},t.isCurrentChapter=function(e){return e.itemId===i.params.chapterId},t.addNewChapter=function(){var a=r.guid(),o={title:"New Section",itemId:a,itemType:"Chapter"};n.addChapter(i.params.questionnaireId,o).then(function(){t.questionnaire.chapters.push(o),i.go("questionnaire.chapter.group",{chapterId:o.itemId,itemId:o.itemId}),e.$emit("groupAdded")})},t.deleteChapter=function(a){var s=a.itemId||i.params.itemId;o.open(r.createQuestionForDeleteConfirmationPopup(a.title)).result.then(function(r){"ok"===r&&n.deleteGroup(i.params.questionnaireId,s).then(function(){var n=t.questionnaire.chapters.indexOf(a);n>-1&&(t.questionnaire.chapters.splice(n,1),e.$emit("chapterDeleted")),p.getQuestionnaireById(i.params.questionnaireId).then(function(e){t.questionnaire.chapters=[];var n=e.data;if(_.forEach(n.chapters,function(e){t.questionnaire.chapters.push(e)}),n.chapters.length>0){var r=_.first(n.chapters),a=r.itemId;t.currentChapter=r,i.go("questionnaire.chapter.group",{chapterId:a,itemId:a})}})})})},t.pasteAfterChapter=function(a){var o=Cookies.getJSON("itemToCopy");if(!_.isNull(o)&&!_.isUndefined(o)){var p=a.itemId||i.params.itemId,s=r.guid();n.pasteItemAfter(i.params.questionnaireId,p,o.questionnaireId,o.itemId,s).then(function(){var n={title:"pasting...",itemId:s,itemType:"Chapter"},r=_.find(t.questionnaire.chapters,{itemId:p}),a=_.indexOf(t.questionnaire.chapters,r)+1;t.questionnaire.chapters.splice(a,0,n),e.$emit("chapterPasted"),i.go("questionnaire.chapter.group",{chapterId:s,itemId:s})})}},e.$on("$stateChangeSuccess",function(){t.foldback()}),e.$on("groupUpdated",function(e,i){var n=p.findItem(t.questionnaire.chapters,i.itemId);null!==n&&(n.title=i.title)}),e.$on("deleteChapter",function(e,i){t.deleteChapter(i.chapter)}),t.$on("openChaptersList",function(){t.unfold()}),t.$on("closeChaptersListRequested",function(){t.foldback()}),e.$on("copyChapter",function(e,i){t.copyChapter(i.chapter)}),e.$on("pasteAfterChapter",function(e,i){t.pasteAfterChapter(i.chapter)})}]);
!function(){"use strict";angular.module("designerApp").controller("confirmCtrl",["$scope","$log","$uibModalInstance","item",function(n,c,o,e){n.item=e,n.ok=function(){o.close("ok")},n.cancel=function(){o.dismiss("cancel")}}])}();
angular.module("designerApp").controller("findReplaceCtrl",["$rootScope","$scope","$http","$state","commandService","utilityService","isReadOnlyForUser",function(e,r,n,a,o,c,s){r.isReadOnlyForUser=s,r.searchForm={searchFor:"",replaceWith:"",matchCase:!1,matchWholeWord:!1,useRegex:!1},r.foundReferences=[],r.step="search",c.setFocusIn("searchFor");var t=-1;r.$watch("searchForm.searchFor",function(){r.foundReferences.length&&r.foundReferences.splice(0,r.foundReferences.length)}),r.findAll=function(){if(r.searchForm.searchFor.length>0)return n({method:"GET",url:"../../api/findReplace/findAll",params:{searchFor:r.searchForm.searchFor,matchCase:r.searchForm.matchCase,matchWholeWord:r.searchForm.matchWholeWord,useRegex:r.searchForm.useRegex,id:a.params.questionnaireId}}).then(function(e){var n=a.params;n.property=null,a.go(a.current.name,n,{notify:!1,reload:!1}),r.foundReferences=e.data,t=-1})},r.confirmReplaceAll=function(){r.step="confirm"},r.replaceAll=function(){o.execute("ReplaceTexts",{questionnaireId:a.params.questionnaireId,searchFor:r.searchForm.searchFor,replaceWith:r.searchForm.replaceWith,matchCase:r.searchForm.matchCase,matchWholeWord:r.searchForm.matchWholeWord,useRegex:r.searchForm.useRegex}).then(function(){r.step="done"})},r.onDone=function(){r.$close(),a.reload()},r.backToSearch=function(){r.step="search",r.foundReferences.splice(0,r.foundReferences.length)},r.navigateNext=function(){t++,t>=r.foundReferences.length&&(t=0),e.navigateTo(r.foundReferences[t])},r.navigatePrev=function(){t--,t<0&&(t=r.foundReferences.length-1),e.navigateTo(r.foundReferences[t])},e.$on("openMacrosList",function(){angular.element(".findReplaceModal").css("left","50%")}),e.$on("$stateChangeSuccess",function(){angular.element(".findReplaceModal").css("left","")})}]);
angular.module("designerApp").controller("GroupCtrl",["$rootScope","$scope","$state","$timeout","questionnaireService","commandService","hotkeys","utilityService",function(e,t,r,i,o,a,n,u){t.currentChapterId=r.params.chapterId;n.get("ctrl+s")!==!1&&n.del("ctrl+s"),n.bindTo(t).add({combo:"ctrl+s",description:"Save changes",allowIn:["INPUT","SELECT","TEXTAREA"],callback:function(e){null===t.questionnaire||t.questionnaire.isReadOnlyForUser||(t.saveGroup(),t.groupForm.$setPristine(),e.preventDefault())}});var p=function(e){t.activeGroup=e,t.activeGroup.isChapter=r.params.itemId===r.params.chapterId,t.activeGroup.itemId=r.params.itemId,t.activeGroup.variableName=r.params.variableName,_.isNull(t.groupForm)||_.isUndefined(t.groupForm)||t.groupForm.$setPristine()};t.loadGroup=function(){o.getGroupDetailsById(r.params.questionnaireId,r.params.itemId).then(function(e){var i=e.data;p(i.group),t.activeGroup.breadcrumbs=i.breadcrumbs,t.initialGroup=angular.copy(t.activeGroup);var o=null;switch(r.params.property){case"Title":o="edit-group-title";break;case"EnablingCondition":o="edit-group-condition"}u.setFocusIn(o)})},t.saveGroup=function(i){t.groupForm.$valid&&a.updateGroup(r.params.questionnaireId,t.activeGroup).then(function(){t.initialGroup=angular.copy(t.activeGroup),e.$emit("groupUpdated",{itemId:t.activeGroup.itemId,title:t.activeGroup.title,hasCondition:null!==t.activeGroup.enablementCondition&&/\S/.test(t.activeGroup.enablementCondition)}),_.isFunction(i)&&i()})},t.$on("verifing",function(e,r){t.groupForm.$dirty&&t.saveGroup(function(){t.groupForm.$setPristine()})}),t.cancelGroup=function(){p(angular.copy(t.initialGroup))},t.deleteItem=function(){t.activeGroup.isChapter?e.$emit("deleteChapter",{chapter:t.activeGroup}):t.deleteGroup(t.activeGroup)},t.questionnaire?t.loadGroup():e.$on("questionnaireLoaded",function(){t.loadGroup()})}]);
angular.module("designerApp").controller("LeftMenuCtrl",["$rootScope","$scope",function(o,s){"use strict";s.isUnfoldedChapters=!1,s.isUnfoldedMacros=!1,s.isUnfoldedLookupTables=!1,s.isUnfoldedAttachments=!1,s.isUnfoldedTranslations=!1;var n=function(){(s.isUnfoldedChapters||s.isUnfoldedMacros||s.isUnfoldedLookupTables||s.isUnfoldedAttachments||s.isUnfoldedTranslations)&&(s.isUnfoldedChapters&&o.$broadcast("closeChaptersListRequested",{}),s.isUnfoldedMacros&&o.$broadcast("closeMacrosListRequested",{}),s.isUnfoldedLookupTables&&o.$broadcast("closeLookupTablesRequested",{}),s.isUnfoldedAttachments&&o.$broadcast("closeAttachmentsRequested",{}),s.isUnfoldedTranslations&&o.$broadcast("closeTranslationsRequested",{}))},e=function(){s.isUnfoldedMacros=!1,s.isUnfoldedChapters=!1,s.isUnfoldedLookupTables=!1,s.isUnfoldedAttachments=!1,s.isUnfoldedTranslations=!1};s.unfoldChapters=function(){s.isUnfoldedChapters||(n(),s.isUnfoldedChapters=!0,o.$broadcast("openChaptersList",{}))},s.unfoldMacros=function(){s.isUnfoldedMacros||(n(),s.isUnfoldedMacros=!0,o.$broadcast("openMacrosList",{}))},s.unfoldLookupTables=function(){s.isUnfoldedLookupTables||(n(),s.isUnfoldedLookupTables=!0,o.$broadcast("openLookupTables",{}))},s.unfoldAttachments=function(){s.isUnfoldedAttachments||(n(),s.isUnfoldedAttachments=!0,o.$broadcast("openAttachments",{}))},s.unfoldTranslations=function(){s.isUnfoldedTranslations||(n(),s.isUnfoldedTranslations=!0,o.$broadcast("openTranslations",{}))},s.$on("openChaptersList",function(){s.isUnfoldedChapters=!0}),s.$on("openLookupTables",function(){s.isUnfoldedLookupTables=!0}),s.$on("openAttachments",function(){s.isUnfoldedAttachments=!0}),s.$on("openTranslations",function(){s.isUnfoldedTranslations=!0}),s.$on("openMacrosList",function(){s.isUnfoldedMacros=!0}),s.$on("closeChaptersList",function(){e()}),s.$on("closeMacrosList",function(){e()}),s.$on("closeLookupTables",function(){e()}),s.$on("closeAttachments",function(){e()}),s.$on("closeTranslations",function(){e()}),s.$on("verifing",function(){n()})}]);
angular.module("designerApp").controller("LookupTablesCtrl",["$rootScope","$scope","$state","hotkeys","commandService","utilityService","confirmService",function(e,o,n,l,i,a,t){"use strict";o.downloadLookupFileBaseUrl="../../Questionnaire/ExportLookupTable/";l.get("ctrl+l")!==!1&&l.del("ctrl+l"),l.add("ctrl+l","Close lookup tables panel",function(e){e.preventDefault(),o.foldback()}),o.lookupTables=[];var u=function(e,o){e.initialLookupTable=_.clone(o),e.itemId=o.itemId,e.name=o.name,e.fileName=o.fileName,e.file=null,e.hasUploadedFile=!_.isEmpty(o.fileName)};o.loadLookupTables=function(){null!==o.questionnaire&&null!==o.questionnaire.lookupTables&&_.each(o.questionnaire.lookupTables,function(e){var n={};_.any(o.lookupTables,function(o){return o.itemId===e.itemId})||(u(n,e),o.lookupTables.push(n))})},o.isFolded=!1,o.unfold=function(){o.isFolded=!0},o.addNewLookupTable=function(){var e=a.guid(),l={itemId:e};i.addLookupTable(n.params.questionnaireId,l).then(function(){var e={};u(e,l),o.lookupTables.push(e)})},o.fileSelected=function(e,o){_.isUndefined(o)||_.isNull(o)||(e.file=o,e.fileName=e.file.name,e.oldItemId=e.itemId,e.itemId=a.guid(),e.form.$setDirty())},o.saveLookupTable=function(e){i.updateLookupTable(n.params.questionnaireId,e).then(function(){e.initialLookupTable=_.clone(e),e.hasUploadedFile=!_.isEmpty(e.fileName),e.form.$setPristine()}).catch(function(){e.itemId=e.oldItemId})},o.cancel=function(e){u(e,_.clone(e.initialLookupTable)),e.form.$setPristine()},o.deleteLookupTable=function(e){var l=o.lookupTables[e],u=l.name||"lookup table with no name";t.open(a.createQuestionForDeleteConfirmationPopup(u)).result.then(function(a){"ok"===a&&i.deleteLookupTable(n.params.questionnaireId,l.itemId).then(function(){o.lookupTables.splice(e,1)})})},o.foldback=function(){o.isFolded=!1,e.$broadcast("closeLookupTables",{})},o.$on("openLookupTables",function(e,n){o.unfold(),_.isUndefined(n)||_.isUndefined(n.focusOn)||setTimeout(function(){a.focus("focusLookupTable"+n.focusOn)},500)}),o.$on("closeLookupTablesRequested",function(){o.foldback()}),e.$on("questionnaireLoaded",function(){o.loadLookupTables()}),o.$on("verifing",function(e,n){for(var l=0;l<o.lookupTables.length;l++){var i=o.lookupTables[l];i.form.$dirty&&o.saveLookupTable(i)}})}]);
angular.module("designerApp").controller("MacrosCtrl",["$rootScope","$scope","$state","hotkeys","commandService","utilityService","confirmService",function(e,n,o,t,i,r,c){"use strict";t.get("ctrl+m")!==!1&&t.del("ctrl+m"),t.add("ctrl+m","Close macros panel",function(e){e.preventDefault(),n.foldback()}),n.macros=[];var a=function(e,n){e.initialMacro=_.clone(n),e.itemId=n.itemId,e.name=n.name,e.description=n.description,e.content=n.content,e.isDescriptionVisible=!_.isEmpty(e.description)};n.loadMacros=function(){null!==n.questionnaire&&null!==n.questionnaire.macros&&_.each(n.questionnaire.macros,function(e){var o={};_.any(n.macros,function(n){return n.itemId===e.itemId})||(a(o,e),n.macros.push(o))})},n.isFolded=!1,n.unfold=function(){n.isFolded=!0},n.addNewMacro=function(){var e=r.guid(),t={itemId:e};i.addMacro(o.params.questionnaireId,t).then(function(){var e={};a(e,t),n.macros.push(e)})},n.saveMacro=function(e){i.updateMacro(o.params.questionnaireId,e).then(function(){a(e,_.clone(e)),e.form.$setPristine()})},n.cancel=function(e){a(e,e.initialMacro),e.form.$setPristine()},n.deleteMacro=function(e){var t=n.macros[e],a=t.name||"macro with no name";c.open(r.createQuestionForDeleteConfirmationPopup(a)).result.then(function(r){"ok"===r&&i.deleteMacros(o.params.questionnaireId,t.itemId).then(function(){n.macros.splice(e,1)})})},n.isDescriptionEmpty=function(e){return _.isEmpty(e.description)},n.toggleDescription=function(e){e.isDescriptionVisible=!e.isDescriptionVisible},n.aceLoaded=function(e){function n(){var n=!e.session.getValue().length,t=e.renderer.emptyMessageNode;!n&&t?(e.renderer.scroller.removeChild(e.renderer.emptyMessageNode),e.renderer.emptyMessageNode=null):n&&!t&&(t=e.renderer.emptyMessageNode=document.createElement("div"),t.textContent=o,t.className="ace_invisible ace_emptyMessage",t.style.padding="0",e.renderer.scroller.appendChild(t))}var o="content",t=e.renderer;e.setOptions({maxLines:1/0,mode:"ace/mode/csharp-extended",fontSize:16,highlightActiveLine:!1,theme:"ace/theme/github-extended",enableBasicAutocompletion:!0,enableLiveAutocompletion:!1}),t.setShowGutter(!1),t.setPadding(0),e.on("input",n),e.commands.addCommand({name:"replace",bindKey:{win:"Tab|Shift-Tab",mac:"Tab"},exec:function(e){e.blur()}}),setTimeout(n,100)},n.foldback=function(){n.isFolded=!1,e.$broadcast("closeMacrosList",{})},n.$on("openMacrosList",function(e,o){n.unfold(),_.isUndefined(o)||_.isUndefined(o.focusOn)||setTimeout(function(){r.focus("focusMacro"+o.focusOn)},500)}),n.$on("closeMacrosListRequested",function(){n.foldback()}),e.$on("questionnaireLoaded",function(){n.loadMacros()}),n.$on("verifing",function(){for(var e=0;e<n.macros.length;e++){var o=n.macros[e];o.form.$dirty&&n.saveMacro(o)}})}]);
angular.module("designerApp").controller("MainCtrl",["$rootScope","$scope","$state","questionnaireService","commandService","verificationService","utilityService","hotkeys","$uibModal","notificationService","userService",function(e,t,i,n,o,r,a,s,c,u,l){$(document).on("click","a[href='javascript:void(0);']",function(e){e.preventDefault()}),t.verificationStatus={errors:null,warnings:null,visible:!1,time:new Date},t.questionnaire={questionsCount:0,groupsCount:0,rostersCount:0};s.add({combo:"ctrl+shift+b",allowIn:["INPUT","SELECT","TEXTAREA"],callback:function(e){window.open("../../questionnaire/expressiongeneration/"+i.params.questionnaireId),e.preventDefault()}}),s.add({combo:"ctrl+p",allowIn:["INPUT","SELECT","TEXTAREA"],description:"Print",callback:function(e){var t=window.open("../../pdf/printpreview/"+i.params.questionnaireId);try{t.focus()}catch(e){u.notice(e)}e.preventDefault()}}),s.add({combo:"ctrl+b",allowIn:["INPUT","SELECT","TEXTAREA"],description:"Compile",callback:function(e){t.verify(),e.preventDefault()}}),s.add({combo:"esc",allowIn:["INPUT","SELECT","TEXTAREA"],callback:function(){t.verificationStatus.visible=!1}}),s.get("shift+alt+x")!==!1&&s.del("shift+alt+x"),s.add({combo:"shift+alt+x",allowIn:["INPUT","SELECT","TEXTAREA"],description:"Focus questionnaire tree",callback:function(e){e.preventDefault(),document.activeElement.blur()}}),s.get("shift+alt+e")!==!1&&s.del("shift+alt+e"),s.add({combo:"shift+alt+e",allowIn:["INPUT","SELECT","TEXTAREA"],description:"Focus title field in editor",callback:function(e){e.preventDefault(),$($(".question-editor textarea").get(0)).focus()}}),s.get("left")!==!1&&s.del("left"),s.add("left","Open section",function(e){e.preventDefault(),t.$broadcast("openChaptersList","")}),s.add({combo:"ctrl+h",allowIn:["INPUT","SELECT","TEXTAREA"],description:"Find and replace",callback:function(e){e.preventDefault(),t.showFindReplaceDialog()}});var d=!1;t.showFindReplaceDialog=function(){if(!d){var e=c.open({templateUrl:"views/find-replace.html",backdrop:!1,windowClass:"findReplaceModal",controller:"findReplaceCtrl",resolve:{isReadOnlyForUser:t.questionnaire.isReadOnlyForUser||!1}});d=!0,e.closed.then(function(){d=!1})}},t.questionnaireId=i.params.questionnaireId;t.verify=function(){t.verificationStatus.errors=null,t.verificationStatus.warnings=null,e.$broadcast("verifing",{}),setTimeout(function(){r.verify(i.params.questionnaireId).then(function(e){var i=e.data;t.verificationStatus.errors=i.errors,t.verificationStatus.warnings=i.warnings,t.verificationStatus.time=new Date,t.verificationStatus.typeOfMessageToBeShown="error",t.verificationStatus.errors.length>0?t.showVerificationErrors():t.closeVerifications()})},500)},t.showVerificationErrors=function(){0!==t.verificationStatus.errors.length&&(t.verificationStatus.typeOfMessageToBeShown="error",t.verificationStatus.messagesToShow=t.verificationStatus.errors,t.verificationStatus.visible=!0)},t.showVerificationWarnings=function(){0!==t.verificationStatus.warnings.length&&(t.verificationStatus.typeOfMessageToBeShown="warning",t.verificationStatus.messagesToShow=t.verificationStatus.warnings,t.verificationStatus.visible=!0)},t.closeVerifications=function(){t.verificationStatus.visible=!1};var f=[];t.getReferancesWithMessages=function(e){for(var t in e.errors){var i=e.errors[t];for(var n in i.references){var o=i.references[n];f.push({reference:o,compilationErrorMessages:i.compilationErrorMessages})}}return f},t.toggleCheatSheet=function(){s.toggleCheatSheet()},t.answerTypeClass={YesNo:"icon-singleoption",DropDownList:"icon-singleoption",MultyOption:"icon-multyoption",Numeric:"icon-numeric",DateTime:"icon-datetime",GpsCoordinates:"icon-gpscoordinates",AutoPropagate:"icon-textedit",TextList:"icon-textlist",QRBarcode:"icon-qrbarcode",Text:"icon-text",SingleOption:"icon-singleoption",Multimedia:"icon-photo"},t.items=[],t.item=null,t.questionnaire=null,t.chaptersTree={accept:function(e){return _.isEmpty(e.item)},dragStart:function(){t.chaptersTree.isDragging=!0},beforeDrop:function(e){t.chaptersTree.isDragging=!1},dropped:function(e){var o=function(e,i){t.questionnaire.chapters.splice(_.indexOf(t.questionnaire.chapters,e),1),t.questionnaire.chapters.splice(i,0,e)};if(e.dest.index!==e.source.index){var r=e.source.nodeScope.chapter;n.moveGroup(r.itemId,e.dest.index,null,i.params.questionnaireId).error(function(){o(r,e.source.index)})}}},e.navigateTo=function(n){"macro"===n.type.toLowerCase()?(t.verificationStatus.visible=!1,e.$broadcast("openMacrosList",{focusOn:n.itemId})):"lookuptable"===n.type.toLowerCase()?(t.verificationStatus.visible=!1,e.$broadcast("openLookupTables",{focusOn:n.itemId})):"attachment"===n.type.toLowerCase()?(t.verificationStatus.visible=!1,e.$broadcast("openAttachments",{focusOn:n.itemId})):"translation"===n.type.toLowerCase()?(t.verificationStatus.visible=!1,e.$broadcast("openTranslations",{focusOn:n.itemId})):i.go("questionnaire.chapter."+n.type.toLowerCase(),{chapterId:n.chapterId,itemId:n.itemId,indexOfEntityInProperty:n.indexOfEntityInProperty,property:n.property})},e.$on("$stateChangeSuccess",function(e,t,i){a.scrollToValidationCondition(i.indexOfEntityInProperty)}),t.removeItemWithIdFromErrors=function(e){var i=t.verificationStatus.errors;t.verificationStatus.errors=_.filter(i,function(t){return t.ItemId!=e}),_.each(i,function(t){t.isGroupedMessage&&(t.references=_.filter(t.references,function(t){return t.itemId!=e}))});var n=0;_.each(i,function(e){e.isGroupedMessage?_.each(e.references,function(e){n++}):n++}),i=_.filter(i,function(e){return!e.isGroupedMessage||e.references.length}),t.verificationStatus.errors=i,t.verificationStatus.errorsCount=n},t.currentChapter=null,e.variableNames=[],e.updateVariableNames=function(t){e.variableNames=t,e.$broadcast("variablesChanged",{})},e.addOrUpdateLocalVariable=function(i,n){var o=_.find(t.variableNames,{id:i});_.isUndefined(o)?t.variableNames.push({id:i,name:n}):o.name=n,e.$broadcast("variablesChanged",{})},e.removeLocalVariable=function(i){t.variableNames.splice(_.indexOf(t.variableNames,_.findWhere(t.variableNames,{id:i})),1),e.$broadcast("variablesChanged",{})},e.$on("groupDeleted",function(e,i){t.questionnaire.groupsCount--,t.removeItemWithIdFromErrors(i)}),e.$on("questionDeleted",function(i,n){t.questionnaire.questionsCount--,t.removeItemWithIdFromErrors(n),e.removeLocalVariable(n)}),e.$on("varibleDeleted",function(i,n){t.removeItemWithIdFromErrors(n),e.removeLocalVariable(n)}),e.$on("rosterDeleted",function(i,n){t.questionnaire.rostersCount--,t.removeItemWithIdFromErrors(n),e.removeLocalVariable(n)}),e.$on("groupAdded",function(){t.questionnaire.groupsCount++}),e.$on("questionAdded",function(){t.questionnaire.questionsCount++}),e.$on("rosterAdded",function(){t.questionnaire.rostersCount++}),e.$on("chapterCloned",function(){m()}),e.$on("chapterDeleted",function(){m()}),e.$on("statictextAdded",function(){}),e.$on("chapterPasted",function(){m()}),e.$on("itemPasted",function(){m()}),t.getPersonsSharedWith=function(e){return e?_.without(e.sharedPersons,_.findWhere(e.sharedPersons,{isOwner:!0})):[]},t.showShareInfo=function(){c.open({templateUrl:"views/share.html",controller:"shareCtrl",windowClass:"share-window",resolve:{questionnaire:function(){return t.questionnaire}}})};var p=function(e){var t=e.renderer;t.setShowGutter(!1),t.setPadding(12),e.$blockScrolling=1/0,e.commands.bindKey("tab",null),e.commands.bindKey("shift+tab",null),e.on("focus",function(){$(".ace_focus").parents(".pseudo-form-control").addClass("focused")}),e.on("blur",function(){$(".pseudo-form-control.focused").removeClass("focused")})};t.setupAceForSubstitutions=function(e){e.setOptions({maxLines:1/0,fontSize:16,highlightActiveLine:!1,theme:"ace/theme/github-extended"});var t=window.ace.require("ace/mode/text-extended").Mode;e.getSession().setMode(new t),e.getSession().setUseWrapMode(!0),e.getSession().setTabSize(0),p(e)},t.aceLoaded=function(i){i.setOptions({maxLines:1/0,fontSize:16,highlightActiveLine:!1,theme:"ace/theme/github-extended",enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),t.aceEditorUpdateMode(i),e.$on("variablesChanged",function(){t.aceEditorUpdateMode(i)}),p(i)},t.getVariablesNames=function(){return _.pluck(e.variableNames,"name")},t.aceEditorUpdateMode=function(e){if(e){var i=window.ace.require("ace/mode/csharp-extended").Mode;e.getSession().setMode(new i(t.getVariablesNames));var n={getCompletions:function(e,i,n,o,r){var a=0;r(null,t.getVariablesNames().sort().reverse().map(function(e){return{name:e,value:e,score:a++,meta:"variable"}}))},identifierRegexps:[/[@a-zA-Z_0-9\$\-\u00A2-\uFFFF]/]};ace.require("ace/ext/language_tools").setCompleters([n])}},e.$on("$stateChangeSuccess",function(e,i,n){var o=i.name.replace("questionnaire.chapter.","");if("question"===o||"group"===o||"roster"===o||"statictext"===o){var r="#"+n.itemId;t.$broadcast("scrollToElement",r)}});var m=function(){n.getQuestionnaireById(i.params.questionnaireId).then(function(n){if(t.questionnaire=n.data,!i.params.chapterId&&n.data.chapters.length>0){var o=_.first(n.data.chapters),r=o.itemId;t.currentChapter=o,i.go("questionnaire.chapter.group",{chapterId:r,itemId:r})}e.$emit("questionnaireLoaded")})};l.getCurrentUserName().then(function(e){t.currentUserName=e.data}),m()}]);
angular.module("designerApp").controller("QuestionCtrl",["$rootScope","$scope","$state","$timeout","utilityService","questionnaireService","commandService","$log","confirmService","hotkeys","optionsService",function(e,i,t,n,o,s,a,u,c,r,l){i.currentChapterId=t.params.chapterId;var d={};r.get("ctrl+s")!==!1&&r.del("ctrl+s");var p=function(){i.questionForm&&i.questionForm.$setDirty()};r.bindTo(i).add({combo:"ctrl+s",description:"Save changes",allowIn:["INPUT","SELECT","TEXTAREA"],callback:function(e){null===i.questionnaire||i.questionnaire.isReadOnlyForUser||(i.saveQuestion(),i.questionForm.$setPristine(),e.preventDefault())}}),i.onKeyPressInOptions=function(e){if(13===e.which){e.preventDefault();var t=e.target?e.target:e.srcElement;o.moveFocusAndAddOptionIfNeeded(t,".question-options-editor",".question-options-editor input.question-option-value-editor",i.activeQuestion.options,function(){return i.addOption()},"option")}};var v=function(e){i.activeQuestion=i.activeQuestion||{},i.activeQuestion.breadcrumbs=e.breadcrumbs,i.activeQuestion.itemId=t.params.itemId,i.activeQuestion.variable=e.variableName||e.variable,i.activeQuestion.variableLabel=e.variableLabel,i.activeQuestion.mask=e.mask,i.activeQuestion.questionTypeOptions=e.questionTypeOptions,i.activeQuestion.title=e.title,i.activeQuestion.enablementCondition=e.enablementCondition,i.activeQuestion.validationExpression=e.validationExpression,i.activeQuestion.hideIfDisabled=e.hideIfDisabled,i.activeQuestion.validationMessage=e.validationMessage,i.activeQuestion.allQuestionScopeOptions=e.allQuestionScopeOptions,i.activeQuestion.instructions=e.instructions,i.activeQuestion.hideInstructions=e.hideInstructions,i.activeQuestion.useFormatting=e.useFormatting,i.activeQuestion.maxAnswerCount=e.maxAnswerCount,i.activeQuestion.maxAllowedAnswers=e.maxAllowedAnswers,i.activeQuestion.areAnswersOrdered=e.areAnswersOrdered,i.activeQuestion.yesNoView=e.yesNoView,i.activeQuestion.isFilteredCombobox=e.isFilteredCombobox,i.activeQuestion.optionsFilterExpression=e.optionsFilterExpression,i.activeQuestion.validationConditions=e.validationConditions,i.activeQuestion.isTimestamp=e.isTimestamp;var n=e.options||[];_.each(n,function(e){e.id=o.guid()}),i.activeQuestion.useListAsOptionsEditor=!0,i.activeQuestion.options=n,i.activeQuestion.optionsCount=e.optionsCount||0,i.activeQuestion.wereOptionsTruncated=e.wereOptionsTruncated||!1,i.activeQuestion.isInteger="Numeric"!==e.type||e.isInteger,i.activeQuestion.countOfDecimalPlaces=e.countOfDecimalPlaces,i.activeQuestion.questionScope=e.isPreFilled?"Prefilled":e.questionScope,i.setQuestionType(e.type),i.setLinkSource(e.linkedToEntityId,e.linkedFilterExpression),i.setCascadeSource(e.cascadeFromQuestionId),i.activeQuestion.shouldUserSeeReloadDetailsPromt=!1,_.isNull(i.questionForm)||_.isUndefined(i.questionForm)||i.questionForm.$setPristine()};i.MAX_OPTIONS_COUNT=200;var Q=function(e){d.allQuestionScopeOptions=e.allQuestionScopeOptions,i.sourceOfLinkedEntities=e.sourceOfLinkedEntities,i.sourceOfSingleQuestions=e.sourceOfSingleQuestions,v(e)};i.loadQuestion=function(){s.getQuestionDetailsById(t.params.questionnaireId,t.params.itemId).then(function(e){var n=e.data;i.initialQuestion=angular.copy(n),Q(n),o.scrollToValidationCondition(t.params.indexOfEntityInProperty);var s=null;switch(t.params.property){case"Title":s="edit-question-title";break;case"VariableName":s="edit-question-variable-name";break;case"EnablingCondition":s="edit-question-enablement-condition";break;case"ValidationExpression":s="validation-expression-"+t.params.indexOfEntityInProperty;break;case"ValidationMessage":s="validationMessage"+t.params.indexOfEntityInProperty;break;case"Option":s="option-title-"+t.params.indexOfEntityInProperty;break;case"OptionsFilter":s="optionsFilterExpression"}o.setFocusIn(s)})};var m=function(e){return i.doesQuestionSupportEnablementConditions()&&null!==e.enablementCondition&&/\S/.test(e.enablementCondition)},f=function(e){return i.doesQuestionSupportValidations()&&e.validationConditions.length>0};i.saveQuestion=function(n){if(i.questionForm.$valid){i.showOptionsInList();var o=y(i.initialQuestion,i.activeQuestion)&&i.activeQuestion.isCascade;a.sendUpdateQuestionCommand(t.params.questionnaireId,i.activeQuestion,o).then(function(){i.initialQuestion=angular.copy(i.activeQuestion),e.$emit("questionUpdated",{itemId:i.activeQuestion.itemId,type:i.activeQuestion.type,linkedToEntityId:i.activeQuestion.linkedToEntityId,linkedFilterExpression:i.activeQuestion.linkedFilterExpression,hasCondition:m(i.activeQuestion),hasValidation:f(i.activeQuestion),title:i.activeQuestion.title,variable:i.activeQuestion.variable,hideIfDisabled:i.activeQuestion.hideIfDisabled});var t=!i.activeQuestion.isFilteredCombobox,s=_.isEmpty(i.activeQuestion.cascadeFromQuestionId);"SingleOption"===i.activeQuestion.type&&t&&s&&(i.activeQuestion.optionsCount=i.activeQuestion.options.length),_.isFunction(n)&&n(),o&&i.loadQuestion()})}};var y=function(e,i){if("SingleOption"!==i.type||"MultyOption"!==i.type)return!1;if((i.wereOptionsTruncated||!1)===!1)return!1;var t=e.isFilteredCombobox||!1,n=!_.isEmpty(e.cascadeFromQuestionId);return!!(n&&i.isFilteredCombobox||n&&!_.isEmpty(e.cascadeFromQuestionId)||t&&!_.isEmpty(i.cascadeFromQuestionId))};i.setQuestionType=function(e){i.activeQuestion.type=e,i.activeQuestion.typeName=_.find(i.activeQuestion.questionTypeOptions,{value:e}).text,i.activeQuestion.allQuestionScopeOptions=d.allQuestionScopeOptions;var t="Supervisor"===i.activeQuestion.questionScope||"Prefilled"===i.activeQuestion.questionScope;"TextList"===e&&t&&(i.activeQuestion.questionScope="Interviewer"),"DateTime"===e&&(i.activeQuestion.allQuestionScopeOptions=_.filter(i.activeQuestion.allQuestionScopeOptions,function(e){return"Supervisor"!==e.value}),"Supervisor"===i.activeQuestion.questionScope&&(i.activeQuestion.questionScope="Interviewer")),"GpsCoordinates"===e&&"Supervisor"===i.activeQuestion.questionScope&&(i.activeQuestion.questionScope="Interviewer"),"MultyOption"===e&&"Prefilled"===i.activeQuestion.questionScope&&(i.activeQuestion.questionScope="Interviewer"),"SingleOption"!==e&&"MultyOption"!==e&&i.setLinkSource(null,null),i.doesQuestionSupportOptionsFilters()||(i.activeQuestion.optionsFilterExpression="",i.activeQuestion.linkedFilterExpression=""),p()},i.cancelQuestion=function(){v(angular.copy(i.initialQuestion))},i.addOption=function(){i.activeQuestion.optionsCount>=i.MAX_OPTIONS_COUNT||(i.activeQuestion.options.push({value:null,title:"",id:o.guid()}),i.activeQuestion.optionsCount+=1,p())},i.editFilteredComboboxOptions=function(){if(i.questionForm.$dirty){c.open({title:"To open options editor all unsaved changes must be saved. Should we save them now?",okButtonTitle:"Save",cancelButtonTitle:"No, later",isReadOnly:i.questionnaire.isReadOnlyForUser}).result.then(function(e){"ok"===e&&i.saveQuestion(function(){O()})})}else O()},i.editCascadingComboboxOptions=function(){var e=i.activeQuestion.cascadeFromQuestionId!=i.initialQuestion.cascadeFromQuestionId;if(i.questionForm.$dirty||e){c.open({title:"To open options editor all unsaved changes must be saved. Should we save them now?",okButtonTitle:"Save",cancelButtonTitle:"No, later",isReadOnly:i.questionnaire.isReadOnlyForUser}).result.then(function(e){"ok"===e&&i.saveQuestion(function(){S()})})}else S()};var O=function(){i.activeQuestion.shouldUserSeeReloadDetailsPromt=!0,window.open("../../questionnaire/editoptions/"+t.params.questionnaireId+"?questionid="+i.activeQuestion.itemId,"","scrollbars=yes, center=yes, modal=yes, width=960",!0)},S=function(){i.activeQuestion.shouldUserSeeReloadDetailsPromt=!0,window.open("../../questionnaire/editcascadingoptions/"+t.params.questionnaireId+"?questionid="+i.activeQuestion.itemId,"","scrollbars=yes, center=yes, modal=yes, width=960",!0)};i.removeOption=function(e){i.activeQuestion.options.splice(e,1),i.activeQuestion.optionsCount=i.activeQuestion.options.length,p()},i.removeValidationCondition=function(e){i.activeQuestion.validationConditions.splice(e,1),p()},i.addValidationCondition=function(){i.activeQuestion.validationConditions.push({expression:"",message:""}),p(),_.defer(function(){$(".question-editor .form-holder").scrollTo({top:"+=200px",left:"+=0"},250)})},i.showOptionsInTextarea=function(){i.activeQuestion.stringifiedOptions=l.stringifyOptions(i.activeQuestion.options),i.activeQuestion.useListAsOptionsEditor=!1},i.showOptionsInList=function(){i.activeQuestion.useListAsOptionsEditor||!_.isUndefined(i.questionForm.stringifiedOptions)&&i.questionForm.stringifiedOptions.$valid&&(i.activeQuestion.stringifiedOptions&&(i.activeQuestion.options=l.parseOptions(i.activeQuestion.stringifiedOptions)),i.activeQuestion.useListAsOptionsEditor=!0)},i.changeQuestionScope=function(e){i.activeQuestion.questionScope=e.text,"Prefilled"===i.activeQuestion.questionScope&&(i.activeQuestion.enablementCondition=""),p()},i.getQuestionScopes=function(e){if(!e)return[];var i=e.allQuestionScopeOptions;return!e.isCascade&&!e.isLinked&&$.inArray(e.type,["TextList","QRBarcode","Multimedia","GpsCoordinates","MultyOption"])<0?i:i.filter(function(i){return"MultyOption"==e.type?"Prefilled"!==i.value:"GpsCoordinates"==e.type?"Supervisor"!==i.value:"Prefilled"!==i.value&&"Supervisor"!==i.value})},i.$watch("activeQuestion.isLinked",function(e){i.activeQuestion&&(e?(i.activeQuestion.yesNoView=!1,i.activeQuestion.optionsFilterExpression=null):(i.activeQuestion.linkedToEntityId=null,i.activeQuestion.linkedToEntity=null))}),i.$watch("activeQuestion.yesNoView",function(e){e&&i.activeQuestion&&(i.activeQuestion.isLinked=!1)}),i.$watch("activeQuestion.isCascade",function(e){i.activeQuestion&&(e?"Interviewer"!==i.activeQuestion.questionScope&&"Hidden"!==i.activeQuestion.questionScope&&(i.activeQuestion.questionScope="Interviewer",i.activeQuestion.optionsFilterExpression=null):(i.activeQuestion.cascadeFromQuestionId=null,i.activeQuestion.cascadeFromQuestion=null))}),i.$on("verifing",function(){i.questionForm.$dirty&&i.saveQuestion(function(){i.questionForm.$setPristine()})}),i.setLinkSource=function(e,t){i.activeQuestion.isLinked=!_.isEmpty(e),e&&(i.activeQuestion.linkedToEntityId=e,i.activeQuestion.linkedToEntity=_.find(i.sourceOfLinkedEntities,{id:i.activeQuestion.linkedToEntityId}),i.activeQuestion.linkedFilterExpression=t,p())},i.setCascadeSource=function(e){i.activeQuestion.isCascade=!_.isEmpty(e),e&&(i.activeQuestion.cascadeFromQuestionId=e,i.activeQuestion.cascadeFromQuestion=_.find(i.sourceOfSingleQuestions,{id:i.activeQuestion.cascadeFromQuestionId}),p())};var I=["Multimedia"];i.doesQuestionSupportValidations=function(){return i.activeQuestion&&!_.contains(I,i.activeQuestion.type)&&!(i.activeQuestion.isCascade&&i.activeQuestion.cascadeFromQuestionId)},i.doesQuestionSupportOptionsFilters=function(){return!(!i.activeQuestion||"MultyOption"!==i.activeQuestion.type&&"SingleOption"!==i.activeQuestion.type)},i.doesQuestionSupportEnablementConditions=function(){return i.activeQuestion&&"Prefilled"!=i.activeQuestion.questionScope&&!(i.activeQuestion.isCascade&&i.activeQuestion.cascadeFromQuestionId)},i.isIntegerChange=function(){i.activeQuestion.countOfDecimalPlaces=null},i.loadQuestion()}]);
!function(){"use strict";angular.module("designerApp").controller("RosterCtrl",["$rootScope","$scope","$state","questionnaireService","commandService","confirmService","$log","utilityService","hotkeys","optionsService",function(e,t,i,s,r,o,n,a,c,l){t.currentChapterId=i.params.chapterId,t.selectedNumericQuestion=null,t.selectedMultiQuestion=null,t.selectedListQuestion=null,t.selectedTitleQuestion=null;c.get("ctrl+s")!==!1&&c.del("ctrl+s"),c.bindTo(t).add({combo:"ctrl+s",description:"Save changes",allowIn:["INPUT","SELECT","TEXTAREA"],callback:function(e){null===t.questionnaire||t.questionnaire.isReadOnlyForUser||(t.saveRoster(),t.editRosterForm.$setPristine(),e.preventDefault())}}),t.onKeyPressInOptions=function(e){if(13===e.which){if(e.preventDefault(),t.wasTitlesLimitReached())return;a.moveFocusAndAddOptionIfNeeded(e.target?e.target:e.srcElement,".fixed-roster-titles-editor",".fixed-roster-titles-editor input.fixed-roster-value-editor",t.activeRoster.fixedRosterTitles,function(){return t.addFixedTitle()},"title")}};var u=function(e){t.activeRoster=e,t.activeRoster.variable=e.variableName,t.activeRoster.lists=e.textListsQuestions,t.activeRoster.numerics=e.numericIntegerQuestions,t.activeRoster.titles=e.numericIntegerTitles,t.activeRoster.multiOption=e.notLinkedMultiOptionQuestions,R(),t.activeRoster.useListAsRosterTitleEditor=!0,t.activeRoster.getTitleForRosterType=function(){return _.find(t.activeRoster.rosterTypeOptions,{value:t.activeRoster.type}).text},_.isNull(t.editRosterForm)||_.isUndefined(t.editRosterForm)||t.editRosterForm.$setPristine()},d=function(e,t){if(_.isNull(t))return null;var i=_.find(e,{id:t});return _.isUndefined(i)?null:i},R=function(){t.selectedNumericQuestion=d(t.activeRoster.numerics,t.activeRoster.rosterSizeNumericQuestionId),t.selectedListQuestion=d(t.activeRoster.lists,t.activeRoster.rosterSizeListQuestionId),t.selectedMultiQuestion=d(t.activeRoster.multiOption,t.activeRoster.rosterSizeMultiQuestionId),t.selectedTitleQuestion=d(t.activeRoster.titles,t.activeRoster.rosterTitleQuestionId)};t.wasTitlesLimitReached=function(){return t.activeRoster.fixedRosterTitles.length>=200},t.selectNumericQuestion=function(e){t.activeRoster.rosterSizeNumericQuestionId=e,t.selectedNumericQuestion=d(t.activeRoster.numerics,t.activeRoster.rosterSizeNumericQuestionId),t.editRosterForm.$setDirty(),s.getQuestionsEligibleForNumericRosterTitle(i.params.questionnaireId,i.params.itemId,t.activeRoster.rosterSizeNumericQuestionId).then(function(e){t.activeRoster.titles=e.data,t.selectedTitleQuestion=d(t.activeRoster.titles,t.activeRoster.rosterTitleQuestionId)})},t.selectListQuestion=function(e){t.activeRoster.rosterSizeListQuestionId=e,t.selectedListQuestion=d(t.activeRoster.lists,t.activeRoster.rosterSizeListQuestionId),t.editRosterForm.$setDirty()},t.selectMultiQuestion=function(e){t.activeRoster.rosterSizeMultiQuestionId=e,t.selectedMultiQuestion=d(t.activeRoster.multiOption,t.activeRoster.rosterSizeMultiQuestionId),t.editRosterForm.$setDirty()},t.selectTitleQuestion=function(e){t.activeRoster.rosterTitleQuestionId=e,t.selectedTitleQuestion=d(t.activeRoster.titles,t.activeRoster.rosterTitleQuestionId),t.editRosterForm.$setDirty()},t.removeFixedTitle=function(e){t.activeRoster.fixedRosterTitles.splice(e,1),t.editRosterForm.$setDirty()},t.showOptionsInTextarea=function(){t.activeRoster.stringifiedRosterTitles=l.stringifyOptions(t.activeRoster.fixedRosterTitles),t.activeRoster.useListAsRosterTitleEditor=!1},t.showRosterTitlesInList=function(){t.activeRoster.useListAsRosterTitleEditor||!_.isUndefined(t.editRosterForm.stringifiedRosterTitles)&&t.editRosterForm.stringifiedRosterTitles.$valid&&(t.activeRoster.stringifiedRosterTitles&&(t.activeRoster.fixedRosterTitles=l.parseOptions(t.activeRoster.stringifiedRosterTitles)),t.activeRoster.useListAsRosterTitleEditor=!0)},t.addFixedTitle=function(){t.activeRoster.fixedRosterTitles.push({value:null,title:""}),t.editRosterForm.$setDirty()},t.updateRosterType=function(e){t.activeRoster.type=e,t.editRosterForm.$setDirty()},t.loadRoster=function(){s.getRosterDetailsById(i.params.questionnaireId,i.params.itemId).then(function(e){var s=e.data;t.initialRoster=angular.copy(s),u(s);var r=null;switch(i.params.property){case"Title":r="edit-group-title";break;case"VariableName":r="edit-group-variableName";break;case"EnablingCondition":r="edit-group-condition";break;case"FixedRosterItem":r="fixed-item-"+i.params.indexOfEntityInProperty}a.setFocusIn(r)})},t.saveRoster=function(s){t.editRosterForm.$valid&&(t.showRosterTitlesInList(),r.updateRoster(i.params.questionnaireId,t.activeRoster).then(function(){t.initialRoster=angular.copy(t.activeRoster),e.$emit("rosterUpdated",{itemId:t.activeRoster.itemId,variable:t.activeRoster.variableName,title:t.activeRoster.title,hasCondition:null!==t.activeRoster.enablementCondition&&/\S/.test(t.activeRoster.enablementCondition)}),_.isFunction(s)&&s()}))},t.deleteRoster=function(){o.open(a.createQuestionForDeleteConfirmationPopup(t.activeRoster.title)).result.then(function(o){"ok"===o&&r.deleteGroup(i.params.questionnaireId,i.params.itemId).then(function(){var r=i.params.itemId;s.removeItemWithId(t.items,r),t.resetSelection(),e.$emit("rosterDeleted",r)})})},t.$on("verifing",function(e,i){t.editRosterForm.$dirty&&t.saveRoster(function(){t.editRosterForm.$setPristine()})}),t.cancelRoster=function(){u(angular.copy(t.initialRoster))},e.$on("groupMoved",function(e,r){r!==i.params.itemId||_.isUndefined(t.editRosterForm)||s.getRosterDetailsById(i.params.questionnaireId,i.params.itemId).then(function(e){var r=e.data;t.activeRoster.lists=r.textListsQuestions,t.activeRoster.numerics=r.numericIntegerQuestions,t.activeRoster.multiOption=r.notLinkedMultiOptionQuestions,t.activeRoster.titles=r.numericIntegerTitles,R(),_.isNull(t.activeRoster.rosterSizeNumericQuestionId)||_.isUndefined(t.activeRoster.rosterSizeNumericQuestionId)||(t.editRosterForm.$setPristine(),s.getQuestionsEligibleForNumericRosterTitle(i.params.questionnaireId,i.params.itemId,t.activeRoster.rosterSizeNumericQuestionId).then(function(e){t.activeRoster.titles=e.data,t.selectedTitleQuestion=d(t.activeRoster.titles,t.activeRoster.rosterTitleQuestionId)}))})}),t.loadRoster()}])}();
angular.module("designerApp").controller("shareCtrl",["$scope","$log","$uibModalInstance","questionnaire","shareService",function(e,i,n,s,t){"use strict";e.questionnaire=s,e.questionnaire.editedTitle=s.title,e.viewModel={shareWith:"",shareForm:{},shareType:"Edit",doesUserExist:!0},e.shareTypeOptions=[{name:"Edit"},{name:"View"}],e.cancel=function(){n.close()},e.invite=function(){t.findUserByEmail(e.viewModel.shareWith).then(function(i){var n=i.data;e.viewModel.doesUserExist=n.doesUserExist,n.doesUserExist&&t.shareWith(e.viewModel.shareWith,e.questionnaire.questionnaireId,e.viewModel.shareType).then(function(){0===_.where(e.questionnaire.sharedPersons,{email:e.viewModel.shareWith}).length&&e.questionnaire.sharedPersons.push({email:e.viewModel.shareWith,shareType:e.viewModel.shareType}),e.viewModel.shareWith="",e.viewModel.doesUserExist=!0})})},e.updateTitle=function(){t.udpateQuestionnaire(e.questionnaire.questionnaireId,e.questionnaire.editedTitle,e.questionnaire.isPublic).then(function(){e.questionnaire.title=e.questionnaire.editedTitle,n.close()})},e.revokeAccess=function(i){t.revokeAccess(i.email,e.questionnaire.questionnaireId).then(function(){e.questionnaire.sharedPersons=_.without(e.questionnaire.sharedPersons,_.findWhere(e.questionnaire.sharedPersons,{email:i.email}))})},e.togglePublicity=function(){t.udpateQuestionnaire(e.questionnaire.questionnaireId,e.questionnaire.title,!e.questionnaire.isPublic).then(function(){e.questionnaire.isPublic=!e.questionnaire.isPublic})},e.changeShareType=function(i){e.viewModel.shareType=i.name}}]);
angular.module("designerApp").controller("StaticTextCtrl",["$rootScope","$scope","$state","utilityService","questionnaireService","commandService","hotkeys",function(t,i,e,a,n,c,o){"use strict";i.currentChapterId=e.params.chapterId;o.get("ctrl+s")!==!1&&o.del("ctrl+s");var s=function(){i.staticTextForm&&i.staticTextForm.$setDirty()};o.bindTo(i).add({combo:"ctrl+s",description:"Save changes",allowIn:["INPUT","SELECT","TEXTAREA"],callback:function(t){null===i.questionnaire||i.questionnaire.isReadOnlyForUser||(i.saveStaticText(),i.staticTextForm.$setPristine(),t.preventDefault())}});var r=function(t){i.activeStaticText=i.activeStaticText||{},i.activeStaticText.breadcrumbs=t.breadcrumbs,i.activeStaticText.itemId=e.params.itemId,i.activeStaticText.text=t.text,i.activeStaticText.attachmentName=t.attachmentName,i.activeStaticText.enablementCondition=t.enablementCondition,i.activeStaticText.hideIfDisabled=t.hideIfDisabled,i.activeStaticText.validationConditions=t.validationConditions,_.isNull(i.staticTextForm)||_.isUndefined(i.staticTextForm)||i.staticTextForm.$setPristine()};i.loadStaticText=function(){n.getStaticTextDetailsById(e.params.questionnaireId,e.params.itemId).then(function(t){var n=t.data;i.initialStaticText=angular.copy(n),r(n),a.scrollToValidationCondition(e.params.indexOfEntityInProperty);var c=null;switch(e.params.property){case"Title":c="edit-static-text";break;case"EnablingCondition":c="edit-question-enablement-condition";break;case"ValidationExpression":c="validation-expression-"+e.params.indexOfEntityInProperty;break;case"ValidationMessage":c="validation-message-"+e.params.indexOfEntityInProperty}a.setFocusIn(c)})};var d=function(t){return null!==t.enablementCondition&&/\S/.test(t.enablementCondition)},l=function(t){return t.validationConditions.length>0};i.saveStaticText=function(a){c.updateStaticText(e.params.questionnaireId,i.activeStaticText).then(function(){i.initialStaticText=angular.copy(i.activeStaticText),t.$emit("staticTextUpdated",{itemId:i.activeStaticText.itemId,text:i.activeStaticText.text,hasCondition:d(i.activeStaticText),hasValidation:l(i.activeStaticText),hideIfDisabled:i.activeStaticText.hideIfDisabled}),_.isFunction(a)&&a()})},i.removeValidationCondition=function(t){i.activeStaticText.validationConditions.splice(t,1),s()},i.addValidationCondition=function(){i.activeStaticText.validationConditions.push({expression:"",message:""}),s(),_.defer(function(){$(".static-text-editor .form-holder").scrollTo({top:"+=200px",left:"+=0"},250)})},i.$on("verifing",function(t,e){i.staticTextForm.$dirty&&i.saveStaticText(function(){i.staticTextForm.$setPristine()})}),i.cancelStaticText=function(){r(angular.copy(i.initialStaticText))},i.loadStaticText()}]);
angular.module("designerApp").controller("TranslationsCtrl",["$rootScope","$scope","$state","hotkeys","commandService","utilityService","confirmService","Upload","$uibModal","notificationService","moment",function(n,t,e,i,a,o,s,l,r,c,d){"use strict";t.downloadBaseUrl="../../translations",t.isReadOnlyForUser=!1;i.get("ctrl+shift+t")!==!1&&i.del("ctrl+shift+t"),i.add("ctrl+shift+t","Close translations panel",function(n){n.preventDefault(),t.foldback()}),t.translations=[];var u=function(n,t){n.initialTranslation=_.clone(t),n.translationId=t.translationId,n.name=t.name,n.file=null,n.content={},n.content.details={},_.isUndefined(t.content)||_.isNull(t.content)||(n.content.size=t.content.size,n.content.type=t.content.contentType,_.isUndefined(t.content.details)||_.isNull(t.content.details)||(n.content.details.height=t.content.details.height,n.content.details.width=t.content.details.width))};t.loadTranslations=function(){null!==t.questionnaire&&(t.isReadOnlyForUser=t.questionnaire.isReadOnlyForUser||!1,null!==t.questionnaire.translations&&_.each(t.questionnaire.translations,function(n){var e={};_.any(t.translations,function(t){return t.translationId===n.translationId})||(u(e,n),t.translations.push(e))}))},t.isFolded=!1,t.unfold=function(){t.isFolded=!0},t.createAndUploadFile=function(n){if(!_.isNull(n)&&!_.isUndefined(n)){if(t.isReadOnlyForUser)return void c.notice("You don't have permissions for changing this questionnaire");var i={translationId:o.guid()};t.fileSelected(i,n,function(){a.updateTranslation(e.params.questionnaireId,i).then(function(){i.initialTranslation=_.clone(i),t.translations.push(i),setTimeout(function(){o.focus("focusTranslation"+i.translationId)},500)})})}},t.fileSelected=function(n,t,e){if(!_.isUndefined(t)&&!_.isNull(t)){n.file=t,n.content={},n.content.size=t.size,n.content.type=t.type,n.meta={},n.meta.fileName=t.name,n.meta.lastUpdated=d();var i=n.meta.fileName.match(/[^[\]]+(?=])/g);i&&i.length>0?n.name=i[0]:n.name=n.meta.fileName.replace(/\.[^\/.]+$/,"");var a=n.name.length;n.name=n.name.substring(0,a<32?a:32),n.oldTranslationId=n.translationId,n.translationId=o.guid(),_.isUndefined(n.form)||n.form.$setDirty(),_.isUndefined(e)||e()}},t.saveTranslation=function(n){a.updateTranslation(e.params.questionnaireId,n).then(function(){n.initialTranslation=_.clone(n),n.form.$setPristine()})},t.$on("verifing",function(n,e){for(var i=0;i<t.translations.length;i++){var a=t.translations[i];a.form.$dirty&&t.saveTranslation(a)}}),t.cancel=function(n){u(n,_.clone(n.initialTranslation)),n.form.$setPristine()},t.deleteTranslation=function(n){var i=t.translations[n],l=i.name||"translation with no name";s.open(o.createQuestionForDeleteConfirmationPopup(l)).result.then(function(o){"ok"===o&&a.deleteTranslation(e.params.questionnaireId,i.translationId).then(function(){t.translations.splice(n,1)})})},t.getDefaultTemplate=function(){},t.foldback=function(){t.isFolded=!1,n.$broadcast("closeTranslations",{})},t.$on("openTranslations",function(n,e){t.unfold(),_.isUndefined(e)||_.isUndefined(e.focusOn)||setTimeout(function(){o.focus("focusTranslation"+e.focusOn)},500)}),t.$on("closeTranslationsRequested",function(){t.foldback()}),n.$on("questionnaireLoaded",function(){t.loadTranslations()})}]);
angular.module("designerApp").controller("TreeCtrl",["$rootScope","$scope","$state","questionnaireService","commandService","verificationService","utilityService","confirmService","hotkeys","notificationService","$timeout",function(e,t,i,n,a,r,o,s,d,u,c){"use strict";var m=this,l={makeVisible:"makeVisible",toTop:"toTop"},p={default:"default",search:"search"},f={question:"question",roster:"roster",group:"group",staticText:"statictext",variable:"variable"};t.itemTemplate=function(e){return"views/tree"+e.toLowerCase()+".html"},t.highlightedId=null,t.isSearchInFocus=!1,t.search={searchText:""},t.filtersBoxMode=p.default,t.items=[],e.readyToPaste=!(_.isNull(Cookies.get("itemToCopy"))||_.isUndefined(Cookies.get("itemToCopy")));d.get("down")!==!1&&d.del("down"),d.add("down","Navigate to next sibling",function(e){e.preventDefault(),t.goToNextItem()}),d.get("up")!==!1&&d.del("up"),d.add("up","Navigate to previous sibling",function(e){e.preventDefault(),t.goToPrevItem()}),d.get("ctrl+f")!==!1&&d.del("ctrl+f"),d.add({combo:"ctrl+f",description:"Search for sub-sections and questions in section",callback:function(e){e.preventDefault(),t.showSearch()}}),d.get("enter")!==!1&&d.del("enter"),d.add({combo:"enter",description:"Open item in editor",callback:function(e){if(e.preventDefault(),t.isSearchInFocus)o.focusout("focusSearch"),t.isSearchInFocus=!1;else{if(_.isNull(t.highlightedId))return;i.go("questionnaire.chapter."+g(T()),{chapterId:i.params.chapterId,itemId:t.highlightedId})}}}),t.showSearch=function(){t.filtersBoxMode=p.search,o.focus("focusSearch"),t.isSearchInFocus=!0},t.hideSearch=function(){t.filtersBoxMode=p.default,t.search.searchText="",t.isSearchInFocus=!1},t.searchItem=function(e){if(!t.search.searchText)return!0;var i=e.variable&&e.variable.toLowerCase().indexOf(t.search.searchText.toLowerCase())!=-1,n=e.title&&e.title.toLowerCase().indexOf(t.search.searchText.toLowerCase())!=-1||e.text&&e.text.toLowerCase().indexOf(t.search.searchText.toLowerCase())!=-1,a=i||n;return a||angular.forEach(e.items,function(e){t.searchItem(e)&&(a=!0)}),a};var I=function(e){var i=T();if(!_.isNull(i)){if(_.isNull(t.highlightedId))return void b(i);var a=_.map($(".question-list .item-body"),function(e){return $(e).attr("id")||""}),r=_.indexOf(a,t.highlightedId)+e;r=Math.min(Math.max(r,0),a.length);var o=a[r],s=n.findItem(t.items,o);_.isNull(s)||b(s)}};t.goToNextItem=function(){I(1)},t.goToPrevItem=function(){I(-1)},t.goToParent=function(){var e=T();if(e){var t=e.getParentItem();null!==t&&b(t)}},t.goToChild=function(){var e=T();if(e&&!_.isEmpty(e.items)){b(e.items[0])}},t.toggle=function(e){e.toggle()};var h=function(e,i){var n=i||l.makeVisible;if(0!==$(e).length){var a=o.isTreeItemVisible($(e));if(!a.isVisible){if(n===l.makeVisible){if(!a.shouldScrollDown)return void t.$broadcast("scrollToPosition",{target:".question-list",scrollTop:a.scrollPositionWhenScrollUp});n=l.toTop}if(n===l.toTop){var r=v(e);t.$broadcast("scrollToPosition",{target:".question-list",scrollTop:r})}}}},v=function(e){var t=$(e).offset().top,i=$(".question-list").offset().top;return Math.max(t-i-10,0)},g=function(e){switch(e.itemType){case"Question":return f.question;case"Group":return e.isRoster?f.roster:f.group;case"StaticText":return f.staticText;case"Chapter":return f.group;case"Variable":return f.variable}throw"unknown item type: "+e},b=function(e){t.highlightedId=e.itemId,h("#"+e.itemId,l.makeVisible)},T=function(){if(_.isNull(t.items)||_.isUndefined(t.items))return null;if(_.isNull(t.highlightedId)){var e=_.first(t.items);if(_.isUndefined(e))return null;t.highlightedId=e.itemId}return n.findItem(t.items,t.highlightedId)},x=function(){var e=function(t,i){t.getParentItem=function(){return i},_.each(t.items,function(i){e(i,t)})};_.each(t.items,function(t){e(t,null)})};t.isQuestion=function(e){return e.hasOwnProperty("type")},t.isGroup=function(e){return!(t.isQuestion(e)||t.isStaticText(e)||t.isVariable(e))},t.isStaticText=function(e){return e.hasOwnProperty("text")},t.isVariable=function(e){return e.hasOwnProperty("variableData")},t.showStartScreen=function(){return _.isEmpty(t.items)},t.groupsTree={accept:function(e,t){return!_.isEmpty(e.item)&&(_.isNull(t.item)||"Group"===t.item.itemType)},beforeDrop:function(e){m.draggedFrom=e.source.nodeScope.item.getParentItem()},dropped:function(a){x();var r=a.source.nodeScope.item,o=a.dest.nodesScope.item,s=o?o.itemId:i.params.chapterId,d=function(e,i,n){var a=e.getParentItem()||t;a.items.splice(_.indexOf(a.items,e),1),(_.isNull(i)?t.items:i.items).splice(n,0,e),x()};a.dest.nodesScope===a.source.nodesScope&&a.dest.index===a.source.index||(t.isQuestion(r)?n.moveQuestion(r.itemId,a.dest.index,s,i.params.questionnaireId).then(function(){e.$emit("questionMoved",r.itemId)},function(){d(r,m.draggedFrom,a.source.index)}):t.isStaticText(r)?n.moveStaticText(r.itemId,a.dest.index,s,i.params.questionnaireId).then(function(){e.$emit("staticTextMoved",r.itemId)},function(){d(r,m.draggedFrom,a.source.index)}):t.isVariable(r)?n.moveVariable(r.itemId,a.dest.index,s,i.params.questionnaireId).then(function(){e.$emit("variableMoved",r.itemId)},function(){d(r,m.draggedFrom,a.source.index)}):n.moveGroup(r.itemId,a.dest.index,s,i.params.questionnaireId).then(function(){e.$emit("groupMoved",r.itemId)},function(){d(r,m.draggedFrom,a.source.index)}))}},t.deleteQuestion=function(r){var d=r.itemId||i.params.itemId;s.open(o.createQuestionForDeleteConfirmationPopup(r.title||"Untitled question")).result.then(function(r){"ok"===r&&a.deleteQuestion(i.params.questionnaireId,d).then(function(){n.removeItemWithId(t.items,d),t.resetSelection(),e.$emit("questionDeleted",d)})})},t.deleteVariable=function(r){var d=r.itemId||i.params.itemId;s.open(o.createQuestionForDeleteConfirmationPopup(r.name||"Untitled variable")).result.then(function(r){"ok"===r&&a.deleteVariable(i.params.questionnaireId,d).then(function(){n.removeItemWithId(t.items,d),t.resetSelection(),e.$emit("varibleDeleted",d)})})};var S=function(r){a.deleteGroup(i.params.questionnaireId,r).then(function(){var i=function(t){var n=t.items||[];e.$emit(g(t)+"Deleted",t.itemId),_.each(n,function(e){i(e)})};i(n.findItem(t.items,r)),n.removeItemWithId(t.items,r),t.resetSelection()})};t.deleteGroup=function(e){var t=e.itemId||i.params.itemId;s.open(o.createQuestionForDeleteConfirmationPopup(e.title)).result.then(function(e){"ok"===e&&n.getAllBrokenGroupDependencies(i.params.questionnaireId,t).then(function(e){var n=e.data;if(0===n.length)S(t);else{var a=_.reduce(n,function(e,t){return e+"<a href=#"+i.params.questionnaireId+"/chapter/"+t.chapterId+"/question/"+t.id+">"+t.title.substring(0,30)+"</a>"},"");u.notify({title:"Condition or cascading depended items might be broken",text:'<div class="broken-links"><p>One or more questions/sub-sections depend on<p>'+a+"</div>",hide:!1,confirm:{confirm:!0},history:{history:!1},buttons:{closer:!1,sticker:!1}}).get().on("pnotify.confirm",function(){S(t)})}})})},t.deleteStaticText=function(r){var d=r||i.params.itemId,u=n.findItem(t.items,d);s.open(o.createQuestionForDeleteConfirmationPopup(u.text)).result.then(function(r){"ok"===r&&a.deleteStaticText(i.params.questionnaireId,d).then(function(i){i.data.IsSuccess&&(n.removeItemWithId(t.items,d),t.resetSelection(),e.$emit("staticTextDeleted"))})})},t.moveToChapter=function(e){var a,r=i.params.itemId,o=n.findItem(t.items,r);a=t.isStaticText(o)?n.moveStaticText:t.isGroup(o)?n.moveGroup:t.isVariable(o)?n.moveVariable:n.moveQuestion,a(r,0,e,i.params.questionnaireId).then(function(){n.removeItemWithId(t.items,r),t.resetSelection()})},t.resetSelection=function(){i.go("questionnaire.chapter.group",{chapterId:i.params.chapterId,itemId:i.params.chapterId})};var q=function(e,t){return _.isNull(e)||_.isUndefined(e)?-1:_.findIndex(e.items,function(e){return e.itemId===t})},C=function(t,n){e.$emit(t+"Added"),i.go("questionnaire.chapter."+t,{chapterId:i.params.chapterId,itemId:n})};t.addQuestion=function(e){var t=o.createEmptyQuestion(e);a.addQuestion(i.params.questionnaireId,e.itemId,t.itemId).then(function(){e.items.push(t),C("question",t.itemId)})},t.addGroup=function(e){var t=o.createEmptyGroup(e);a.addGroup(i.params.questionnaireId,t,e.itemId).then(function(){e.items.push(t),C("group",t.itemId)})},t.addRoster=function(e){var t=o.createEmptyRoster(e);a.addRoster(i.params.questionnaireId,t,e.itemId).then(function(){e.items.push(t),C("roster",t.itemId)})},t.addStaticText=function(e){var t=o.createEmptyStaticText(e);a.addStaticText(i.params.questionnaireId,t,e.itemId).then(function(){e.items.push(t),C("statictext",t.itemId)})},t.addVariable=function(e){var t=o.createEmptyVariable(e);a.addVariable(i.params.questionnaireId,t,e.itemId).then(function(){e.items.push(t),C("variable",t.itemId)})},t.addVariableAfter=function(e){var n=e.getParentItem()||t.currentChapter,r=q(n,e.itemId)+1,s=o.createEmptyVariable(n);a.addVariable(i.params.questionnaireId,s,n.itemId,r).then(function(){n.items.splice(r,0,s),C("variable",s.itemId)})},t.addQuestionAfter=function(e){var n=e.getParentItem()||t.currentChapter,r=q(n,e.itemId)+1,s=o.createEmptyQuestion(n);a.addQuestion(i.params.questionnaireId,n.itemId,s.itemId,r).then(function(e){e.data.IsSuccess&&(n.items.splice(r,0,s),C("question",s.itemId))})},t.addGroupAfter=function(e){var n=e.getParentItem()||t.currentChapter,r=q(n,e.itemId)+1,s=o.createEmptyGroup(n);a.addGroup(i.params.questionnaireId,s,n.itemId,r).then(function(){n.items.splice(r,0,s),C("group",s.itemId)})},t.addRosterAfter=function(e){var n=e.getParentItem()||t.currentChapter,r=q(n,e.itemId)+1,s=o.createEmptyRoster(n);a.addRoster(i.params.questionnaireId,s,n.itemId,r).then(function(){n.items.splice(r,0,s),C("roster",s.itemId)})},t.addStaticTextAfter=function(e){var n=e.getParentItem()||t.currentChapter,r=q(n,e.itemId)+1,s=o.createEmptyStaticText(n);a.addStaticText(i.params.questionnaireId,s,n.itemId,r).then(function(){n.items.splice(r,0,s),C("statictext",s.itemId)})},t.pasteItemInto=function(n){var r=Cookies.getJSON("itemToCopy");if(!_.isNull(r)&&!_.isUndefined(r)){var s=o.guid();a.pasteItemInto(i.params.questionnaireId,n.itemId,r.questionnaireId,r.itemId,s).then(function(){t.refreshTree(),e.$emit("itemPasted"),i.go("questionnaire.chapter."+r.itemType,{chapterId:i.params.chapterId,itemId:s})})}},t.pasteItemAfter=function(n){var r=Cookies.getJSON("itemToCopy");if(!_.isNull(r)&&!_.isUndefined(r)){var s=n.itemId||i.params.itemId,d=o.guid();a.pasteItemAfter(i.params.questionnaireId,s,r.questionnaireId,r.itemId,d).then(function(){t.refreshTree(),e.$emit("itemPasted"),i.go("questionnaire.chapter."+r.itemType,{chapterId:i.params.chapterId,itemId:d})})}},e.copyRef=function(t){var n=t.itemId||i.params.itemId,a={questionnaireId:i.params.questionnaireId,itemId:n,itemType:g(t)};Cookies.remove("itemToCopy"),Cookies.set("itemToCopy",a,{expires:7}),e.readyToPaste=!0},t.refreshTree=function(){n.getChapterById(i.params.questionnaireId,i.params.chapterId).then(function(i){var n=i.data;t.items=n.chapter.items,t.currentChapter=n.chapter,e.updateVariableNames(n.variableNames),x()})},t.refreshTree(),t.$on("scrollToElement",function(e,t){0===$(t).length?c(function(){h(t)},1e3):h(t)}),e.$on("questionUpdated",function(i,a){var r=n.findItem(t.items,a.itemId);_.isNull(r)||(r.title=a.title,r.variable=a.variable,r.type=a.type,r.linkedToQuestionId=a.linkedToQuestionId,r.hasValidation=a.hasValidation,r.hasCondition=a.hasCondition,e.addOrUpdateLocalVariable(a.itemId,a.variable))}),e.$on("staticTextUpdated",function(e,i){var a=n.findItem(t.items,i.itemId);_.isNull(a)||(a.text=i.text,a.hasValidation=i.hasValidation,a.hasCondition=i.hasCondition)}),e.$on("variableUpdated",function(i,a){var r=n.findItem(t.items,a.itemId);_.isNull(r)||(r.variableData.name=a.name,r.variableData.label=a.label,e.addOrUpdateLocalVariable(a.itemId,a.name))}),e.$on("groupUpdated",function(e,i){t.currentChapter.itemId===i.itemId&&(t.currentChapter.title=i.title);var a=n.findItem(t.items,i.itemId);_.isNull(a)||(a.title=i.title,a.hasCondition=i.hasCondition)}),e.$on("rosterUpdated",function(i,a){var r=n.findItem(t.items,a.itemId);_.isNull(r)||(r.title=a.title,r.variable=a.variable,r.hasCondition=a.hasCondition,e.addOrUpdateLocalVariable(a.itemId,a.variable))})}]);
angular.module("designerApp").controller("VariableCtrl",["$scope","$rootScope","$state","questionnaireService","commandService","hotkeys","utilityService",function(a,e,i,t,r,l,n){a.currentChapterId=i.params.chapterId;var c=function(){a.variableForm&&a.variableForm.$setDirty()},o=function(e){a.activeVariable=a.activeVariable||{},a.activeVariable.breadcrumbs=e.breadcrumbs,a.activeVariable.itemId=i.params.itemId,a.activeVariable.variable=e.name,a.activeVariable.expression=e.expression,a.activeVariable.type=e.type,a.activeVariable.typeOptions=e.typeOptions,a.activeVariable.typeName=_.find(a.activeVariable.typeOptions,{value:e.type}).text,a.activeVariable.label=e.label};a.setType=function(e){a.activeVariable.type=e,a.activeVariable.typeName=_.find(a.activeVariable.typeOptions,{value:e}).text,c()},a.saveVariable=function(t){a.variableForm.$valid&&r.updateVariable(i.params.questionnaireId,a.activeVariable).then(function(){a.initialVariable=angular.copy(a.activeVariable),e.$emit("variableUpdated",{itemId:a.activeVariable.itemId,name:a.activeVariable.variable,label:a.activeVariable.label}),_.isFunction(t)&&t()})},a.cancel=function(){o(angular.copy(a.initialVariable))};l.get("ctrl+s")!==!1&&l.del("ctrl+s"),l.bindTo(a).add({combo:"ctrl+s",description:"Save changes",allowIn:["INPUT","SELECT","TEXTAREA"],callback:function(e){null===a.questionnaire||a.questionnaire.isReadOnlyForUser||(a.saveVariable(),a.variableForm.$setPristine(),e.preventDefault())}});a.$on("verifing",function(e,i){a.variableForm.$dirty&&a.saveVariable(function(){a.variableForm.$setPristine()})}),function(){t.getVariableDetailsById(i.params.questionnaireId,i.params.itemId).then(function(e){var t=e.data;a.initialVariable=angular.copy(t),o(t);var r=null;switch(i.params.property){case"VariableName":r="edit-question-variable-name";break;case"VariableContent":r="edit-group-condition"}n.setFocusIn(r)})}()}]);
angular.module("designerApp").config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate","$injector",function(e,n){return function(o,r){n.get("notificationService").error(o),e(o,r)}}])}]);
angular.module("designerApp").animation(".slide",function(){return{beforeAddClass:function(e,n,i){"ng-hide"===n&&jQuery(e).slideUp(i)},removeClass:function(e,n,i){"ng-hide"===n&&jQuery(e).hide().slideDown(i)}}});
!function(n){angular.module("designerApp").directive("focusOnOut",function(){return function(n,t,r){n.$on("focusOn",function(n,u){u===r.focusOnOut&&t[0].focus()}),n.$on("focusOut",function(n,u){u===r.focusOnOut&&t[0].blur()})}}).directive("splitArray",function(){return{restrict:"A",require:"ngModel",link:function(n,t,r,u){function e(n){return n.split("\n")}function i(n){return _.isArray(n)?n.join("\n"):null}u.$parsers.push(e),u.$formatters.push(i)}}}).directive("emptyTag",function(){return{restrict:"E",replace:!0,template:""}}).directive("onEnter",function(){return{link:function(n,t,r){t.bind("keypress",function(t){13===t.which&&(n.$apply(function(){n.$eval(r.onEnter)}),t.preventDefault())})}}})}(jQuery);
angular.module("designerApp").directive("help",["helpService",function(e){return{restrict:"E",scope:{key:"@",placement:"@?"},link:function(l){l.message=e.getHelpMessage(l.key)},controller:["$scope",function(e){e.placement=e.placement||"top"}],templateUrl:"views/help-link.html",replace:!1}}]);
angular.module("designerApp").directive("itemBreadcrumbs",[function(){return{restrict:"EA",scope:{crumbs:"="},templateUrl:"views/itemBreadcrumbs.html",link:function(e,r){r.addClass("breadcrumbs")}}}]);
angular.module("designerApp").directive("matchOptionsPattern",["optionsService",function(t){"use strict";return{require:"ngModel",restrict:"A",link:function(i,n,e,r){var s=function(i){if(_.isEmpty(i))r.$setValidity("matchOptionsPattern",!0);else{var n=(i||"").split("\n"),e=!0;_.each(n,function(i){e=e&&t.validateOptionAsText(i)}),r.$setValidity("matchOptionsPattern",e)}return i};r.$parsers.unshift(s),r.$formatters.unshift(s)}}}]).directive("maxOptionsCount",[function(){"use strict";return{require:"ngModel",restrict:"A",link:function(t,i,n,e){var r=function(t){if(_.isEmpty(t))e.$setValidity("maxOptionsCount",!0);else{var i=(t||"").split("\n");e.$setValidity("maxOptionsCount",i.length<=200)}return t};e.$parsers.unshift(r),e.$formatters.unshift(r)}}}]);
angular.module("designerApp").filter("escape",function(){return function(e){if(e){return filterXSS(e,{whiteList:[],stripIgnoreTag:!0})}return e}});
angular.module("designerApp").factory("authorizationInterceptor",["$q",function(r){"use strict";return{responseError:function(t){return 401==t.status&&(window.location.href="/"),r.reject(t)}}}]);
angular.module("designerApp").factory("commandService",["$http","blockUI","Upload","notificationService","$q",function(e,t,i,n,o){function a(i,n){return i.indexOf("Move")<0&&t.start(),e({method:"POST",url:r,data:{type:i,command:JSON.stringify(n)},headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(function(e){return t.stop(),e},function(e){return t.stop(),o.reject(e)})}var r="../../api/command",d={};return d.execute=function(e,t){return a(e,t)},d.updateAttachment=function(e,n,o){t.start();var a={questionnaireId:e,attachmentId:n,attachmentName:o.name,oldAttachmentId:o.oldAttachmentId},d="";return _.isUndefined(o.meta)||(d=o.meta.fileName),i.upload({url:r+"/attachment",data:{file:_.isNull(o.file)?"":o.file,fileName:d,command:JSON.stringify(a)}}).then(function(){t.stop()},function(){t.stop()})},d.deleteAttachment=function(e,t){return a("DeleteAttachment",{questionnaireId:e,attachmentId:t})},d.updateLookupTable=function(e,n){t.start();var o={questionnaireId:e,lookupTableId:n.itemId,lookupTableName:n.name,lookupTableFileName:n.fileName,oldLookupTableId:n.oldItemId};return i.upload({url:r+"/UpdateLookupTable",data:{file:_.isNull(n.file)?"":n.file,command:JSON.stringify(o)}}).then(function(){t.stop()}).catch(function(){t.stop()})},d.addLookupTable=function(e,t){return a("AddLookupTable",{questionnaireId:e,lookupTableId:t.itemId})},d.deleteLookupTable=function(e,t){return a("DeleteLookupTable",{questionnaireId:e,lookupTableId:t})},d.updateTranslation=function(e,o){t.start();var a={questionnaireId:e,translationId:o.translationId,oldTranslationId:o.oldTranslationId,name:o.name};return i.upload({url:r+"/translation",data:{file:_.isNull(o.file)?"":o.file,command:JSON.stringify(a)}}).then(function(e){t.stop(),_.isNull(o.file)||n.notice(e.data),o.file=null}).catch(function(){t.stop()})},d.deleteTranslation=function(e,t){return a("DeleteTranslation",{questionnaireId:e,translationId:t})},d.addMacro=function(e,t){return a("AddMacro",{questionnaireId:e,macroId:t.itemId})},d.updateMacro=function(e,t){return a("UpdateMacro",{questionnaireId:e,macroId:t.itemId,name:t.name,content:t.content,description:t.description})},d.deleteMacros=function(e,t){return a("DeleteMacro",{questionnaireId:e,macroId:t})},d.sendUpdateQuestionCommand=function(e,t,i){var n={questionnaireId:e,questionId:t.itemId,type:t.type,mask:t.mask,validationConditions:t.validationConditions,commonQuestionParameters:{title:t.title,variableName:t.variable,variableLabel:t.variableLabel,enablementCondition:t.enablementCondition,hideIfDisabled:t.hideIfDisabled,instructions:t.instructions,hideInstructions:t.hideInstructions,optionsFilterExpression:t.optionsFilterExpression}},o="Prefilled"===t.questionScope;switch(n.isPreFilled=o,n.scope=o?"Interviewer":t.questionScope,t.type){case"SingleOption":n.areAnswersOrdered=t.areAnswersOrdered,n.maxAllowedAnswers=t.maxAllowedAnswers,n.linkedToEntityId=t.linkedToEntityId,n.linkedFilterExpression=t.linkedFilterExpression,n.isFilteredCombobox=t.isFilteredCombobox||!1,n.cascadeFromQuestionId=t.cascadeFromQuestionId,n.enablementCondition=t.cascadeFromQuestionId?"":n.enablementCondition,n.validationExpression=t.cascadeFromQuestionId?"":n.validationExpression,n.validationMessage=t.cascadeFromQuestionId?"":n.validationMessage,n.options=i?null:t.options;break;case"MultyOption":n.areAnswersOrdered=t.areAnswersOrdered,n.maxAllowedAnswers=t.maxAllowedAnswers,n.linkedToEntityId=t.linkedToEntityId,n.linkedFilterExpression=t.linkedFilterExpression,n.yesNoView=t.yesNoView,n.options=_.isEmpty(n.linkedToEntityId)?t.options:null;break;case"Numeric":n.isInteger=t.isInteger,n.countOfDecimalPlaces=t.countOfDecimalPlaces,n.maxValue=t.maxValue,n.useFormatting=t.useFormatting;break;case"DateTime":n.isTimestamp=t.isTimestamp;break;case"GpsCoordinates":case"Text":break;case"TextList":n.maxAnswerCount=t.maxAnswerCount}return a("Update"+("MultyOption"===t.type?"MultiOption":t.type)+"Question",n)},d.addChapter=function(e,t){return a("AddGroup",{questionnaireId:e,groupId:t.itemId,title:t.title,condition:"",hideIfDisabled:!1,isRoster:!1,rosterSizeQuestionId:null,rosterSizeSource:"Question",rosterFixedTitles:null,rosterTitleQuestionId:null,parentGroupId:null,variableName:null})},d.addGroup=function(e,t,i,n){return a("AddGroup",{questionnaireId:e,groupId:t.itemId,title:t.title,condition:"",hideIfDisabled:!1,isRoster:!1,rosterSizeQuestionId:null,rosterSizeSource:"Question",rosterFixedTitles:null,rosterTitleQuestionId:null,parentGroupId:i,variableName:null,index:n})},d.addRoster=function(e,t,i,n){return a("AddGroup",{questionnaireId:e,groupId:t.itemId,title:t.title,condition:"",hideIfDisabled:!1,isRoster:!0,rosterSizeQuestionId:null,rosterSizeSource:"FixedTitles",fixedRosterTitles:[{value:1,title:"First Title"},{value:2,title:"Second Title"}],rosterTitleQuestionId:null,parentGroupId:i,variableName:t.variableName,index:n})},d.addStaticText=function(e,t,i,n){return a("AddStaticText",{questionnaireId:e,entityId:t.itemId,text:t.text,parentId:i,index:n})},d.addVariable=function(e,t,i,n){return a("AddVariable",{questionnaireId:e,entityId:t.itemId,parentId:i,index:n,variableData:{}})},d.updateVariable=function(e,t){return a("UpdateVariable",{questionnaireId:e,entityId:t.itemId,variableData:{expression:t.expression,name:t.variable,type:t.type,label:t.label}})},d.updateGroup=function(e,t){return a("UpdateGroup",{questionnaireId:e,groupId:t.itemId,title:t.title,condition:t.enablementCondition,hideIfDisabled:t.hideIfDisabled,isRoster:!1,rosterSizeQuestionId:null,rosterSizeSource:"Question",rosterFixedTitles:null,rosterTitleQuestionId:null,variableName:null})},d.updateRoster=function(e,t){var i={questionnaireId:e,groupId:t.itemId,title:t.title,description:t.description,condition:t.enablementCondition,hideIfDisabled:t.hideIfDisabled,variableName:t.variableName,isRoster:!0};switch(t.type){case"Fixed":i.rosterSizeSource="FixedTitles",i.fixedRosterTitles=t.fixedRosterTitles;break;case"Numeric":i.rosterSizeQuestionId=t.rosterSizeNumericQuestionId,i.rosterTitleQuestionId=t.rosterTitleQuestionId;break;case"List":i.rosterSizeQuestionId=t.rosterSizeListQuestionId;break;case"Multi":i.rosterSizeQuestionId=t.rosterSizeMultiQuestionId}return a("UpdateGroup",i)},d.updateStaticText=function(e,t){return a("UpdateStaticText",{questionnaireId:e,entityId:t.itemId,text:t.text,attachmentName:t.attachmentName,enablementCondition:t.enablementCondition,hideIfDisabled:t.hideIfDisabled,validationConditions:t.validationConditions})},d.addQuestion=function(e,t,i,n){return a("AddDefaultTypeQuestion",{questionnaireId:e,parentGroupId:t,questionId:i,index:n})},d.deleteGroup=function(e,t){return a("DeleteGroup",{questionnaireId:e,groupId:t})},d.deleteQuestion=function(e,t){return a("DeleteQuestion",{questionnaireId:e,questionId:t})},d.deleteVariable=function(e,t){return a("DeleteVariable",{questionnaireId:e,entityId:t})},d.deleteStaticText=function(e,t){return a("DeleteStaticText",{questionnaireId:e,entityId:t})},d.pasteItemAfter=function(e,t,i,n,o){return a("PasteAfter",{sourceQuestionnaireId:i,sourceItemId:n,itemToPasteAfterId:t,entityId:o,questionnaireId:e})},d.pasteItemInto=function(e,t,i,n,o){return a("PasteInto",{sourceQuestionnaireId:i,sourceItemId:n,parentId:t,entityId:o,questionnaireId:e})},d}]);
!function(){angular.module("designerApp").factory("confirmService",["$uibModal",function(n){var t={};return t.open=function(t){var e={title:t.title||"",okButtonTitle:t.okButtonTitle||"DELETE",cancelButtonTitle:t.cancelButtonTitle||"BACK TO DESIGNER",isReadOnly:t.isReadOnly||!1};return n.open({templateUrl:"views/confirm.html",controller:"confirmCtrl",windowClass:"confirm-window",resolve:{item:function(){return e}}})},t}])}();
angular.module("designerApp").factory("errorReportingInterceptor",["$q","notificationService",function(e,t){return{responseError:function(r){return 406===r.status||403===r.status||400===r.status?r.data.message?t.notice(r.data.message):t.notice(r.data.Message):404===r.status?t.notice("Entry was not found in questionnaire, please select another."):t.error("Request failed unexpectedly."),e.reject(r)}}}]);
angular.module("designerApp").factory("helpService",[function(){var e={instruction:"Instruction text that will be attached to the question.",mask:'Formatted entry for alpha-numerical values: phone numbers, ID codes, etc.\nExamples:"~" - Represents an alpha character (A-Z,a-z), "#" - Represents a numeric character (0-9), "*" - Represents an alphanumeric character (A-Z,a-z,0-9). "##/##/####" - date, "(###) ###-####" - phone number, "AA####" - flight number operated by American AirLines or "~*-###-~###"',variableName:"Variable names and roster IDs may be from 1 to 32 characters long and must contain only following characters: a-z, A-Z, _, or 0-9. The first character cannot be 0-9 or _ and the last one cannot be _.",titleQuestion:"Titles of rows",variableLabel:"A text up to 80 characters that will be attached to the exported variable",conditionExpression:"A logical expression that activates(deactivates) the current item depending on the answers on the other questions.",validationExpression:"A logical expression that validates an answer to the current question. Might include values of other questions.",validationMessage:'Error message is shown when validation condition evaluates to "False" or error occurres during expression evaluation.',sourceQuestion:"Source question (answer generates number of rows)",expression:"A logical expression that is calculated depending on the answers on the other questions.",fixedTitles:"Number of items determines the roster size. Each element of the list corresponds to a title of the roster row. Each element of the list should be placed on a separate line.",useFormatting:'When checked, the numeric field on the tablet will be formatted as: d,ddd,ddd.dd, "d" represents digits (0-9), ,(comma) is a thousand separator, and "." (dot) is a decimal point symbol.  Thousand separator and the decimal point symbol may vary for tablets with different cultures.',hideIfDisabled:"By default, a disabled item is greyed-out. Checking this option will hide a disabled question or section on a tablet.",hideInstructions:"By default, an instruction text is shown on a tablet. Checking this option will show only the first line of instructions. Tapping on that line will show the complete text.",isTimestamp:"This option allows the user to stamp the current time on tablet",variableDescription:"Text that will be shown next to a variable for testing purposes"};return e.getHelpMessage=function(t){return e[t]},e}]);
!function(){angular.module("designerApp").config(["$provide",function(t){t.factory("optionsService",["utilityService",function(t){var n={},i=new RegExp(/^(.+?)[\\.\s]+([-+]?\d+)\s*$/);return n.validateOptionAsText=function(t){return i.test(t||"")},n.stringifyOptions=function(t){var n="",i=_.max(_.map(t,function(t){return t.title.length}))+3;return _.each(t,function(t){_.isEmpty(t)||(n+=(t.title||"")+Array(i+1-(t.title||"").length).join(".")+(0===t.value?"0":t.value||""),n+="\n")}),n.trim("\n")},n.parseOptions=function(n){var e=(n||"").split("\n");return _.filter(e,_.isEmpty),_.map(e,function(n){var e=n.match(i);return{id:t.guid(),value:1*e[2],title:e[1]}})},n}])}])}();
!function(){"use strict";angular.module("designerApp").factory("questionnaireService",["$http","commandService","utilityService",function(e,t,r){var n="../../api/questionnaire",i={};return i.getQuestionnaireById=function(t){var i=r.format("{0}/get/{1}",n,t);return e.get(i)},i.getChapterById=function(t,i){var o=r.format("{0}/chapter/{1}?chapterId={2}",n,t,i);return e.get(o)},i.getGroupDetailsById=function(t,i){var o=r.format("{0}/editGroup/{1}?groupId={2}",n,t,i);return e.get(o)},i.getAllBrokenGroupDependencies=function(t,i){var o=r.format("{0}/getAllBrokenGroupDependencies/{1}?groupId={2}",n,t,i);return e.get(o)},i.getQuestionsEligibleForNumericRosterTitle=function(t,i,o){var u=r.format("{0}/getQuestionsEligibleForNumericRosterTitle/{1}?rosterId={2}&rosterSizeQuestionId={3}",n,t,i,o);return e.get(u)},i.getRosterDetailsById=function(t,i){var o=r.format("{0}/editRoster/{1}?rosterId={2}",n,t,i);return e.get(o)},i.getQuestionDetailsById=function(t,i){var o=r.format("{0}/editQuestion/{1}?questionId={2}",n,t,i);return e.get(o)},i.getVariableDetailsById=function(t,i){var o=r.format("{0}/editVariable/{1}?variableId={2}",n,t,i);return e.get(o)},i.getStaticTextDetailsById=function(t,i){var o=r.format("{0}/editStaticText/{1}?staticTextId={2}",n,t,i);return e.get(o)},i.moveGroup=function(e,r,n,i){return t.execute("MoveGroup",{targetGroupId:n,targetIndex:r,groupId:e,questionnaireId:i})},i.moveQuestion=function(e,r,n,i){return t.execute("MoveQuestion",{targetGroupId:n,targetIndex:r,questionId:e,questionnaireId:i})},i.moveStaticText=function(e,r,n,i){return t.execute("MoveStaticText",{targetEntityId:n,targetIndex:r,entityId:e,questionnaireId:i})},i.moveVariable=function(e,r,n,i){return t.execute("MoveVariable",{targetEntityId:n,targetIndex:r,entityId:e,questionnaireId:i})},i.removeItemWithId=function(e,t){var r=i.findItem(e,t);if(r){var n=r.getParentItem(),o=n?n.items:e;o.splice(_.indexOf(o,r),1)}},i.findItem=function(e,t){for(var r=function(e,n){var i=_.findWhere(e.items,{itemId:t});if(i)return i;for(var o=e.items||[],u=0;u<o.length;u++){var a=r(o[u],n);if(a)return a}return null},n=0;n<e.length;n++){var i=e[n];if(i.itemId===t)return i;var o=r(i,t);if(o)return o}return null},i}])}();
!function(){angular.module("designerApp").factory("shareService",["$http","utilityService","commandService",function(e,n,i){var r={};return r.findUserByEmail=function(n){return e.post("../../account/findbyemail",{email:n})},r.shareWith=function(e,n,r){return i.execute("AddSharedPersonToQuestionnaire",{email:e,questionnaireId:n,shareType:r})},r.revokeAccess=function(e,n){return i.execute("RemoveSharedPersonFromQuestionnaire",{email:e,questionnaireId:n})},r.udpateQuestionnaire=function(e,n,r){return i.execute("UpdateQuestionnaire",{title:n,questionnaireId:e,isPublic:r})},r}])}();
!function(){angular.module("designerApp").factory("userService",["$http",function(r){var e={};return e.getCurrentUserName=function(){return r.get("../../api/users/CurrentLogin")},e}])}();
!function(){angular.module("designerApp").factory("utilityService",["$rootScope","$timeout",function(t,e){var n={};return n.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+t()+t()+t()+t()+t()+t()},n.format=function(t){var e=Array.prototype.slice.call(arguments,1);return t.replace(/{(\d+)}/g,function(t,n){return void 0!==e[n]?e[n]:t})},n.focus=function(n){e(function(){t.$broadcast("focusOn",n)})},n.setFocusIn=function(t){t&&e(function(){var e=angular.element("#"+t);if(!_.isNull(e)&&!_.isUndefined(e))if(e.attr("ui-ace")){var n=ace.edit(e.attr("id"));n.focus(),n.navigateFileEnd()}else e.focus()},300)},n.focusout=function(n){e(function(){t.$broadcast("focusOut",n)})},n.moveFocusAndAddOptionIfNeeded=function(t,n,o,i,r,u){var a=$(t);if(!(a.parents(n).length<=0)){var c=angular.element(a).scope()[u],s=i.indexOf(c);s<0||(s===i.length-1&&r(),e(function(){var t=$(o),e=$(t[s+1]);e.focus(),e.select()}))}},n.createQuestionForDeleteConfirmationPopup=function(t){return{title:'Are you sure you want to delete "'+t.substring(0,25)+(t.length>25?"...":"")+'"?',okButtonTitle:"DELETE",cancelButtonTitle:"BACK TO DESIGNER"}},n.createEmptyGroup=function(t){return{itemId:n.guid(),title:"New sub-section",items:[],itemType:"Group",hasCondition:!1,getParentItem:function(){return t}}},n.createEmptyRoster=function(t){return{itemId:n.guid(),title:"New roster",items:[],itemType:"Group",hasCondition:!1,isRoster:!0,getParentItem:function(){return t}}},n.createEmptyQuestion=function(t){return{itemId:n.guid(),title:"",type:"Text",itemType:"Question",hasCondition:!1,hasValidation:!1,getParentItem:function(){return t}}},n.createEmptyStaticText=function(t){return{itemId:n.guid(),text:"New static text",itemType:"StaticText",hasCondition:!1,hasValidation:!1,getParentItem:function(){return t}}},n.createEmptyVariable=function(t){return{itemId:n.guid(),itemType:"Variable",variableData:{},getParentItem:function(){return t}}},n.isTreeItemVisible=function(t){var e={top:$(".questionnaire-tree-holder > .scroller").offset().top,bottom:$(window).height()},n=t.offset().top,o=n+t.outerHeight(),i=n>e.top&&n<e.bottom,r=o>e.top&&o<e.bottom,u=Math.abs(n-e.top),a=Math.abs(o-e.bottom);return{isVisible:i&&r,shouldScrollDown:u<a,scrollPositionWhenScrollUp:e.top-$(".question-list").offset().top+a}},n.scrollToValidationCondition=function(t){_.isNull(t)||_.defer(function(){$(".question-editor .form-holder").scrollTo("#validationCondition"+t,500,{easing:"swing",offset:-10})})},n}])}();
!function(){angular.module("designerApp").factory("verificationService",["$http",function(e){var i={};return i.verify=function(i){return e.get("../../api/questionnaire/verify/"+i)},i}])}();
ace.define("ace/mode/doc_comment_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(e,t,n){"use strict";var r=e("../lib/oop"),i=e("./text_highlight_rules").TextHighlightRules,o=function(){this.$rules={start:[{token:"comment.doc.tag",regex:"@[\\w\\d_]+"},o.getTagRule(),{defaultToken:"comment.doc",caseInsensitive:!0}]}};r.inherits(o,i),o.getTagRule=function(e){return{token:"comment.doc.tag.storage.type",regex:"\\b(?:TODO|FIXME|XXX|HACK)\\b"}},o.getStartRule=function(e){return{token:"comment.doc",regex:"\\/\\*(?=\\*)",next:e}},o.getEndRule=function(e){return{token:"comment.doc",regex:"\\*\\/",next:e}},t.DocCommentHighlightRules=o}),ace.define("ace/mode/csharp_ex_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/doc_comment_highlight_rules","ace/mode/text_highlight_rules"],function(e,t,n){"use strict";var r=e("../lib/oop"),i=e("./doc_comment_highlight_rules").DocCommentHighlightRules,o=e("./text_highlight_rules").TextHighlightRules,s=function(e){var t="";if(e){var n=e();n&&(t=n.join("|"))}var r=this.createKeywordMapper({"variable.language":"this|self","support.variable":t,keyword:"abstract|event|new|struct|as|explicit|null|switch|base|extern|object|this|bool|false|operator|throw|break|finally|out|true|byte|fixed|override|try|case|float|params|typeof|catch|for|private|uint|char|foreach|protected|ulong|checked|goto|public|unchecked|class|if|readonly|unsafe|const|implicit|ref|ushort|continue|in|return|using|decimal|int|sbyte|virtual|default|interface|sealed|volatile|delegate|internal|short|void|do|is|sizeof|while|double|lock|stackalloc|else|long|static|enum|namespace|string|var|dynamic","constant.language":"null|true|false"},"identifier");this.$rules={start:[{token:"comment",regex:"\\/\\/.*$"},i.getStartRule("doc-start"),{token:"comment",regex:"\\/\\*",next:"comment"},{token:"string",regex:/'(?:.|\\(:?u[\da-fA-F]+|x[\da-fA-F]+|[tbrf'"n]))'/},{token:"string",start:'"',end:'"|$',next:[{token:"constant.language.escape",regex:/\\(:?u[\da-fA-F]+|x[\da-fA-F]+|[tbrf'"n])/},{token:"invalid",regex:/\\./}]},{token:"string",start:'@"',end:'"',next:[{token:"constant.language.escape",regex:'""'}]},{token:"string",start:/\$"/,end:'"|$',next:[{token:"constant.language.escape",regex:/\\(:?$)|{{/},{token:"constant.language.escape",regex:/\\(:?u[\da-fA-F]+|x[\da-fA-F]+|[tbrf'"n])/},{token:"invalid",regex:/\\./}]},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:r,regex:"[@a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"!|\\$|%|&|\\*|\\-\\-|\\-|\\+\\+|\\+|~|===|==|=|!=|!==|<=|>=|<<=|>>=|>>>=|<>|<|>|!|&&|\\|\\||\\?\\:|\\*=|%=|\\+=|\\-=|&=|\\^=|\\b(?:in|instanceof|new|delete|typeof|void)"},{token:"keyword",regex:"^\\s*#(if|else|elif|endif|define|undef|warning|error|line|region|endregion|pragma)"},{token:"punctuation.operator",regex:"\\?|\\:|\\,|\\;|\\."},{token:"paren.lparen",regex:"[[({]"},{token:"paren.rparen",regex:"[\\])}]"},{token:"text",regex:"\\s+"}],comment:[{token:"comment",regex:".*?\\*\\/",next:"start"},{token:"comment",regex:".+"}]},this.embedRules(i,"doc-",[i.getEndRule("start")]),this.normalizeRules()};r.inherits(s,o),t.CSharpHighlightRulesEx=s}),ace.define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"],function(e,t,n){"use strict";var r=e("../range").Range,i=function(){};(function(){this.checkOutdent=function(e,t){return!!/^\s+$/.test(e)&&/^\s*\}/.test(t)},this.autoOutdent=function(e,t){var n=e.getLine(t),i=n.match(/^(\s*\})/);if(!i)return 0;var o=i[1].length,s=e.findMatchingBracket({row:t,column:o});if(!s||s.row==t)return 0;var a=this.$getIndent(e.getLine(s.row));e.replace(new r(t,0,t,o-1),a)},this.$getIndent=function(e){return e.match(/^\s*/)[0]}}).call(i.prototype),t.MatchingBraceOutdent=i}),ace.define("ace/mode/behaviour/cstyle",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/token_iterator","ace/lib/lang"],function(e,t,n){"use strict";var r,i=e("../../lib/oop"),o=e("../behaviour").Behaviour,s=e("../../token_iterator").TokenIterator,a=e("../../lib/lang"),c=["text","paren.rparen","punctuation.operator"],u=["text","paren.rparen","punctuation.operator","comment"],l={},g=function(e){var t=-1;if(e.multiSelect&&(t=e.selection.index,l.rangeCount!=e.multiSelect.rangeCount&&(l={rangeCount:e.multiSelect.rangeCount})),l[t])return r=l[t];r=l[t]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""}},d=function(e,t,n,r){var i=e.end.row-e.start.row;return{text:n+t+r,selection:[0,e.start.column+1,i,e.end.column+(i?0:1)]}},h=function(){this.add("braces","insertion",function(e,t,n,i,o){var s=n.getCursorPosition(),c=i.doc.getLine(s.row);if("{"==o){g(n);var u=n.getSelectionRange(),l=i.doc.getTextRange(u);if(""!==l&&"{"!==l&&n.getWrapBehavioursEnabled())return d(u,l,"{","}");if(h.isSaneInsertion(n,i))return/[\]\}\)]/.test(c[s.column])||n.inMultiSelectMode?(h.recordAutoInsert(n,i,"}"),{text:"{}",selection:[1,1]}):(h.recordMaybeInsert(n,i,"{"),{text:"{",selection:[1,1]})}else if("}"==o){g(n);var f=c.substring(s.column,s.column+1);if("}"==f){var m=i.$findOpeningBracket("}",{column:s.column+1,row:s.row});if(null!==m&&h.isAutoInsertedClosing(s,c,o))return h.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}else{if("\n"==o||"\r\n"==o){g(n);var p="";h.isMaybeInsertedClosing(s,c)&&(p=a.stringRepeat("}",r.maybeInsertedBrackets),h.clearMaybeInsertedClosing());var f=c.substring(s.column,s.column+1);if("}"===f){var b=i.findMatchingBracket({row:s.row,column:s.column+1},"}");if(!b)return null;var k=this.$getIndent(i.getLine(b.row))}else{if(!p)return void h.clearMaybeInsertedClosing();var k=this.$getIndent(c)}var v=k+i.getTabString();return{text:"\n"+v+"\n"+k+p,selection:[1,v.length,1,v.length]}}h.clearMaybeInsertedClosing()}}),this.add("braces","deletion",function(e,t,n,i,o){var s=i.doc.getTextRange(o);if(!o.isMultiLine()&&"{"==s){g(n);if("}"==i.doc.getLine(o.start.row).substring(o.end.column,o.end.column+1))return o.end.column++,o;r.maybeInsertedBrackets--}}),this.add("parens","insertion",function(e,t,n,r,i){if("("==i){g(n);var o=n.getSelectionRange(),s=r.doc.getTextRange(o);if(""!==s&&n.getWrapBehavioursEnabled())return d(o,s,"(",")");if(h.isSaneInsertion(n,r))return h.recordAutoInsert(n,r,")"),{text:"()",selection:[1,1]}}else if(")"==i){g(n);var a=n.getCursorPosition(),c=r.doc.getLine(a.row),u=c.substring(a.column,a.column+1);if(")"==u){var l=r.$findOpeningBracket(")",{column:a.column+1,row:a.row});if(null!==l&&h.isAutoInsertedClosing(a,c,i))return h.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("parens","deletion",function(e,t,n,r,i){var o=r.doc.getTextRange(i);if(!i.isMultiLine()&&"("==o){g(n);if(")"==r.doc.getLine(i.start.row).substring(i.start.column+1,i.start.column+2))return i.end.column++,i}}),this.add("brackets","insertion",function(e,t,n,r,i){if("["==i){g(n);var o=n.getSelectionRange(),s=r.doc.getTextRange(o);if(""!==s&&n.getWrapBehavioursEnabled())return d(o,s,"[","]");if(h.isSaneInsertion(n,r))return h.recordAutoInsert(n,r,"]"),{text:"[]",selection:[1,1]}}else if("]"==i){g(n);var a=n.getCursorPosition(),c=r.doc.getLine(a.row),u=c.substring(a.column,a.column+1);if("]"==u){var l=r.$findOpeningBracket("]",{column:a.column+1,row:a.row});if(null!==l&&h.isAutoInsertedClosing(a,c,i))return h.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("brackets","deletion",function(e,t,n,r,i){var o=r.doc.getTextRange(i);if(!i.isMultiLine()&&"["==o){g(n);if("]"==r.doc.getLine(i.start.row).substring(i.start.column+1,i.start.column+2))return i.end.column++,i}}),this.add("string_dquotes","insertion",function(e,t,n,r,i){if('"'==i||"'"==i){g(n);var o=i,s=n.getSelectionRange(),a=r.doc.getTextRange(s);if(""!==a&&"'"!==a&&'"'!=a&&n.getWrapBehavioursEnabled())return d(s,a,o,o);if(!a){var c=n.getCursorPosition(),u=r.doc.getLine(c.row),l=u.substring(c.column-1,c.column),h=u.substring(c.column,c.column+1),f=r.getTokenAt(c.row,c.column),m=r.getTokenAt(c.row,c.column+1);if("\\"==l&&f&&/escape/.test(f.type))return null;var p,b=f&&/string|escape/.test(f.type),k=!m||/string|escape/.test(m.type);if(h==o)p=b!==k;else{if(b&&!k)return null;if(b&&k)return null;var v=r.$mode.tokenRe;v.lastIndex=0;var x=v.test(l);v.lastIndex=0;var R=v.test(l);if(x||R)return null;if(h&&!/[\s;,.})\]\\]/.test(h))return null;p=!0}return{text:p?o+o:"",selection:[1,1]}}}}),this.add("string_dquotes","deletion",function(e,t,n,r,i){var o=r.doc.getTextRange(i);if(!i.isMultiLine()&&('"'==o||"'"==o)){g(n);if(r.doc.getLine(i.start.row).substring(i.start.column+1,i.start.column+2)==o)return i.end.column++,i}})};h.isSaneInsertion=function(e,t){var n=e.getCursorPosition(),r=new s(t,n.row,n.column);if(!this.$matchTokenType(r.getCurrentToken()||"text",c)){var i=new s(t,n.row,n.column+1);if(!this.$matchTokenType(i.getCurrentToken()||"text",c))return!1}return r.stepForward(),r.getCurrentTokenRow()!==n.row||this.$matchTokenType(r.getCurrentToken()||"text",u)},h.$matchTokenType=function(e,t){return t.indexOf(e.type||e)>-1},h.recordAutoInsert=function(e,t,n){var i=e.getCursorPosition(),o=t.doc.getLine(i.row);this.isAutoInsertedClosing(i,o,r.autoInsertedLineEnd[0])||(r.autoInsertedBrackets=0),r.autoInsertedRow=i.row,r.autoInsertedLineEnd=n+o.substr(i.column),r.autoInsertedBrackets++},h.recordMaybeInsert=function(e,t,n){var i=e.getCursorPosition(),o=t.doc.getLine(i.row);this.isMaybeInsertedClosing(i,o)||(r.maybeInsertedBrackets=0),r.maybeInsertedRow=i.row,r.maybeInsertedLineStart=o.substr(0,i.column)+n,r.maybeInsertedLineEnd=o.substr(i.column),r.maybeInsertedBrackets++},h.isAutoInsertedClosing=function(e,t,n){return r.autoInsertedBrackets>0&&e.row===r.autoInsertedRow&&n===r.autoInsertedLineEnd[0]&&t.substr(e.column)===r.autoInsertedLineEnd},h.isMaybeInsertedClosing=function(e,t){return r.maybeInsertedBrackets>0&&e.row===r.maybeInsertedRow&&t.substr(e.column)===r.maybeInsertedLineEnd&&t.substr(0,e.column)==r.maybeInsertedLineStart},h.popAutoInsertedClosing=function(){r.autoInsertedLineEnd=r.autoInsertedLineEnd.substr(1),r.autoInsertedBrackets--},h.clearMaybeInsertedClosing=function(){r&&(r.maybeInsertedBrackets=0,r.maybeInsertedRow=-1)},i.inherits(h,o),t.CstyleBehaviour=h}),ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"],function(e,t,n){"use strict";var r=e("../../lib/oop"),i=e("../../range").Range,o=e("./fold_mode").FoldMode,s=t.FoldMode=function(e){e&&(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+e.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+e.end)))};r.inherits(s,o),function(){this.foldingStartMarker=/(\{|\[)[^\}\]]*$|^\s*(\/\*)/,this.foldingStopMarker=/^[^\[\{]*(\}|\])|^[\s\*]*(\*\/)/,this.singleLineBlockCommentRe=/^\s*(\/\*).*\*\/\s*$/,this.tripleStarBlockCommentRe=/^\s*(\/\*\*\*).*\*\/\s*$/,this.startRegionRe=/^\s*(\/\*|\/\/)#?region\b/,this._getFoldWidgetBase=this.getFoldWidget,this.getFoldWidget=function(e,t,n){var r=e.getLine(n);if(this.singleLineBlockCommentRe.test(r)&&!this.startRegionRe.test(r)&&!this.tripleStarBlockCommentRe.test(r))return"";var i=this._getFoldWidgetBase(e,t,n);return!i&&this.startRegionRe.test(r)?"start":i},this.getFoldWidgetRange=function(e,t,n,r){var i=e.getLine(n);if(this.startRegionRe.test(i))return this.getCommentRegionBlock(e,i,n);var o=i.match(this.foldingStartMarker);if(o){var s=o.index;if(o[1])return this.openingBracketBlock(e,o[1],n,s);var a=e.getCommentFoldRange(n,s+o[0].length,1);return a&&!a.isMultiLine()&&(r?a=this.getSectionRange(e,n):"all"!=t&&(a=null)),a}if("markbegin"!==t){var o=i.match(this.foldingStopMarker);if(o){var s=o.index+o[0].length;return o[1]?this.closingBracketBlock(e,o[1],n,s):e.getCommentFoldRange(n,s,-1)}}},this.getSectionRange=function(e,t){var n=e.getLine(t),r=n.search(/\S/),o=t,s=n.length;t+=1;for(var a=t,c=e.getLength();++t<c;){n=e.getLine(t);var u=n.search(/\S/);if(u!==-1){if(r>u)break;var l=this.getFoldWidgetRange(e,"all",t);if(l){if(l.start.row<=o)break;if(l.isMultiLine())t=l.end.row;else if(r==u)break}a=t}}return new i(o,s,a,e.getLine(a).length)},this.getCommentRegionBlock=function(e,t,n){for(var r=t.search(/\s*$/),o=e.getLength(),s=n,a=/^\s*(?:\/\*|\/\/|--)#?(end)?region\b/,c=1;++n<o;){t=e.getLine(n);var u=a.exec(t);if(u&&(u[1]?c--:c++,!c))break}var l=n;if(l>s)return new i(s,r,l,t.length)}}.call(s.prototype)}),ace.define("ace/mode/folding/csharp",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/cstyle"],function(e,t,n){"use strict";var r=e("../../lib/oop"),i=e("../../range").Range,o=e("./cstyle").FoldMode,s=t.FoldMode=function(e){e&&(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+e.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+e.end)))};r.inherits(s,o),function(){this.usingRe=/^\s*using \S/,this.getFoldWidgetRangeBase=this.getFoldWidgetRange,this.getFoldWidgetBase=this.getFoldWidget,this.getFoldWidget=function(e,t,n){var r=this.getFoldWidgetBase(e,t,n);if(!r){var i=e.getLine(n);if(/^\s*#region\b/.test(i))return"start";var o=this.usingRe;if(o.test(i)){var s=e.getLine(n-1),a=e.getLine(n+1);if(!o.test(s)&&o.test(a))return"start"}}return r},this.getFoldWidgetRange=function(e,t,n){var r=this.getFoldWidgetRangeBase(e,t,n);if(r)return r;var i=e.getLine(n);return this.usingRe.test(i)?this.getUsingStatementBlock(e,i,n):/^\s*#region\b/.test(i)?this.getRegionBlock(e,i,n):void 0},this.getUsingStatementBlock=function(e,t,n){for(var r=t.match(this.usingRe)[0].length-1,o=e.getLength(),s=n,a=n;++n<o;)if(t=e.getLine(n),!/^\s*$/.test(t)){if(!this.usingRe.test(t))break;a=n}if(a>s){return new i(s,r,a,e.getLine(a).length)}},this.getRegionBlock=function(e,t,n){for(var r=t.search(/\s*$/),o=e.getLength(),s=n,a=/^\s*#(end)?region\b/,c=1;++n<o;){t=e.getLine(n);var u=a.exec(t);if(u&&(u[1]?c--:c++,!c))break}var l=n;if(l>s)return new i(s,r,l,t.length)}}.call(s.prototype)}),ace.define("ace/mode/csharp-extended",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/csharp_ex_highlight_rules","ace/mode/matching_brace_outdent","ace/mode/behaviour/cstyle","ace/mode/folding/csharp"],function(e,t,n){"use strict";var r=e("../lib/oop"),i=e("./text").Mode,o=e("./csharp_ex_highlight_rules").CSharpHighlightRulesEx,s=e("./matching_brace_outdent").MatchingBraceOutdent,a=e("./behaviour/cstyle").CstyleBehaviour,c=e("./folding/csharp").FoldMode,u=function(e){this.HighlightRules=function(){return new o(e)},this.$outdent=new s,this.$behaviour=new a,this.foldingRules=new c};r.inherits(u,i),function(){this.lineCommentStart="//",this.blockComment={start:"/*",end:"*/"},this.getNextLineIndent=function(e,t,n){var r=this.$getIndent(t),i=this.getTokenizer().getLineTokens(t,e),o=i.tokens;if(o.length&&"comment"==o[o.length-1].type)return r;if("start"==e){t.match(/^.*[\{\(\[]\s*$/)&&(r+=n)}return r},this.checkOutdent=function(e,t,n){return this.$outdent.checkOutdent(t,n)},this.autoOutdent=function(e,t,n){this.$outdent.autoOutdent(t,n)},this.createWorker=function(e){return null},this.$id="ace/mode/csharp-custom"}.call(u.prototype),t.Mode=u});
ace.define("ace/mode/text-extended",["require","exports","module","ace/lib/oop","ace/mode/text"],function(t,e,i){"use strict";var o=t("../lib/oop"),s=t("./text").Mode,u=t("ace/mode/text_with_substitutions_highlight_rules").SubstitutionsHighlightRules,h=function(){this.HighlightRules=u};o.inherits(h,s),function(){}.call(h.prototype),e.Mode=h}),ace.define("ace/mode/text_with_substitutions_highlight_rules",["require","exports","module","ace/lib/oop","text_highlight_rules"],function(t,e,i){"use strict";var o=t("../lib/oop"),s=t("./text_highlight_rules").TextHighlightRules,u=function(){this.$rules={start:[{token:"support.variable",regex:"%[a-zA-Z][_a-zA-Z0-9]{0,31}%"}]}};o.inherits(u,s),e.SubstitutionsHighlightRules=u});
ace.define("ace/theme/github-extended",["require","exports","module","ace/lib/dom"],function(e,a,c){a.isDark=!1,a.cssClass="ace-github",a.cssText='.ace-github .ace_gutter {background: #e8e8e8;color: #AAA;}.ace-github  {background: #fff;color: #000;}.ace-github .ace_keyword {font-weight: bold;}.ace-github .ace_string {color: #D14;}.ace-github .ace_variable.ace_class {color: teal;}.ace-github .ace_constant.ace_numeric {color: #099;}.ace-github .ace_constant.ace_buildin {color: #0086B3;}.ace-github .ace_support.ace_function {color: #0086B3;}.ace-github .ace_variable  {box-shadow: 0 -1px 0 #dd2c2c inset;}.ace-github .ace_support.ace_variable  {color: #3da802;box-shadow: none;}.ace-github .ace_comment {color: #998;font-style: italic;}.ace-github .ace_variable.ace_language  {color: #0086B3;}.ace-github .ace_paren {font-weight: bold;}.ace-github .ace_boolean {font-weight: bold;}.ace-github .ace_string.ace_regexp {color: #009926;font-weight: normal;}.ace-github .ace_variable.ace_instance {color: teal;}.ace-github .ace_constant.ace_language {font-weight: bold;}.ace-github .ace_cursor {color: black;}.ace-github.ace_focus .ace_marker-layer .ace_active-line {background: rgb(255, 255, 204);}.ace-github .ace_marker-layer .ace_active-line {background: rgb(245, 245, 245);}.ace-github .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-github.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-github.ace_nobold .ace_line > span {font-weight: normal !important;}.ace-github .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-github .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-github .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-github .ace_gutter-active-line {background-color : rgba(0, 0, 0, 0.07);}.ace-github .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-github .ace_invisible {color: #BFBFBF}.ace-github .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-github .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}',e("../lib/dom").importCssString(a.cssText,a.cssClass)});