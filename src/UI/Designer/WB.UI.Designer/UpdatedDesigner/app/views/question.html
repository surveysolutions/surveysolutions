<form role="form" id="question-editor" name="questionForm" unsaved-warning-form>
    <div class="form-holder">
        <div data-item-breadcrumbs data-crumbs="activeQuestion.breadcrumbs"></div>

        <div class="row">
            <div class="form-group col-xs-7">
                <label for="edit-group-title" class="wb-label">Question Type</label><br>
                <div class="btn-group type-container-dropdown" dropdown>
                    <button id="questionTypeBtn" class="btn btn-default dropdown-toggle form-control" type="button">
                        <i class="icon {{answerTypeClass[activeQuestion.type]}}"></i>
                        <span class="vertical-line"></span>
                        {{activeQuestion.typeName}}
                        <span class="dropdown-arrow"></span>
                    </button>

                    <ul class="dropdown-menu " role="menu" aria-labelledby="questionTypeBtn">
                        <li role="presentation" ng-repeat="type in activeQuestion.questionTypeOptions">
                            <a role="menuitem" tabindex="-1" href="javascript:void(0);" ng-click="setQuestionType(type.value)">
                                <i class="icon {{answerTypeClass[type.value]}}"></i>
                                {{type.text}}
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="form-group input-variable-name col-xs-4 pull-right">
                <label for="edit-group-title" class="wb-label">Variable name<help key="variableName" /></label><br>
                <input id="edit-question-variable-name" type="text" ng-model="activeQuestion.variable"
                       class="form-control">
            </div>
        </div>

        <div class="form-group">
            <label for="edit-group-title" class="wb-label">Variable label<help key="variableLabel" /></label><br>
            <input id="edit-variable-label" type="text" ng-model="activeQuestion.variableLabel" class="form-control">
        </div>

        <div class="form-group">
            <label for="edit-question-title" class="wb-label">Title</label><br>
            <textarea id="edit-question-title" type="text" ng-model="activeQuestion.title" class="form-control" placeholder="Question text" msd-elastic></textarea>

            <div class="question-type-specific-block"
                 ng-include="activeQuestion.type + '-template.html'"
                 ng-if="activeQuestion.type != undefined
                 && ( activeQuestion.type!='DateTime'
                 && activeQuestion.type!='GpsCoordinates'
                 && activeQuestion.type!='QRBarcode')
                 ">
            </div>
        </div>
        <div class="form-group" ng-show="!((showInstruction===undefined && initialQuestion.instructions) || showInstruction)">
            <button type="button" class="btn btn-lg btn-link" ng-click="showInstruction=true">Add Instruction</button>
        </div>

        <div class="row" ng-show="(showInstruction===undefined && initialQuestion.instructions) || showInstruction">
            <div class="form-group col-xs-11">
                <label for="edit-question-instructions">Instruction <help key="instruction" /></label>
                <textarea id="edit-question-instructions" ng-model="activeQuestion.instructions" class="form-control" msd-elastic></textarea>
            </div>

            <div class="form-group col-xs-1 pull-right">
                <button type="button" class="btn cross instructions-cross" ng-click="showInstruction=false;activeQuestion.instructions='';"></button>
            </div>
        </div>

        <div class="form-group" ng-hide="activeQuestion.questionScope == 'Prefilled'" ng-class="{'has-error': !questionForm.enablementCondition.$valid}">
            <label for="edit-question-enablement-condition">Condition expression <help key="conditionExpression" /></label>
            <textarea id="edit-question-enablement-condition"
                      name="enablementCondition"
                      deny-this-keyword msd-elastic
                      ng-model="activeQuestion.enablementCondition"
                      class="form-control"></textarea>
            <p class="help-block ng-cloak" ng-show="questionForm.enablementCondition.$error.denyThisKeyword">
                You cannot use self-reference in conditions
            </p>
        </div>

        <div class="form-group" ng-hide="activeQuestion.type == 'TextList' || activeQuestion.type == 'QRBarcode'">
            <label for="edit-question-validation-expression">Validation expression <help key="validationExpression" /></label>
            <textarea id="edit-question-validation-expression" ng-model="activeQuestion.validationExpression"
                      class="form-control" msd-elastic></textarea>
        </div>

        <div class="form-group" ng-hide="activeQuestion.type == 'TextList' || activeQuestion.type == 'QRBarcode'">
            <label for="edit-question-validation-message">Validation message <help key="validationMessage" /></label>
            <textarea id="edit-question-validation-message" ng-model="activeQuestion.validationMessage"
                      class="form-control" msd-elastic></textarea>
        </div>


        <div class="form-group">
            <div class="row">
                <div class="form-group col-xs-5">
                    <input id="mandatory-question" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.isMandatory" />
                    <label for="mandatory-question"><span></span>Mandatory question</label>
                </div>
                <div class="form-group col-xs-7" ng-hide="activeQuestion.type == 'TextList' || activeQuestion.type == 'QRBarcode'">
                    <label for="Question-scope">Question scope&nbsp;</label>
                    <div class="btn-group dropup" dropdown>
                        <button class="btn dropdown-toggle" id="Question-scope" type="button">
                            {{ activeQuestion.questionScope }}
                            <span class="dropdown-arrow"></span>
                        </button>

                        <ul class="dropdown-menu " role="menu" aria-labelledby="dropdownMenu1" ng-hide="activeQuestion.type == 'GpsCoordinates'">
                            <li role="presentation" ng-repeat="scope in activeQuestion.allQuestionScopeOptions">
                                <a role="menuitem" tabindex="-1" href="javascript:void(0);" ng-click="changeQuestionScope(scope)">
                                    {{scope.text}}
                                </a>
                            </li>
                        </ul>
                        <ul class="dropdown-menu " role="menu" aria-labelledby="dropdownMenu1" ng-show="activeQuestion.type == 'GpsCoordinates'">
                            <li role="presentation" ng-repeat="scope in activeQuestion.notPrefilledQuestionScopeOptions">
                                <a role="menuitem" tabindex="-1" href="javascript:void(0);" ng-click="changeQuestionScope(scope)">
                                    {{scope.text}}
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/ng-template" id="SingleOption-template.html">
            <div class="singleOption">
                <div class="well well-sm" ng-if="!activeQuestion.isFilteredCombobox && !activeQuestion.isLinked && activeQuestion.wereOptionsTruncated">As the question was marked as "Is filtered combobox" while uploading question's details and contained many options, its value is reduced up to 20</div>
                <div ng-if="!activeQuestion.isFilteredCombobox && !activeQuestion.isLinked" class="table-holder">
                    <div class="table-row" ng-repeat="option in activeQuestion.options">
                        <div class="column-2">
                            <input type="text" ng-model="option.value" class="form-control">
                        </div>
                        <div class="column-3">
                            <input type="text" ng-model="option.title" class="form-control">
                        </div>
                        <div class="column-4">
                            <a href ng:click="removeOption($index)" class="btn"></a>
                        </div>
                    </div>
                </div>
                <p>
                    <input ng-if="!activeQuestion.isFilteredCombobox && !activeQuestion.isLinked" class="btn btn-link" type="button" value="Add Option" ng-click="addOption()">
                    <a ng-if="activeQuestion.isFilteredCombobox"
                       href="javascript:void(0);"
                       class="btn btn-link"
                       ng-click="editFilteredComboboxOptions()">
                        <ng-pluralize count="activeQuestion.optionsCount"
                                      when="{'0': 'Add options',
                                     'one': 'Edit 1 option',
                                     'other': 'Edit {} options'}">
                        </ng-pluralize>
                    </a>
                </p>
                <div class="table-holder">
                    <div class="row">
                        <div class="col-xs-4">
                            <div class="checkbox checkbox-in-column">
                                <input id="cb-is-filtered-combobox" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.isFilteredCombobox" />
                                <label for="cb-is-filtered-combobox"><span></span>Is filtered combobox</label>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <div ng-if="!activeQuestion.isFilteredCombobox" class="checkbox checkbox-in-column">
                                <input id="cb-is-linked" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.isLinked" />
                                <label for="cb-is-linked"><span></span>Is linked</label>
                            </div>
                        </div>

                    </div>
                </div>
                <div ng-if="!activeQuestion.isFilteredCombobox" class="form-group"
                     ng-include="activeQuestion.isLinked ? 'linkTemplate.html' : ''" ng-class="{'has-error': !questionForm.linkedToQuestion.$valid}" />
        </script>


        <script type="text/ng-template" id="linkTemplate.html">
            <div id="sourceOfLinkedQuestion" class="dropdown-with-breadcrumbs-and-icons">
                <input type="hidden" name="linkedToQuestion" ng-model="activeQuestion.linkedToQuestion" ng-required="true" />
                <label for="linkedQuestionSource">Bind to question from roster group</label>
                <div class="btn-group" dropdown>
                    <button class="btn dropdown-toggle" id="linkedQuestionSource" type="button">
                        <span class="select-placeholder" ng-if="(activeQuestion.linkedToQuestion.title || '') == ''">Select question</span>

                        <span class="selected-item" ng-if="(activeQuestion.linkedToQuestion.title || '') !== ''">
                            <span class="path">{{activeQuestion.linkedToQuestion.breadcrumbs}}</span>
                            <span class="chosen-item"><i class="dropdown-icon" ng-class="'icon-'+activeQuestion.linkedToQuestion.type"></i>{{activeQuestion.linkedToQuestion.title}}</span>
                        </span>
                        <span class="dropdown-arrow"></span>
                    </button>

                    <ul class="dropdown-menu" role="menu">
                        <li role="presentation" ng-class="{'dropdown-header': breadCrumb.isSectionPlaceHolder}" ng-repeat="breadCrumb in sourceOfLinkedQuestions">
                            <span ng-if="breadCrumb.isSectionPlaceHolder">{{breadCrumb.title}}</span>

                            <a ng-if="!breadCrumb.isSectionPlaceHolder"
                               ng-click="setLinkSource(breadCrumb.id)"
                               role="menuitem"
                               tabindex="-1"
                               href="javascript:void(0);">
                                <i class="dropdown-icon" ng-class="'icon-'+breadCrumb.type"></i> {{breadCrumb.title}}
                            </a>
                        </li>
                    </ul>
                </div>
                <p class="help-block ng-cloak" ng-show="questionForm.linkedToQuestion.$error.required">
                    You must bind this question
                </p>
            </div>
        </script>

        <script type="text/ng-template" id="MultyOption-template.html">
            <div class="multyOption">
                <div ng-if="!activeQuestion.isLinked">
                    <div class="table-holder">
                        <div class="table-row" ng-repeat="option in activeQuestion.options">
                            <div class="column-2">
                                <input type="text" ng-model="option.value" class="form-control">
                            </div>
                            <div class="column-3">
                                <input type="text" ng-model="option.title" class="form-control">
                            </div>
                            <div class="column-4">
                                <a href ng:click="removeOption($index)" class="btn"></a>
                            </div>
                        </div>
                    </div>
                    <p>
                        <input type="button" ng-if="!activeQuestion.isLinked" class="btn btn-link" value="Add Option" id="edit-question-save-button" ng-click="addOption()">
                    </p>
                </div>
                <div class="row">
                    <div class="col-xs-3">
                        <div class="checkbox checkbox-in-column">
                            <input id="cb-multyoption-is-linked" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.isLinked" />
                            <label for="cb-multyoption-is-linked"><span></span>Is linked</label>
                        </div>
                    </div>
                    <div class="col-xs-3">
                        <div class="checkbox checkbox-in-column">
                            <input id="cb-is-ordered" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.areAnswersOrdered" />
                            <label for="cb-is-ordered"><span></span>Ordered</label>
                        </div>
                    </div>
                    <div class="col-xs-6">
                        <div class="form-group singleline-group" ng-class="{'has-error': !questionForm.editQuestionMaxAnswersNumber.$valid}">
                            <label for="edit-question-max-answers-number">Maximum answers count</label>
                            <input name="editQuestionMaxAnswersNumber" ng-pattern="/^\d+$/" id="edit-question-max-answers-number" type="text" class="form-control small-numeric-input" ng-model="activeQuestion.maxAllowedAnswers">
                            <p class="help-block ng-cloak" ng-show="questionForm.editQuestionMaxAnswersNumber.$error.pattern">
                                Only integers are allowed
                            </p>
                        </div>
                    </div>
                </div>
                <div class="form-group" ng-include="activeQuestion.isLinked ? 'linkTemplate.html' : ''" ng-class="{'has-error': !questionForm.linkedToQuestion.$valid}">
                </div>
            </div>
        </script>
        <script type="text/ng-template" id="Numeric-template.html">
            <div class="row">
                <div class="col-xs-3">
                    <div class="checkbox checkbox-in-column">
                        <input id="cb-is-integer" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.isInteger" />
                        <label for="cb-is-integer"><span></span>Is Integer</label>
                    </div>
                </div>
                <div class="col-xs-9 inline-inputs">
                    <div class="form-group" ng-show="!activeQuestion.isInteger">
                        <label for="edit-question-count-decimal">Count Of Decimal Places</label>
                        <input id="edit-question-count-decimal" type="text" ng-model="activeQuestion.countOfDecimalPlaces" class="form-control small-numeric-input">
                    </div>
                    <div class="form-group" ng-show="activeQuestion.isInteger">
                        <label for="edit-question-max-value">Max value</label>
                        <input id="edit-question-max-value" type="text" ng-model="activeQuestion.maxValue" class="form-control  small-numeric-input">
                    </div>
                </div>
            </div>
        </script>

        <script type="text/ng-template" id="Text-template.html">
            <div class="form-group">
                <label for="edit-mask">Mask <help key="mask" /></label>
                <input id="edit-mask" type="text" ng-model="activeQuestion.mask" class="form-control" placeholder="Mask">
            </div>

        </script>

        <script type="text/ng-template" id="TextList-template.html">
            <div class="form-group">
                <label for="edit-question-max-answers-number">Maximum number of answers</label>
                <input id="edit-question-max-answers-number" type="text" ng-model="activeQuestion.maxAnswerCount" class="form-control">
            </div>
        </script>
        <script type="text/ng-template" id="DateTime-template.html">
        </script>
        <script type="text/ng-template" id="GpsCoordinates-template.html">
        </script>
        <script type="text/ng-template" id="QRBarcode-template.html">
        </script>
    </div>
    <div class="form-buttons-holder">
        <div class="pull-left">
            <button type="submit" id="edit-chapter-save-button" class="btn btn-lg btn-primary" ng-click="saveQuestion()" ng-disabled="!questionForm.$valid">Save</button>
            <button type="reset" id="edit-chapter-cancel-button" class="btn btn-lg btn-link" ng-click="cancelQuestion()">Cancel</button>
        </div>
        <div class="pull-right">
            <button type="button" id="edit-chapter-delete-button" class="btn btn-lg btn-link" ng-click="deleteQuestion(activeQuestion)" unsaved-warning-clear>Delete</button>
            <button type="button" id="edit-chapter-clone-button" class="btn btn-lg btn-link" ng-click="cloneQuestion()">Clone</button>
            <ng-include src="'moveToChapterSnippet'" />
        </div>
    </div>
</form>
