<form role="form" id="question-editor" name="questionForm" unsaved-warning-form>
    <div id="show-reload-details-promt" class="ng-cloak" ng-show="activeQuestion.shouldUserSeeReloadDetailsPromt">
        <div class="inner">Click <a ng-click="loadQuestion();" href="javascript:void(0);">reload</a> to update options</div>
    </div>
    <div class="form-holder">

        <div class="breadcrumbs-container"><div data-item-breadcrumbs data-crumbs="activeQuestion.breadcrumbs"></div></div>

        <div class="row">
            <div class="form-group col-xs-7">
                <label for="edit-group-title" class="wb-label">Question type</label><br>
                <div class="btn-group type-container-dropdown" dropdown>
                    <button id="questionTypeBtn" class="btn btn-default form-control" dropdown-toggle type="button">
                        <i class="icon {{answerTypeClass[activeQuestion.type]}}"></i>
                        <span class="vertical-line"></span>
                        {{activeQuestion.typeName}}
                        <span class="dropdown-arrow"></span>
                    </button>

                    <ul class="dropdown-menu " role="menu" aria-labelledby="questionTypeBtn">
                        <li role="presentation" ng-repeat="type in activeQuestion.questionTypeOptions">
                            <a role="menuitem" tabindex="-1" href="javascript:void(0);" ng-click="setQuestionType(type.value)">
                                <i class="icon {{answerTypeClass[type.value]}}"></i>
                                {{type.text}}
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="form-group input-variable-name col-xs-4 pull-right">
                <label for="edit-question-variable-name" class="wb-label">Variable name<help key="variableName" placement="left" /></label><br />
                <input id="edit-question-variable-name" type="text" ng-model="activeQuestion.variable" spellcheck="false"
                       class="form-control" maxlength="32">
            </div>
        </div>

        <div class="form-group">
            <label for="edit-variable-label" class="wb-label">Variable label<help key="variableLabel" /></label><br>
            <input id="edit-variable-label" type="text" ng-model="activeQuestion.variableLabel" class="form-control" maxlength="80">
        </div>

        <div class="form-group">
            <label for="edit-question-title" class="wb-label">Question text</label><br>
            <textarea id="edit-question-title" type="text" ng-model="activeQuestion.title" class="form-control" msd-elastic></textarea>

            <div class="question-type-specific-block"
                 ng-include="activeQuestion.type + '-template.html'"
                 ng-if="activeQuestion.type != undefined
                 && ( activeQuestion.type!='DateTime'
                 && activeQuestion.type!='GpsCoordinates'
                 && activeQuestion.type!='QRBarcode'
                 && activeQuestion.type!='Multimedia')
                 ">
            </div>
        </div>
        <div class="form-group" ng-show="!((showInstruction===undefined && initialQuestion.instructions) || showInstruction)">
            <button type="button" class="btn btn-lg btn-link" ng-click="showInstruction=true">Add Interviewer Instruction</button>
        </div>

        <div class="row" ng-show="(showInstruction===undefined && initialQuestion.instructions) || showInstruction">
            <div class="form-group col-xs-11">
                <label for="edit-question-instructions">Instruction <help key="instruction" /></label>
                <textarea id="edit-question-instructions" ng-model="activeQuestion.instructions" class="form-control" msd-elastic></textarea>
            </div>

            <div class="form-group col-xs-1 pull-right">
                <button type="button" class="btn cross instructions-cross" ng-click="showInstruction=false;activeQuestion.instructions='';questionForm.$setDirty();"></button>
            </div>
        </div>

        <div class="form-group" ng-hide="!doesQuestionSupportEnablementConditions()">
            <label for="edit-question-enablement-condition">Enabling condition <help key="conditionExpression"/></label>
            <div class="pseudo-form-control">
                <div id="edit-question-enablement-condition" ui-ace="{ onLoad : aceLoaded }" ng-model="activeQuestion.enablementCondition"></div>
            </div>
        </div>

        <div class="form-group" ng-show="doesQuestionSupportValidations()">
            <label for="edit-question-validation-expression">Validation condition <help key="validationExpression"/></label>
            <div class="pseudo-form-control">
                <div id="edit-question-validation-expression" ui-ace="{ onLoad : aceLoaded }" ng-model="activeQuestion.validationExpression"></div>
            </div>
        </div>

        <div class="form-group" ng-show="doesQuestionSupportValidations()">
            <label for="edit-question-validation-message">Error message <help key="validationMessage" /></label>
            <textarea id="edit-question-validation-message" ng-model="activeQuestion.validationMessage"
                      class="form-control" msd-elastic></textarea>
        </div>


        <div class="form-group">
            <div class="row">
                <div class="form-group col-xs-5">
                    <input id="mandatory-question" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.isMandatory" />
                    <label for="mandatory-question"><span></span>Mandatory question</label>
                </div>
                <div class="form-group col-xs-7" ng-hide="activeQuestion.type == 'TextList' || activeQuestion.type == 'QRBarcode'|| activeQuestion.type == 'Multimedia' || activeQuestion.type == 'GpsCoordinates' || activeQuestion.isCascade == true || activeQuestion.isLinked == true">
                    <label for="Question-scope">Question scope&nbsp;</label>
                    <div class="btn-group dropup" dropdown>
                        <button class="btn dropdown-toggle" id="Question-scope" dropdown-toggle type="button">
                            {{ activeQuestion.questionScope }}
                            <span class="dropdown-arrow"></span>
                        </button>

                        <ul class="dropdown-menu " role="menu" aria-labelledby="dropdownMenu1" ng-hide="activeQuestion.type == 'GpsCoordinates' || activeQuestion.type == 'MultyOption'">
                            <li role="presentation" ng-repeat="scope in activeQuestion.allQuestionScopeOptions">
                                <a role="menuitem" tabindex="-1" href="javascript:void(0);" ng-click="changeQuestionScope(scope)">
                                    {{scope.text}}
                                </a>
                            </li>
                        </ul>
                        <ul class="dropdown-menu " role="menu" aria-labelledby="dropdownMenu1" ng-show="activeQuestion.type == 'GpsCoordinates' || activeQuestion.type == 'MultyOption'">
                            <li role="presentation" ng-repeat="scope in activeQuestion.notPrefilledQuestionScopeOptions">
                                <a role="menuitem" tabindex="-1" href="javascript:void(0);" ng-click="changeQuestionScope(scope)">
                                    {{scope.text}}
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    <script type="text/ng-template" id="SingleOption-template.html">
            <div class="singleOption">
                <div class="well well-sm" ng-if="!(activeQuestion.isCascade || activeQuestion.isFilteredCombobox) && !activeQuestion.isLinked && activeQuestion.wereOptionsTruncated">As the question was marked as "Combo box" or "Cascading combo box" while uploading question's details and contained many options, it's value was reduced up to 200</div>
                <div ng-if="!activeQuestion.isFilteredCombobox && !activeQuestion.isLinked && !activeQuestion.isCascade">
                    <div ng-if="activeQuestion.useListAsOptionsEditor">
                        <div class="table-holder">
                            <div class="table-row" ng-repeat="option in activeQuestion.options">
                                <div class="column-2">
                                    <input type="text" ng-model="option.value" class="form-control">
                                </div>
                                <div class="column-3">
                                    <input type="text" ng-model="option.title" class="form-control">
                                </div>
                                <div class="column-4">
                                    <a href ng:click="removeOption($index)" class="btn" tabindex="-1"></a>
                                </div>
                            </div>
                        </div>
                        <p>
                            <button class="btn btn-link pull-right" ng-click="showOptionsInTextarea()">Show strings</button>
                            <button class="btn btn-link" ng-hide="activeQuestion.optionsCount >=200" ng-click="addOption()">Add Option</button>
                        </p>
                    </div>
                    <div ng-if="!activeQuestion.useListAsOptionsEditor">
                        <div class="form-group" ng-class="{'has-error': !questionForm.stringifiedOptions.$valid}">
                            <textarea name="stringifiedOptions"
                                      class="form-control mono"
                                      ng-model="activeQuestion.stringifiedOptions"
                                      match-options-pattern
                                      max-options-count
                                      msd-elastic></textarea>
                            <p class="help-block">
                                <input class="btn btn-link" type="button" value="Show list" ng-click="showOptionsInList()" ng-disabled="!questionForm.stringifiedOptions.$valid" />
                            </p>
                            <p class="help-block ng-cloak" ng-show="questionForm.stringifiedOptions.$error.matchOptionsPattern">
                                You entered an invalid input. Each line should follow the format: "Title...Value". 'Value' must be an integer or decimal number. Title must be an alpha-numeric string. Title cannot contain dots (i.e. ".") or ellipses (i.e., "&hellip;"); no empty lines are allowed.
                            </p>
                            <p class="help-block ng-cloak" ng-show="questionForm.stringifiedOptions.$error.maxOptionsCount">
                                You entered more than maximum allowed 200
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <p>
                <a ng-if="activeQuestion.isFilteredCombobox"
                   href="javascript:void(0);"
                   class="btn btn-link"
                   ng-click="editFilteredComboboxOptions()">
                    Upload new options
                </a>
                <a ng-if="activeQuestion.isCascade && (activeQuestion.cascadeFromQuestionId || '') !== ''"
                   href="javascript:void(0);"
                   class="btn btn-link"
                   ng-click="editCascadingComboboxOptions()">
                    Upload new options
                </a>
            </p>
            <div class="table-holder">
                <div class="row">
                    <div class="col-xs-4">
                        <div ng-if="!activeQuestion.isCascade && !activeQuestion.isLinked" class="checkbox checkbox-in-column">
                            <input id="cb-is-filtered-combobox" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.isFilteredCombobox" />
                            <label for="cb-is-filtered-combobox"><span></span>Combo box</label>
                        </div>
                    </div>
                    <div class="col-xs-4">
                        <div ng-if="!activeQuestion.isFilteredCombobox && !activeQuestion.isCascade" class="checkbox checkbox-in-column">
                            <input id="cb-is-linked" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.isLinked" />
                            <label for="cb-is-linked"><span></span>Is linked</label>
                        </div>
                    </div>
                    <div class="col-xs-4">
                        <div ng-if="!activeQuestion.isFilteredCombobox && !activeQuestion.isLinked" class="checkbox checkbox-in-column">
                            <input id="cb-is-cascading" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.isCascade" />
                            <label for="cb-is-cascading"><span></span>Cascading combo box</label>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <div ng-if="!activeQuestion.isFilteredCombobox || !activeQuestion.isCascadingCombobox" class="form-group"
                     ng-include="activeQuestion.isLinked ? 'linkTemplate.html' : ''" ng-class="{'has-error': !questionForm.linkedToQuestion.$valid}" />
            </div>

            <div>
                <div ng-if="activeQuestion.isCascade && !activeQuestion.isLinked"
                     ng-class="{'has-error': !questionForm.linkedToQuestion.$valid}"
                     class="form-group" ng-include="'CascadingComboBox-Template.html'" />
            </div>
        </script>

        <script type="text/ng-template" id="linkTemplate.html">
            <div id="sourceOfLinkedQuestion" class="dropdown-with-breadcrumbs-and-icons">
                <input type="hidden" name="linkedToQuestion" ng-model="activeQuestion.linkedToQuestion" ng-required="true" />
                <label for="linkedQuestionSource">Bind to question from roster group</label>
                <div class="btn-group" dropdown>
                    <button class="btn dropdown-toggle" dropdown-toggle id="linkedQuestionSource" type="button">
                        <span class="select-placeholder" ng-if="(activeQuestion.linkedToQuestion.title || '') == ''">Select question</span>

                        <span class="selected-item" ng-if="(activeQuestion.linkedToQuestion.title || '') !== ''">
                            <span class="path">{{activeQuestion.linkedToQuestion.breadcrumbs}}</span>
                            <span class="chosen-item"><i class="dropdown-icon" ng-class="'icon-'+activeQuestion.linkedToQuestion.type"></i>{{activeQuestion.linkedToQuestion.title}}</span>
                        </span>
                        <span class="dropdown-arrow"></span>
                    </button>

                    <ul class="dropdown-menu" role="menu">
                        <li role="presentation" ng-class="{'dropdown-header': breadCrumb.isSectionPlaceHolder}" ng-repeat="breadCrumb in sourceOfLinkedQuestions">
                            <span ng-if="breadCrumb.isSectionPlaceHolder">{{breadCrumb.title}}</span>

                            <a ng-if="!breadCrumb.isSectionPlaceHolder"
                               ng-click="setLinkSource(breadCrumb.id)"
                               role="menuitem"
                               tabindex="-1"
                               href="javascript:void(0);">
                                <i class="dropdown-icon" ng-class="'icon-'+breadCrumb.type"></i> {{breadCrumb.title}}
                            </a>
                        </li>
                    </ul>
                </div>
                <p class="help-block ng-cloak" ng-show="questionForm.linkedToQuestion.$error.required">
                    You must bind this question
                </p>
            </div>
        </script>

        <script type="text/ng-template" id="CascadingComboBox-Template.html">
            <div id="sourceOfLinkedQuestion" class="dropdown-with-breadcrumbs-and-icons">
                <input type="hidden" name="cascadeFromQuestionId" ng-model="activeQuestion.cascadeFromQuestionId" ng-update-hidden ng-required="true" />
                <label for="singleOptionQuestionSource">Select parent question</label>
                <div class="btn-group" dropdown>
                    <button class="btn dropdown-toggle" dropdown-toggle id="singleOptionQuestionSource" type="button">
                        <span class="select-placeholder" ng-if="(activeQuestion.cascadeFromQuestion.title || '') == ''">Select question</span>

                        <span class="selected-item" ng-if="(activeQuestion.cascadeFromQuestion.title || '') !== ''">
                            <span class="path">{{activeQuestion.cascadeFromQuestion.breadcrumbs}}</span>
                            <span class="chosen-item"><i class="dropdown-icon" ng-class="'icon-'+activeQuestion.cascadeFromQuestion.type"></i>{{activeQuestion.cascadeFromQuestion.title}}</span>
                        </span>
                        <span class="dropdown-arrow"></span>
                    </button>

                    <ul class="dropdown-menu" role="menu">
                        <li role="presentation" ng-class="{'dropdown-header': breadCrumb.isSectionPlaceHolder}" ng-repeat="breadCrumb in sourceOfSingleQuestions">
                            <span ng-if="breadCrumb.isSectionPlaceHolder">{{breadCrumb.title}}</span>

                            <a ng-if="!breadCrumb.isSectionPlaceHolder"
                               ng-click="setCascadeSource(breadCrumb.id)"
                               role="menuitem"
                               tabindex="-1"
                               href="javascript:void(0);">
                                <i class="dropdown-icon" ng-class="'icon-'+breadCrumb.type"></i> {{breadCrumb.title}}
                            </a>
                        </li>
                    </ul>
                </div>
                <p class="help-block ng-cloak" ng-show="questionForm.cascadeFromQuestionId.$error.required">
                    You must select the parent question
                </p>
            </div>
        </script>

    <script type="text/ng-template" id="MultyOption-template.html">
            <div class="multyOption">
                <div ng-if="!activeQuestion.isLinked">

                    <div ng-if="activeQuestion.useListAsOptionsEditor">
                        <div class="table-holder">
                            <div class="table-row" ng-repeat="option in activeQuestion.options">
                                <div class="column-2">
                                    <input type="text" ng-model="option.value" class="form-control">
                                </div>
                                <div class="column-3">
                                    <input type="text" ng-model="option.title" class="form-control">
                                </div>
                                <div class="column-4">
                                    <a href ng:click="removeOption($index)" class="btn"></a>
                                </div>
                            </div>
                        </div>
                        <p>
                            <button class="btn btn-link pull-right" ng-click="showOptionsInTextarea()">Show strings</button>
                            <button class="btn btn-link" ng-if="!activeQuestion.isLinked" id="edit-question-save-button" ng-click="addOption()">Add Option</button>
                        </p>
                    </div>
                    <div ng-if="!activeQuestion.useListAsOptionsEditor">
                        <div class="form-group" ng-class="{'has-error': !questionForm.stringifiedOptions.$valid}">
                            <textarea name="stringifiedOptions"
                                      class="form-control mono"
                                      ng-model="activeQuestion.stringifiedOptions"
                                      match-options-pattern
                                      maxoptionscount
                                      msd-elastic></textarea>
                            <p class="help-block">
                                <input class="btn btn-link" type="button" value="Show list" ng-click="showOptionsInList()" ng-disabled="!questionForm.stringifiedOptions.$valid" />
                            </p>
                            <p class="help-block ng-cloak" ng-show="questionForm.stringifiedOptions.$error.matchOptionsPattern">
                                You entered an invalid input. Each line should follow the format: "Title...Value". 'Value' must be an integer or decimal number. Title must be an alpha-numeric string. Title cannot contain dots (i.e. ".") or ellipses (i.e., "&hellip;"); no empty lines are allowed.
                            <p class="help-block ng-cloak" ng-show="questionForm.stringifiedOptions.$error.maxOptionsCount">
                                You entered more than maximum allowed 200 
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-3">
                        <div class="checkbox checkbox-in-column">
                            <input id="cb-multyoption-is-linked" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.isLinked" />
                            <label for="cb-multyoption-is-linked"><span></span>Is linked</label>
                        </div>
                    </div>
                    <div class="col-xs-3">
                        <div class="checkbox checkbox-in-column">
                            <input id="cb-is-ordered" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.areAnswersOrdered" />
                            <label for="cb-is-ordered"><span></span>Record answer order</label>
                        </div>
                    </div>
                    <div class="col-xs-6">
                        <div class="form-group singleline-group" ng-class="{'has-error': !questionForm.editQuestionMaxAnswersNumber.$valid}">
                            <label for="edit-question-max-answers-number">Max number of answers</label>
                            <input name="editQuestionMaxAnswersNumber" ng-pattern="/^\d+$/" id="edit-question-max-answers-number" type="text" class="form-control small-numeric-input" ng-model="activeQuestion.maxAllowedAnswers">
                            <p class="help-block ng-cloak" ng-show="questionForm.editQuestionMaxAnswersNumber.$error.pattern">
                                Only integers are allowed
                            </p>
                        </div>
                    </div>
                </div>
                <div class="form-group" ng-include="activeQuestion.isLinked ? 'linkTemplate.html' : ''" ng-class="{'has-error': !questionForm.linkedToQuestion.$valid}">
                </div>
            </div>
        </script>

        <script type="text/ng-template" id="Numeric-template.html">
            <div class="row">
                <div class="col-xs-4">
                    <div class="checkbox checkbox-in-column">
                        <input id="cb-is-integer" type="checkbox" class="wb-checkbox" ng-model="activeQuestion.isInteger" />
                        <label for="cb-is-integer"><span></span>Integer</label>
                    </div>
                </div>
                <div class="col-xs-8 inline-inputs">
                    <div class="form-group" ng-show="!activeQuestion.isInteger" ng-class="{'has-error': !questionForm.countOfDecimalPlaces.$valid}">
                        <label for="edit-question-count-decimal">Number of decimal places</label>
                        <input id="edit-question-count-decimal" type="text"
                               name="countOfDecimalPlaces"
                               ng-pattern="/^\d+$/"
                               ng-model="activeQuestion.countOfDecimalPlaces"
                               class="form-control small-numeric-input">
                        <p class="help-block ng-cloak" ng-show="questionForm.countOfDecimalPlaces.$error.pattern">
                            Only integers are allowed
                        </p>
                    </div>
                    <div class="form-group" ng-show="activeQuestion.isInteger" ng-class="{'has-error': !questionForm.maxValue.$valid}">
                        <label for="edit-question-max-value">Roster upper bound</label>
                        <input id="edit-question-max-value"
                               ng-pattern="/^\d+$/"
                               type="text" name="maxValue" ng-model="activeQuestion.maxValue" class="form-control  small-numeric-input">
                        <p class="help-block ng-cloak" ng-show="questionForm.maxValue.$error.pattern">
                            Only integers are allowed
                        </p>
                    </div>
                </div>
            </div>
        </script>

        <script type="text/ng-template" id="Text-template.html">
            <div class="form-group">
                <label for="edit-mask">Pattern <help key="mask" /></label>
                <input id="edit-mask" type="text" ng-model="activeQuestion.mask" class="form-control">
            </div>
        </script>

        <script type="text/ng-template" id="TextList-template.html">
            <div class="form-group" ng-class="{'has-error': !questionForm.maxAnswerCount.$valid}">
                <label for="edit-question-max-answers-number">Maximum number of list elements</label>
                <input id="edit-question-max-answers-number" 
                       name="maxAnswerCount" 
                       type="text" 
                       ng-pattern="/^\d+$/" 
                       ng-model="activeQuestion.maxAnswerCount" 
                       class="form-control" />
                <p class="help-block ng-cloak" ng-show="questionForm.maxAnswerCount.$error.pattern">
                    Only integers are allowed
                </p>
            </div>
        </script>

        <script type="text/ng-template" id="DateTime-template.html">
        </script>

        <script type="text/ng-template" id="GpsCoordinates-template.html">
        </script>

        <script type="text/ng-template" id="QRBarcode-template.html">
        </script>

        <script type="text/ng-template" id="Multimedia-template.html">
        </script>
    </div>
    <div class="form-buttons-holder">
        <div class="pull-left">
            <button type="submit" id="edit-chapter-save-button" class="btn btn-lg " ng-class="{ 'btn-primary': questionForm.$dirty }" unsaved-warning-clear ng-click="saveQuestion()" ng-disabled="!questionForm.$valid">Save</button>
            <button type="reset" id="edit-chapter-cancel-button" class="btn btn-lg btn-link" unsaved-warning-clear ng-click="cancelQuestion()">Cancel</button>
        </div>
        <div class="pull-right">
            <button type="button" id="edit-chapter-delete-button" class="btn btn-lg btn-link" ng-click="deleteQuestion(activeQuestion)" unsaved-warning-clear>Delete</button>
            <button type="button" id="edit-chapter-clone-button" class="btn btn-lg btn-link" ng-click="cloneQuestion()">Clone</button>
            <ng-include src="'moveToChapterSnippet'" />
        </div>
    </div>
</form>
