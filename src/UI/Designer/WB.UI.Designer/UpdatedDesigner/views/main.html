<section id="header" class="row">
    <div class="designer-logo"></div>
    <div class="breadcrumbs">
        <ul>
            <li><a href="/Designer">Designer home</a></li>
            <li><a href="/Designer">My Questionnaires</a></li>
        </ul>
    </div>
    <div class="questionnarie-title">
        <div class="title">
            <!--ng-controller="VerificationCtrl"-->
            {{questionnaire.title}} <span>({{questionnaire.questionsCount}}Q, {{questionnaire.groupsCount}}G, {{questionnaire.rostersCount}}R)</span>
            <input type="button" class="wb-inline-button error" value="VERIFY" ng-click="verify()" />
            <span id="verify-btn" data-toggle="modal" data-target="#verification-modal" ng-hide="verificationStatus.errorsCount == 0" class="error-message ng-hide"><a href=""><span ng-bind="verificationStatus.errorsCount"></span>  errors</a></span>
            <span ng-show="verificationStatus.errorsCount == 0">OK</span>
        </div>
    </div>
</section>

<section id="spacer" class="row">
    <div class="left"></div>
    <div class="right"></div>
</section>

<section id="main" class="row">
    <div class="questionnaire-tree col-xs-6">
        <div class="chapter-title">
            {{currentChapter.title }}
            <ul class="controls-right">
                <li><a class="filter" title="Toggle Filter"></a></li>
                <li><a class="search" title="Toggle Search"></a></li>
            </ul>
        </div>
        <div class="chapter-panel" ng-click="unfold();" ng-class="{unfolded: isFolded == true}" ng-controller="ChaptersCtrl">
            <div class="foldback-button" ng-click="foldback();$event.stopPropagation()"></div>
            <ul class="chapters">
                <li ng-repeat="chapter in questionnaire.chapters" ng-class="{current: currentChapterId == chapter.chapterId}" ng-click="changeChapter(chapter);">
                    <div class="holder">
                        <div class="inner">
                            <h1>{{chapter.title}}</h1>
                            <div class="btn-group" ng-class="{open: chapter.isMenuOpen == true}" ng-click="openMenu(chapter);$event.stopPropagation();">
                                <a class="dropdown-toggle" data-toggle="dropdown"></a>
                                <ul class="dropdown-menu">
                                    <li><a ng-click="editChapter(chapter);$event.stopPropagation()">Edit</a></li>
                                    <li><a ng-click="cloneChapter(chapter);$event.stopPropagation()">Clone</a></li>
                                    <li><a ng-click="deleteChapter(chapter);$event.stopPropagation()">Delete</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
            <div class="button-holder">
                <input type="button" class="wb-inline-button lighter-hover" value="ADD NEW CHAPTER" ng-click="addNewChapter()">
            </div>
        </div>

        <script type="text/ng-template" id="tree_item_renderer.html">
            <div ng-click="setItem(item)" ng-if="isQuestion(item)"
                 class="question item"
                 ng-class="{'selected' : item.itemId == currentItemId, 'cat-singleanswer': item.type == 1, 'cat-singleanswer': item.type == 2, 'cat-multianswer' : item.type == 3, 'cat-intedit' : item.type == 4, 'cat-datetime' : item.type == 5, 'cat-geoloc' : item.type == 6, 'cat-textedit' : item.type == 8, 'cat-textarea' : item.type == 9,  'cat-multimedia' : item.type == 10, 'cat-textedit' : item.type == 7, 'cat-singleanswer' : item.type == 0 }">
                <div class="icon"></div>
                {{ item.title }}
                <div class="qname-block">
                    <a href class="linked"></a>{{item.variable}}
                    <div class="btn-group">
                        <a href="#" data-toggle="dropdown" class="dropdown-toggle"></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a>Delete</a>
                            </li>
                            <li>
                                <a>Clone</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="section item" ng-click="setItem(item)" ng-class="{'selected' : item.itemId == currentItemId}" ng-if="!isQuestion(item)">
                <span ng-click="collapse(item)" ng-show="!item.collapsed">&nbsp;[-]&nbsp;&nbsp;</span>
                <span ng-click="expand(item)" ng-show="item.collapsed">&nbsp;[+]&nbsp;&nbsp;</span>
                {{item.title}}
            </div>

            <div ng-show="!item.collapsed">
                <div ng-repeat="item in item.items" ng-include="'tree_item_renderer.html'" style="margin-left: 20px;">
                </div>
            </div>

            <div class="buttons-item" ng-if="!isQuestion(item)" ng-show="!item.collapsed">
                <input type="button" class="wb-inline-button lighter-hover" value="ADD QUESTION" ng-click="addQuestion(item)" />
                <input type="button" class="wb-inline-button lighter-hover" value="ADD SUBGROUP" ng-click="addGroup(item)" />
            </div>
        </script>

        <div class="question-list">
            <div ng-repeat="item in items" ng-include="'tree_item_renderer.html'">
            </div>
        </div>
    </div>

    <div class="question-editor col-xs-6" ng-if="activeChapter != undefined" ng-include src="'UpdatedDesigner/views/chapter.html'" ng-controller="ChapterCtrl">
    </div>

    <div class="question-editor col-xs-6" ng-if="activeRoster != undefined" ng-include src="'UpdatedDesigner/views/roster.html'" ng-controller="RosterCtrl">
    </div>

    <div class="question-editor col-xs-6" ng-if="activeQuestion != undefined" ng-include src="'UpdatedDesigner/views/question.html'" ng-controller="QuestionCtrl">
    </div>

</section>

<div id="verification-modal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Modal title</h4>
            </div>
            <div class="modal-body">
                <div>
                    <div id="verify-popover-content">
                        <div class="question-list">
                            <div ng-repeat="error in verificationStatus.errors">
                                <div class="question item cat-multianswer">
                                    {{error.message}}
                                    <div class="qname-block">{{error.code}}</div>
                                </div>
                                <ul class="error-list">
                                    <li ng-repeat="reference in error.references"><span>{{reference.title}}</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->