@using RavenQuestionnaire.Core.Views.Survey
@model SurveyGroupView
<script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")" type = "text/javascript"> </script>
@{
    ViewBag.Title = "Surveys";
}
<script src="../../Scripts/sorter.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("#questionnaireTable").tablesorter({
                order: "@Model.Order",
                send: function(data) {
                    $.ajax({
                            type: "POST",
                            url: "@Url.Action("_GroupTableData", "Survey")",
                            data: JSON.stringify({ SortOrder: data, Pager: { Page: @Model.Page , PageSize: @Model.PageSize }, Id: '@Model.TemplateId' }),
                            contentType: 'application/json, charset=utf-8',
                            statusCode: {
                                200: function(response) {
                                    $("#questionnaireTable tbody").html(response);
                                }
                            }
                        });
                }
            });
    });
    function HideForm(data) {
        var json = jQuery.parseJSON(data.responseText);
        $('#row-' + json.cqId).removeClass("showForm");

        if (json.userId != null && json.userName != null) {
            $('#link-' + json.cqId).replaceWith('<a id="link-' + json.cqId + '" href="/User/Details/' + json.userId + '">' + json.userName + '</a>');
        }
        else {
            $('#link-' + json.cqId).replaceWith('<a id="link-' + json.cqId + '" href="/User/Details/"></a>');
        }
    }
</script>

<h2>@(Model.SurveyTitle)'s assignments</h2>
<table id="questionnaireTable" class="table table-striped table-bordered table-condensed">
    <thead>
        <tr>
            @foreach (var header in Model.Headers)
            {
                <th class="sorting" sorter='{"key":"@header.Value"}'>@header.Value</th>
            }
            <th class="sorting" sorter='{"key":"Responsible.Name"}'>Responsible</th>
            <th class="sorting" sorter='{"key":"Status.Name"}'>Status</th>
            <th></th>
        </tr>
    </thead>
@Html.Partial("_TableGroup", Model)
</table>
