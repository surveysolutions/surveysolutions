@using Web.Supervisor.Models
@using Main.Core.Entities.SubEntities
@model Core.Supervisor.Views.Survey.SurveyBrowseView
@{
    ViewBag.Title = "Surveys";
}
<script>
    $(document).ready(function() {
        document.filterUser = "";
        $("#questionnaireTable").tablesorter({
                order: "@Model.Order",
                send: function(data) {
                    $.ajax({
                            type: "POST",
                            url: "@Url.Action("TableData", "Survey")",
                            data: JSON.stringify({  UserId: document.filterUser, SortOrder: data, Pager: { Page: @Model.Page , PageSize: @Model.PageSize } }),
                            contentType: 'application/json, charset=utf-8',
                            statusCode: {
                                200: function(response) {
                                    $("#questionnaireTable tbody").html(response);
                                }
                            }
                        });
                }
            });
        $('#filter').editable().on('update', function(e, editable) {
            document.filterUser = editable.value;
            $.ajax({
                    type: "POST",
                    url: "@Url.Action("TableData", "Survey")",
                    data: JSON.stringify({ UserId: document.filterUser , SortOrder:[{Field:"Title",Direction:"Asc"}],Pager:{Page:1,PageSize:20}}),
                    contentType: 'application/json, charset=utf-8',
                    statusCode: {
                        200: function(response) {
                            $("#questionnaireTable tbody").html(response);
                        }
                    }
                });
        });
    });
</script>
<h2>Surveys by <a href="#" id="filter" 
                data-placement="bottom" 
                data-type="select" 
                data-source="@Url.Action("UsersJson", "User")"
                data-prepend='All'             
                data-original-title="Select user">@Model.User.Name</a> </h2>
<table id="questionnaireTable" class="table table-striped table-bordered table-condensed">
    <thead>
        <tr>
            <th class="sorting" sorter='{"key":"Title"}'><span>Survey</span></th>
            <th class="sorting" sorter='{"key":"StartDate"}'><span>Initial date</span></th>
            @foreach (var item in Model.Headers)
            {
                <th class="sorting" role="columnheader" sorter='{"key": "@item.Key"}'><span>@item.Value</span>
                </th>
            }
        </tr>
    </thead>
    <tbody>
        @Html.Partial("_Table", Model)
    </tbody>
</table>
<div class="pagination">
    @Html.QPager(Model.PageSize, Model.Page, Model.TotalCount, new { order = Model.Order })
</div>
