@using RavenQuestionnaire.Core.Views.Survey
@using RavenQuestionnaire.Core.Views.User
@model SurveyGroupView

    @foreach (SurveyGroupItem fitem in Model.Items)
    {
        <tr id="responsible-@(fitem.Id)">
            @foreach (var item in fitem.FeatureadValue)
            {
                <td>
                    @(string.IsNullOrEmpty(item.Value) ? string.Empty : item.Value)
                </td>
            }
            <td id="row-@fitem.Id">
                <div class="assignment-view">
                    <a id="link-@fitem.Id" href="@Url.Action("Details", "User", new { id = @fitem.Responsible == null ? string.Empty : fitem.Responsible.Id, input=new InterviewerInputModel() })">@(fitem.Responsible == null ? string.Empty : fitem.Responsible.Name)</a>
                </div>
                <div class="assignment-form">
                    @using (Ajax.BeginForm("AssignForm", "Survey", new AjaxOptions { OnComplete = "HideForm" }))
                    {
                        var id = fitem.Id + "";
                        @Html.Hidden("CqId", id)
                        <div>@Html.DropDownList("userId", ViewBag.Users as SelectList)</div>
                        <div>
                            <input class="btn btn-primary" name="Save" type="submit" value="Save" />
                            <input class="btn btn-danger" id="canc-@fitem.Id" name="Cancel" type="button" value="Cancel" />
                        </div>
                    }
                </div>
            </td>
            <td>@fitem.Status.Name
            </td>
            <td>
                @if (fitem.Responsible == null)
                {
                    <a href="@Url.Action("Assign", new { id = fitem.Id })">Assign</a>    
                }
                else
                {
                    <a id="ref-@fitem.Id" href="#" >Change</a>
                    <script type="text/javascript">
                        $('#ref-@(fitem.Id)').click(function () {
                            $('#row-@(fitem.Id)').addClass("showForm");
                        });
                        $('#canc-@(fitem.Id)').click(function () {
                            $('#row-@(fitem.Id)').removeClass("showForm");
                        });
                    </script>
                }
                <a href="@Url.Action("Details", new { id = fitem.Id })">Details</a>    
            </td>
        </tr>
    }